<!DOCTYPE html>



  


<html class="theme-next muse use-motion" lang="">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>
<meta name="theme-color" content="#222">









<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />
















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />







<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.4" rel="stylesheet" type="text/css" />


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=5.1.4">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=5.1.4">


  <link rel="mask-icon" href="/images/logo.svg?v=5.1.4" color="#222">





  <meta name="keywords" content="Hexo, NexT" />










<meta property="og:type" content="website">
<meta property="og:title" content="NIRVANA">
<meta property="og:url" content="http://yoursite.com/page/8/index.html">
<meta property="og:site_name" content="NIRVANA">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="NIRVANA">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    version: '5.1.4',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":false,"onmobile":false},
    fancybox: true,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/page/8/"/>





  <title>NIRVANA</title>
  








</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/"  class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">NIRVANA</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle"></p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Startseite
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archiv
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/17/HDU4757 Tree LCA+可持久化Trie/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Azrael_Death">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NIRVANA">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/17/HDU4757 Tree LCA+可持久化Trie/" itemprop="url">HDU4757 Tree <LCA+可持久化Trie></a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-17T00:00:00+08:00">
                2017-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><blockquote>
<h2 id="【LCA-可持久化Trie】Tree"><a href="#【LCA-可持久化Trie】Tree" class="headerlink" title="【LCA+可持久化Trie】Tree"></a>【LCA+可持久化Trie】Tree</h2></blockquote>
<h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>Zero and One are good friends who always have fun with each other.<br>This time, they decide to do something on a tree which is a kind of graph that there is only one path from node to node. First, Zero will give One an tree and every node in this tree has a value. Then, Zero will ask One a series of queries. Each query contains three parameters: $x$, $y$, $z$ which mean that he want to know the maximum value produced by $z$ $xor$ each value on the path from node $x$ to node $y$ (include node $x$, node $y$). Unfortunately, One has no idea in this question. So he need you to solve it.</p>
<blockquote>
</blockquote>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>There are several test cases and the cases end with $EOF$. For each case:<br>The first line contains two integers $n(1\le n\le 10^5)$ and $m(1\le m\le 10^5)$, which are the amount of tree’s nodes and queries, respectively.<br>The second line contains $n$ integers $a[1..n]$ and $a<a href="0\le a[i]&lt;2^{16}">i</a>$ is the value on the $i^{th}$ node.<br>The next $n–1$ lines contains two integers $u$ $v$, which means there is an connection between $u$ and $v$.<br>The next m lines contains three integers $x$ $y$ $z$, which are the parameters of Zero’s query. </p>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>For each query, output the answer. </p>
<blockquote>
</blockquote>
<h3 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">3 2</span><br><span class="line">1 2 2</span><br><span class="line">1 2</span><br><span class="line">2 3</span><br><span class="line">1 3 1</span><br><span class="line">2 3 2</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">0</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Translation"><a href="#Translation" class="headerlink" title="Translation"></a>Translation</h2><p>题目大意：给出一棵树，求两点$x,y$间树上链路中的数异或$z$得到的最大结果。</p>
<p>标签：$LCA+可持久化Trie$</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>最大异或和上树…<br>有异或，一个经典的解法就是建一棵$01$字典树，然后贪心跑一遍，尽量选和给出数当前位不同的数。<br>对于树上的此类问题，可以把$Trie$树可持久化，对于每个点，存它到根节点的路径上所有数的$Trie$树，这样是有前缀和性质的，求$LCA$后作差即可求出链路上的数。<br>可持久化方法和主席树差不多。</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_D 15</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, cnt, c[MAX_N+<span class="number">5</span>], root[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> anc[MAX_N+<span class="number">5</span>][MAX_D+<span class="number">5</span>], dep[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">bool</span> vis[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span><span class="keyword">int</span> ls, rs, size;&#125; trie[MAX_N*<span class="number">20</span>+<span class="number">500</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	root[<span class="number">0</span>] = cnt = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">memset</span>(root, <span class="number">0</span>, <span class="keyword">sizeof</span>(root));</span><br><span class="line">	<span class="built_in">memset</span>(anc, <span class="number">0</span>, <span class="keyword">sizeof</span>(anc));</span><br><span class="line">	<span class="built_in">memset</span>(dep, <span class="number">0</span>, <span class="keyword">sizeof</span>(dep));</span><br><span class="line">	<span class="built_in">memset</span>(vis, <span class="literal">false</span>, <span class="keyword">sizeof</span>(vis));</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	G[i].clear();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">	vis[u] = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; (<span class="number">1</span>&lt;&lt;i) &lt;= dep[u]; i++)	anc[u][i] = anc[anc[u][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++)</span><br><span class="line">		<span class="keyword">if</span> (!vis[G[u][i]])	anc[G[u][i]][<span class="number">0</span>] = u, dep[G[u][i]] = dep[u]+<span class="number">1</span>, DFS(G[u][i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i, j;</span><br><span class="line">	<span class="keyword">if</span> (dep[a] &lt; dep[b])	swap(a, b);</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; (<span class="number">1</span>&lt;&lt;i) &lt;= dep[a]; i++) ;	i--;</span><br><span class="line">	<span class="keyword">for</span> (j = i; j &gt;= <span class="number">0</span>; j--)</span><br><span class="line">		<span class="keyword">if</span> (dep[a]-(<span class="number">1</span>&lt;&lt;j) &gt;= dep[b])</span><br><span class="line">			a = anc[a][j];</span><br><span class="line">	<span class="keyword">if</span> (a == b)	<span class="keyword">return</span> a;</span><br><span class="line">	<span class="keyword">for</span> (j = i; j &gt;= <span class="number">0</span>; j--)</span><br><span class="line">		<span class="keyword">if</span> (anc[a][j] != anc[b][j])</span><br><span class="line">			a = anc[a][j], b = anc[b][j];</span><br><span class="line">	<span class="keyword">return</span> anc[a][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> o, <span class="keyword">int</span> val, <span class="keyword">int</span> range)</span> </span>&#123;</span><br><span class="line">	trie[v] = trie[o];</span><br><span class="line">	<span class="keyword">if</span> (range == <span class="number">0</span>) &#123;trie[v].size++; <span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">int</span> x = val/range;</span><br><span class="line">	<span class="keyword">if</span> (x == <span class="number">0</span>)	insert(trie[v].ls = ++cnt, trie[o].ls, val%range, range/<span class="number">2</span>);</span><br><span class="line">	<span class="keyword">else</span>	insert(trie[v].rs = ++cnt, trie[o].rs, val%range, range/<span class="number">2</span>);</span><br><span class="line">	trie[v].size = trie[trie[v].ls].size+trie[trie[v].rs].size;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">	root[u] = ++cnt;</span><br><span class="line">	insert(root[u], root[anc[u][<span class="number">0</span>]], c[u], (<span class="number">1</span>&lt;&lt;MAX_D));</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++)</span><br><span class="line">		<span class="keyword">if</span> (G[u][i] != anc[u][<span class="number">0</span>])	build(G[u][i]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2, <span class="keyword">int</span> v3, <span class="keyword">int</span> v4, <span class="keyword">int</span> x, <span class="keyword">int</span> range)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (range == <span class="number">0</span>)	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> tmp1 = trie[trie[v1].ls].size+trie[trie[v2].ls].size-trie[trie[v3].ls].size-trie[trie[v4].ls].size;</span><br><span class="line">	<span class="keyword">int</span> tmp2 = trie[trie[v1].rs].size+trie[trie[v2].rs].size-trie[trie[v3].rs].size-trie[trie[v4].rs].size;</span><br><span class="line">	<span class="keyword">if</span> (x/range == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="keyword">if</span> (tmp2)	<span class="keyword">return</span> range+query(trie[v1].rs, trie[v2].rs, trie[v3].rs, trie[v4].rs, x%range, range/<span class="number">2</span>);</span><br><span class="line">		<span class="keyword">else</span>	<span class="keyword">return</span> query(trie[v1].ls, trie[v2].ls, trie[v3].ls, trie[v4].ls, x%range, range/<span class="number">2</span>);</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (tmp1)	<span class="keyword">return</span> range+query(trie[v1].ls, trie[v2].ls, trie[v3].ls, trie[v4].ls, x%range, range/<span class="number">2</span>);</span><br><span class="line">		<span class="keyword">else</span>	<span class="keyword">return</span> query(trie[v1].rs, trie[v2].rs, trie[v3].rs, trie[v4].rs, x%range, range/<span class="number">2</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m) != EOF) &#123;</span><br><span class="line">		init();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;c[i]);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;<span class="keyword">int</span> u, v; <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v), G[u].push_back(v), G[v].push_back(u);&#125;</span><br><span class="line">		DFS(<span class="number">1</span>);</span><br><span class="line">		build(<span class="number">1</span>);</span><br><span class="line">		<span class="keyword">while</span> (m--) &#123;</span><br><span class="line">			<span class="keyword">int</span> u, v, x, lca;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;u, &amp;v, &amp;x);	lca = LCA(u, v);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, query(root[u], root[v], root[lca], root[anc[lca][<span class="number">0</span>]], x, (<span class="number">1</span>&lt;&lt;MAX_D)));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; i++)	trie[i].ls = trie[i].rs = trie[i].size = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/16/BZOJ1001【BJOI2006】狼抓兔子 网络流/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Azrael_Death">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NIRVANA">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/16/BZOJ1001【BJOI2006】狼抓兔子 网络流/" itemprop="url">BZOJ1001【BJOI2006】狼抓兔子 <网络流></a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-16T00:00:00+08:00">
                2017-10-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><blockquote>
<h2 id="【BJOI2006】狼抓兔子"><a href="#【BJOI2006】狼抓兔子" class="headerlink" title="【BJOI2006】狼抓兔子"></a>【BJOI2006】狼抓兔子</h2><p>Time Limit: $15 Sec$<br>Memory Limit: $162 MB$</p>
</blockquote>
<h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>现在小朋友们最喜欢的”喜羊羊与灰太狼”,话说灰太狼抓羊不到，但抓兔子还是比较在行的，<br>而且现在的兔子还比较笨，它们只有两个窝，现在你做为狼王，面对一个网格的地形：<br>左上角点为$(1,1)$,右下角点为$(N,M)$.有以下三种类型的道路<br>$1:(x,y)\Leftrightarrow(x+1,y)$<br>$2:(x,y)\Leftrightarrow(x,y+1)$<br>$3:(x,y)\Leftrightarrow(x+1,y+1)$<br>道路上的权值表示这条路上最多能够通过的兔子数，道路是无向的. 左上角和右下角为兔子的两个窝，<br>开始时所有的兔子都聚集在左上角$(1,1)$的窝里，现在它们要跑到右下解$(N,M)$的窝中去，狼王开始伏击<br>这些兔子.当然为了保险起见，如果一条道路上最多通过的兔子数为$K$，狼王需要安排同样数量的K只狼，<br>才能完全封锁这条道路，你需要帮助狼王安排一个伏击方案，使得在将兔子一网打尽的前提下，参与的<br>狼的数量要最小。因为狼还要去找喜羊羊麻烦.</p>
<blockquote>
</blockquote>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>第一行为$N,M$.表示网格的大小，$N,M$均小于等于$1000$.<br>接下来分三部分<br>第一部分共$N$行，每行$M-1$个数，表示横向道路的权值.<br>第二部分共$N-1$行，每行$M$个数，表示纵向道路的权值.<br>第三部分共$N-1$行，每行$M-1$个数，表示斜向道路的权值.<br>输入文件保证不超过$10MB$</p>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>输出一个整数，表示参与伏击的狼的最小数量. </p>
<blockquote>
</blockquote>
<h3 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">3 4</span><br><span class="line">5 6 4</span><br><span class="line">4 3 1</span><br><span class="line">7 5 3</span><br><span class="line">5 6 7 8</span><br><span class="line">8 7 6 5</span><br><span class="line">5 5 5</span><br><span class="line">6 6 6</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">14</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h3 id="HINT"><a href="#HINT" class="headerlink" title="HINT"></a>HINT</h3><p>2015.4.16新加数据一组，可能会卡掉从前可以过的程序。</p>
</blockquote>
<p>标签:网络流</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>此题是裸的网络流，看看数据范围，再看看时限，很容易发现直接$Dinnic$最小割可过。<br>其实还可以用对偶图上跑最短路做，貌似特判有点多，不太好写，但是要快一些，艹榜可用。</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x7fffffff</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span><span class="keyword">int</span> v, c, nxt;&#125; E[<span class="number">12000005</span>];</span><br><span class="line"><span class="keyword">int</span> n, m, pre[<span class="number">1000005</span>], d[<span class="number">1000005</span>], cnt;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;cnt = <span class="number">0</span>, <span class="built_in">memset</span>(pre, <span class="number">-1</span>, <span class="keyword">sizeof</span>(pre));&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">	E[cnt].v = v, E[cnt].c = c, E[cnt].nxt = pre[u], pre[u] = cnt++;</span><br><span class="line">	E[cnt].v = u, E[cnt].c = <span class="number">0</span>, E[cnt].nxt = pre[v], pre[v] = cnt++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BFS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(d, <span class="number">-1</span>, <span class="keyword">sizeof</span>(d));</span><br><span class="line">	<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;	que.push(<span class="number">1</span>), d[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (!que.empty()) &#123;</span><br><span class="line">		<span class="keyword">int</span> u = que.front();	que.pop();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = pre[u]; ~i; i = E[i].nxt) &#123;</span><br><span class="line">			<span class="keyword">int</span> v = E[i].v, c = E[i].c;</span><br><span class="line">			<span class="keyword">if</span> (~d[v] || !c)	<span class="keyword">continue</span>;</span><br><span class="line">			d[v] = d[u]+<span class="number">1</span>, que.push(v);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> d[n*m] != <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (u == n*m)	<span class="keyword">return</span> flow;	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = pre[u]; ~i; i = E[i].nxt) &#123;</span><br><span class="line">		<span class="keyword">int</span> v = E[i].v, c = E[i].c;</span><br><span class="line">		<span class="keyword">if</span> (d[u]+<span class="number">1</span> != d[v] || !c)	<span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">int</span> tmp = DFS(v, min(flow, c));</span><br><span class="line">		flow -= tmp, ret += tmp, E[i].c -= tmp, E[i^<span class="number">1</span>].c += tmp;</span><br><span class="line">		<span class="keyword">if</span> (!flow)	<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!ret)	d[u] = <span class="number">-1</span>;	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Dinic</span><span class="params">()</span> </span>&#123;<span class="keyword">int</span> ret = <span class="number">0</span>;	<span class="keyword">while</span> (BFS())	ret += DFS(<span class="number">1</span>, INF);	<span class="keyword">return</span> ret;&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m), init();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>, x; j &lt; m; j++)</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x), insert(m*(i<span class="number">-1</span>)+j, m*(i<span class="number">-1</span>)+j+<span class="number">1</span>, x), insert(m*(i<span class="number">-1</span>)+j+<span class="number">1</span>, m*(i<span class="number">-1</span>)+j, x);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++)	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>, x; j &lt;= m; j++)</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x), insert(m*(i<span class="number">-1</span>)+j, m*i+j, x), insert(m*i+j, m*(i<span class="number">-1</span>)+j, x);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++)	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>, x; j &lt; m; j++)</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x), insert(m*(i<span class="number">-1</span>)+j, m*i+j+<span class="number">1</span>, x), insert(m*i+j+<span class="number">1</span>, m*(i<span class="number">-1</span>)+j, x);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d"</span>, Dinic());</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/14/BZOJ1997【HNOI2010】Planer 2-SAT/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Azrael_Death">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NIRVANA">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/14/BZOJ1997【HNOI2010】Planer 2-SAT/" itemprop="url">BZOJ1997 Planer <2-SAT></a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-14T00:00:00+08:00">
                2017-10-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><blockquote>
<p>传送门：<a href="http://www.lydsy.com/JudgeOnline/problem.php?id=1997" target="_blank" rel="noopener">http://www.lydsy.com/JudgeOnline/problem.php?id=1997</a></p>
</blockquote>
<p>标签：2-SAT，并查集</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>本题和$POJ3207$没什么区别…<br>只是刚做$POJ3207$时是复习$2-SAT$，所以写了$tarjan$，然而某天碰到这题突然想到了并查集。<br>貌似此题可以种类并查集$trick$过。<br>把每条线段拆成两个点，代表从里面连和外面连，对于相交线段$a,b$，一定有$a$和$b$不同时在里面或外面，于是$merge(a, b’)$, $merge(a’, b)$。这样合并时判断是否有$i$, $i’$在同一集中即可。</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 200</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 10000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, p[MAX_N+<span class="number">5</span>], l[MAX_M+<span class="number">5</span>], r[MAX_M+<span class="number">5</span>], fa[MAX_M*<span class="number">2</span>+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">2</span>*m; i++)	fa[i] = i;&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getf</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;<span class="keyword">return</span> fa[x] == x ? x : fa[x] = getf(fa[x]);&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;a = getf(a), b = getf(b);	<span class="keyword">if</span> (a != b)	fa[a] = b;&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> T;	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m), init();	<span class="keyword">bool</span> flag = <span class="literal">true</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;l[i], &amp;r[i]);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, x; i &lt; n; i++)	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x), p[x] = i;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)	l[i] = p[l[i]], r[i] = p[r[i]];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)	<span class="keyword">if</span> (l[i] &gt; r[i])	swap(l[i], r[i]);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; m; i++)	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; i; j++)</span><br><span class="line">			<span class="keyword">if</span> ((l[i] &lt; l[j] &amp;&amp; r[i] &gt; l[j] &amp;&amp; r[i] &lt; r[j]) || (l[i] &gt; l[j] &amp;&amp; l[i] &lt; r[j] &amp;&amp; r[i] &gt; r[j]))</span><br><span class="line">				merge(i*<span class="number">2</span>, j*<span class="number">2</span>+<span class="number">1</span>), merge(i*<span class="number">2</span>+<span class="number">1</span>, j*<span class="number">2</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++)	flag &amp;= (getf(i*<span class="number">2</span>) != getf(i*<span class="number">2</span>+<span class="number">1</span>));</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, flag ? <span class="string">"YES"</span> : <span class="string">"NO"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/14/POJ3207 Ikki's Story IV - Panda's Trick 2-SAT/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Azrael_Death">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NIRVANA">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/14/POJ3207 Ikki's Story IV - Panda's Trick 2-SAT/" itemprop="url">POJ3207 Ikki's Story IV - Panda's Trick <2-SAT></a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-14T00:00:00+08:00">
                2017-10-14
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><blockquote>
<h2 id="Ikki’s-Story-IV-Panda’s-Trick"><a href="#Ikki’s-Story-IV-Panda’s-Trick" class="headerlink" title="Ikki’s Story IV - Panda’s Trick"></a>Ikki’s Story IV - Panda’s Trick</h2></blockquote>
<h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>liympanda, one of Ikki’s friend, likes playing games with Ikki. Today after minesweeping with Ikki and winning so many times, he is tired of such easy games and wants to play another game with Ikki.<br>liympanda has a magic circle and he puts it on a plane, there are n points on its boundary in circular border: $0, 1, 2, \cdots , n-1$. Evil panda claims that he is connecting m pairs of points. To connect two points, liympanda either places the link entirely inside the circle or entirely outside the circle. Now liympanda tells Ikki no two links touch inside/outside the circle, except on the boundary. He wants Ikki to figure out whether this is possible…<br>Despaired at the minesweeping game just played, Ikki is totally at a loss, so he decides to write a program to help him.</p>
<blockquote>
</blockquote>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>The input contains exactly one test case.<br>In the test case there will be a line consisting of of two integers: $n$ and $m$ $(n \le 1,000, m \le 500)$. The following $m$ lines each contain two integers $a_i$ and $b_i$, which denote the endpoints of the $i^{th}$ wire. Every point will have at most one link.</p>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>Output a line, either “panda is telling the truth…” or “the evil panda is lying again”.</p>
<blockquote>
</blockquote>
<h3 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">4 2</span><br><span class="line">0 1</span><br><span class="line">3 2</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">panda is telling the truth...</span><br></pre></td></tr></table></figure>
</blockquote>
<p>标签：$2-SAT$</p>
<h2 id="Translation"><a href="#Translation" class="headerlink" title="Translation"></a>Translation</h2><p>题目大意：$n$个数排成一圈，给出若干条两点间的线段，可以在圈内连，也可在圈外连，问能否使得无相交线段（端点相交不算）</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>本题是$2-SAT$的判定裸题。<br>把每条线段拆成两个点，即第$i$条为$i$和$i’$，分别代表$i$在圈内和在圈外。若线段$a$和$b$相交，则连边$a\to b’$，$a’\to b$，这样跑一个$tarjan$再判断$i$和$i’$是否在一个联通块内即可判断是否有冲突。</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 500</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, x[MAX_M+<span class="number">5</span>], y[MAX_M+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> dfn[MAX_M*<span class="number">2</span>+<span class="number">5</span>], low[MAX_M*<span class="number">2</span>+<span class="number">5</span>], id[MAX_M*<span class="number">2</span>+<span class="number">5</span>], index, cnt;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_M*<span class="number">2</span>+<span class="number">5</span>];</span><br><span class="line"><span class="built_in">stack</span> &lt;<span class="keyword">int</span>&gt; sta;</span><br><span class="line"><span class="keyword">bool</span> insta[MAX_M*<span class="number">2</span>+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">	dfn[u] = low[u] = ++index;</span><br><span class="line">	sta.push(u), insta[u] = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> v = G[u][i];</span><br><span class="line">		<span class="keyword">if</span> (!dfn[v])	tarjan(v), low[u] = min(low[u], low[v]);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (insta[v])	low[u] = min(low[u], dfn[v]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (dfn[u] == low[u]) &#123;</span><br><span class="line">		cnt++;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = sta.top(); ; i = sta.top()) &#123;</span><br><span class="line">			id[i] = cnt;</span><br><span class="line">			sta.pop();</span><br><span class="line">			<span class="keyword">if</span> (i == u)	<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= m; i++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt; i; j++)</span><br><span class="line">			<span class="keyword">if</span> ((x[i] &lt;= x[j] &amp;&amp; y[i] &gt;= x[j] &amp;&amp; y[i] &lt;= y[j]) || (x[i] &gt;= x[j] &amp;&amp; x[i] &lt;= y[j] &amp;&amp; y[i] &gt;= y[j]))</span><br><span class="line">				G[i].push_back(j+m), G[j].push_back(i+m), G[i+m].push_back(j), G[j+m].push_back(i);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">check</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)</span><br><span class="line">		<span class="keyword">if</span> (id[i] == id[i+m])</span><br><span class="line">			<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x[i], &amp;y[i]);</span><br><span class="line">		<span class="keyword">if</span> (x[i] &gt; y[i])	swap(x[i], y[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	build();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m*<span class="number">2</span>; i++)</span><br><span class="line">		<span class="keyword">if</span> (!dfn[i])</span><br><span class="line">			tarjan(i);</span><br><span class="line">	<span class="keyword">if</span> (check())	<span class="built_in">printf</span>(<span class="string">"panda is telling the truth...\n"</span>);</span><br><span class="line">	<span class="keyword">else</span>	<span class="built_in">printf</span>(<span class="string">"the evil panda is lying again\n"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/10/10/20171001-08总结/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Azrael_Death">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NIRVANA">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/10/10/20171001-08总结/" itemprop="url">201701001-08总结</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-10-10T00:00:00+08:00">
                2017-10-10
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="长沙雅礼中学2017国庆训练滚粗记"><a href="#长沙雅礼中学2017国庆训练滚粗记" class="headerlink" title="长沙雅礼中学2017国庆训练滚粗记"></a>长沙雅礼中学2017国庆训练滚粗记</h1><ul>
<li>兴致勃勃地去，遍体鳞伤地回……</li>
<li>八场考试爆六场，水题全都没做起……</li>
</ul>
<h2 id="Day-1"><a href="#Day-1" class="headerlink" title="Day 1"></a>Day 1</h2><p>上午三道水题<br>T1好简单，数轴上画圆，转化成线段覆盖。然而我并没有看出来~,,ԾㅂԾ,,~<br>T2T3在哪里见过一样…突然意识到是暑假讲过的题。<br>T2线段树套路题。并没有想起来正解，考完意识到是傻逼暴力修改。<br>T3数位DP，搞方程一小时没肝出来。</p>
<p>中午颓颓颓</p>
<p>下午讲YSY讲DP<br>花了一个半小时把上午的题改了，成功跳过了DP基础部分。<br>后面的题挺有意思。发现若干道FindStr讲过的题和BZOJ原题。最后一道没听懂。</p>
<p>晚上讲了三道难题，听得半懂，口胡AC</p>
<h2 id="Day-2"><a href="#Day-2" class="headerlink" title="Day 2"></a>Day 2</h2><p>上午两道水题+一道数论<br>T1显然是DP，撸方程一个半小时没肝出来，果断打了BF<br>T2肯定图论，没想出正解，打了一个DFS分层，加上若干剪枝优化，并没骗到分<br>T3乍一看容斥或莫比乌斯反演…等等这是NOIp模拟啊…果断放掉推反演，搞半天打了BF。结果标解是反演…ヾ(≧へ≦)〃<br>又水了低保分</p>
<p>中午颓颓颓</p>
<p>下午YSY讲数论<br>先改了一个半小时题，发现YSY把我会的都讲完了。接着就开始讲莫比乌斯反演等省选内容。<br>出发后第一次怀疑这不是NOIp集训…</p>
<p>晚上讲了三道有意思的题，口胡AC</p>
<h2 id="Day-3"><a href="#Day-3" class="headerlink" title="Day 3"></a>Day 3</h2><p>上午一道原题+两道正常题<br>T1一看是线段树，感觉好熟悉，应该是原题，然后就忘了标解了…<br>考完YY说这题我当时给他讲过，他印象可深了。然而我作为讲题人居然忘了…对我的智商和记忆力深表怀疑。<br>此题正解：弱智线段树x26，卡常。<br>T2显然是DP，然而题目叙述不清楚，一半的人都读错了（including孔爷），读错之后太复杂，根本无法推DP，所以暴力也错了，怀疑样例耗掉半小时…<br>T3是二进制题，可能会用字典树或者bitset，博弈逻辑搅半天，并未发现那个看似复杂的操作就是循环移位。忘了异或的套路，时间不够打了BF。</p>
<p>中午颓颓颓</p>
<p>下午YSY讲贪心分治<br>今天很正常，大概是NOIp难度。发现几道做过的题。出发后第一次有了NOIp集训营的感觉而非省选集训营。</p>
<p>晚上讲题人的“水题选讲”难度定位在省选+<br>三道数论恶心题，推公式几大页PPT，完全没懂。<br>安慰自己，省选之前不会有这些鬼东西。</p>
<h2 id="Day-4"><a href="#Day-4" class="headerlink" title="Day 4"></a>Day 4</h2><p>上午两道水题+一道原题<br>T1裸约瑟夫，结果忘了当时初二自己是怎么推递推式的了…<br>T2树状数组，虽然被题面旁边的少女骚扰了半天，还是很快发现这是道水题，树状数组打出来。<br>结果忘写IObuf，被毒瘤出题人卡常…<br>T3是经典DP题，然而我并没有做过，考试也没想到，只会求最大值不会输出方案。<br>看到正解觉得好憋屈，方程都一样，就是没时间想回溯输出了。</p>
<p>中午颓颓颓</p>
<p>下午雅礼学长讲搜索<br>题目也很正常，大多就是剪枝启发式之类。出发后第二次也是最后一次有了NOIp集训营的感觉。</p>
<p>晚上由于端午没讲题<br>颓颓颓</p>
<h2 id="Day-5"><a href="#Day-5" class="headerlink" title="Day 5"></a>Day 5</h2><p>上午三道正常题<br>T1图上DP，很好推，但是转移忘写位运算，强行把复杂度写丑了…<br>T2字符串，可以证明不会有无解，所以随机化乱搞。当时并没有想到，于是倒着暴力搜，居然过了…WTF<br>T3是树形DP，但是比较难想，而且复杂度会爆。并没有写出来。下午讲题才发现这个DP有最优策略，退化成贪心。</p>
<p>中午颓颓颓</p>
<p>下午听WHX讲数论<br>听到一半果断改题。至于原因吗…完全听不懂，除了基础能懂以外，全都不会用。这已经有省选+的难度了。最后居然讲起了神技Min-Max容斥…<br>WHX还超时一小时，强行占吃饭时间讲了线性代数/(ㄒoㄒ)/~~</p>
<p>晚上听杂题<br>今天的题比较正常，NOIp+难度，可以听懂，没太大问题</p>
<h2 id="Day-6"><a href="#Day-6" class="headerlink" title="Day 6"></a>Day 6</h2><p>上午三道省选-题<br>T1看到“最小距离最大值”就去想二分答案，结果复杂度还是爆了，强行加了个优化，把最好复杂度优化了。本来以为会GG，结果居然过了。出题人表示很诧异，此题正解prime生成树<br>T2知道是DP，但就是没推出方程。时间不够了，果断打BF。<br>T3看表达式应该是斜率凸包，但是在树上维护凸包我只会暴力弹栈，复杂度跟暴力差不多，于是打了BF。考完看到打暴力弹栈被卡得跟裸暴力一样的同学觉得自己赚了。</p>
<p>中午颓颓颓</p>
<p>下午听WHX讲杂题<br>题目很好，思维很巧妙，涨姿势了。<br>懒癌一题没听懂，其他题大概懂了，口胡AC。</p>
<p>晚上讲三道AtCoder题<br>前两题能听懂，比较巧妙。<br>最后一道分形，很有意思，半懂半懂。</p>
<h2 id="Day-7"><a href="#Day-7" class="headerlink" title="Day 7"></a>Day 7</h2><p>上午三道数学题，预测到自己肯定GG<br>T1期望题，不太好证明，但是打表很好发现规律，然而我考试并没有打表。<br>T2DP题，考虑漏了情况，打了个贪心，然后自己把自己卡掉了…<br>T3看到三维凸包+期望就知道没搞。<br>考完出题人说这套题比前两天简单…蛤？</p>
<p>中午颓颓颓</p>
<p>下午听WHX讲图论<br>一开始挺简单，但是开始讲定理就懵了。<br>倒是听懂了若干道网络流建模题。</p>
<p>晚上三道杂题<br>发现一道YJQ讲过的博弈论原题，其他题目比较正常</p>
<h2 id="Day-8"><a href="#Day-8" class="headerlink" title="Day 8"></a>Day 8</h2><p>上午三道NOIp+题目<br>出题人在P1说题目按字典序排序，结果我一来就挑了最难的题做…然后GG<br>T1按边DFS，拆掉返祖边，然后树形DP<br>T2AtCoder智商题，先转化然后DP，连转换都没想到<br>T3结论题，没推出结论，也没找规律，GG</p>
<p>中午颓颓颓</p>
<p>下午听h10讲几何<br>都懂了，但是不会写，而且旋转卡壳和半平面交是NOIp内容吗？懵逼ing</p>
<p>晚上听了四道杂题<br>大概都懂了，但是只能口胡AC。唯一一道能写的在BZOJ上是权限题…</p>
<h2 id="Conclusion"><a href="#Conclusion" class="headerlink" title="Conclusion"></a>Conclusion</h2><p>八天爆六天，成功滚粗…<br>看来九月份没停课还是很要命的，完全没了做题的感觉，没怎么深入地想。<br>十月份慢慢复习调整，把学FFT和后缀自动机的计划再往后推一推。</p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/29/洛谷模板汇总/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Azrael_Death">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NIRVANA">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/29/洛谷模板汇总/" itemprop="url">【福利】洛谷模板汇总</a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-29T00:00:00+08:00">
                2017-09-29
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Graph-Theory"><a href="#Graph-Theory" class="headerlink" title="Graph Theory"></a>Graph Theory</h1><h2 id="Disjoint-Set"><a href="#Disjoint-Set" class="headerlink" title="Disjoint Set"></a>Disjoint Set</h2><blockquote>
<p>【模板】并查集</p>
</blockquote>
<p>题目描述<br>如题，现在有一个并查集，你需要完成合并和查询操作。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含两个整数N、M，表示共有N个元素和M个操作。<br>接下来M行，每行包含三个整数Zi、Xi、Yi<br>当Zi=1时，将Xi与Yi所在的集合合并<br>当Zi=2时，输出Xi与Yi是否在同一集合内，是的话输出Y；否则话输出N<br>输出格式：<br>如上，对于每一个Zi=2的操作，都有一行输出，每行包含一个大写字母，为Y或者N</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>4 7<br>2 1 2<br>1 1 2<br>2 1 2<br>1 3 4<br>2 1 4<br>1 2 3<br>2 1 4<br>输出样例：<br>N<br>Y<br>N<br>Y</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>数据规模：<br>对于30%的数据，N&lt;=10，M&lt;=20；<br>对于70%的数据，N&lt;=100，M&lt;=1000；<br>对于100%的数据，N&lt;=10000，M&lt;=200000。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 10000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, f, x, y, father[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getfather</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (father[v] == v) &#123;</span><br><span class="line">        <span class="keyword">return</span> v;</span><br><span class="line">    &#125;</span><br><span class="line">    father[v] = getfather(father[v]);</span><br><span class="line">    <span class="keyword">return</span> father[v];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        father[i] = i;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; f &gt;&gt; x &gt;&gt; y;</span><br><span class="line">        <span class="keyword">if</span> (f == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> f1 = getfather(x);</span><br><span class="line">            <span class="keyword">int</span> f2 = getfather(y);</span><br><span class="line">            <span class="keyword">if</span> (f1 != f2) &#123;</span><br><span class="line">                father[f1] = f2;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">int</span> f1 = getfather(x);</span><br><span class="line">            <span class="keyword">int</span> f2 = getfather(y);</span><br><span class="line">            <span class="keyword">if</span> (f1 != f2) &#123;</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">"N"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="built_in">cout</span> &lt;&lt; <span class="string">"Y"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Minimum-Spanning-Tree"><a href="#Minimum-Spanning-Tree" class="headerlink" title="Minimum Spanning Tree"></a>Minimum Spanning Tree</h2><blockquote>
<p>【模板】最小生成树</p>
</blockquote>
<p>题目描述<br>如题，给出一个无向图，求出最小生成树，如果该图不连通，则输出orz</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含两个整数N、M，表示该图共有N个结点和M条无向边。（N&lt;=5000，M&lt;=200000）<br>接下来M行每行包含三个整数Xi、Yi、Zi，表示有一条长度为Zi的无向边连接结点Xi、Yi<br>输出格式：<br>输出包含一个数，即最小生成树的各边的长度之和；如果该图不连通则输出orz</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>4 5<br>1 2 2<br>1 3 2<br>1 4 3<br>2 3 4<br>3 4 3<br>输出样例：<br>7</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>数据规模：<br>对于20%的数据：N&lt;=5，M&lt;=20<br>对于40%的数据：N&lt;=50，M&lt;=2500<br>对于70%的数据：N&lt;=500，M&lt;=10000<br>对于100%的数据：N&lt;=5000，M&lt;=200000</p>
<h3 id="Kruskal"><a href="#Kruskal" class="headerlink" title="Kruskal"></a>Kruskal</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 5000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 200000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> u, v, l;</span><br><span class="line">&#125; edge[MAX_M+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> n, m, tot = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> father[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">comp</span><span class="params">(<span class="keyword">const</span> node &amp;a, <span class="keyword">const</span> node &amp;b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> a.l &lt; b.l;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getfather</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (father[v] == v) &#123;</span><br><span class="line">		<span class="keyword">return</span> v;</span><br><span class="line">	&#125;</span><br><span class="line">	father[v] = getfather(father[v]);</span><br><span class="line">	<span class="keyword">return</span> father[v];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; edge[i].u &gt;&gt; edge[i].v &gt;&gt; edge[i].l;</span><br><span class="line">	&#125;</span><br><span class="line">	sort(edge, edge+m, comp);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	father[i] = i;</span><br><span class="line">	<span class="keyword">int</span> flag = n<span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> f1 = getfather(edge[i].u);</span><br><span class="line">		<span class="keyword">int</span> f2 = getfather(edge[i].v);</span><br><span class="line">		<span class="keyword">if</span> (f1 != f2) &#123;</span><br><span class="line">			father[f1] = f2;</span><br><span class="line">			tot += edge[i].l;</span><br><span class="line">			flag--;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (flag == <span class="number">0</span>)	<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (flag == <span class="number">0</span>) &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; tot;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; <span class="string">"orz"</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="Prim"><a href="#Prim" class="headerlink" title="Prim"></a>Prim</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 5000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2147483647</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_N+<span class="number">5</span>], E[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> n, m, dis[MAX_N+<span class="number">5</span>], tot;	<span class="keyword">bool</span> col[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> c)</span> </span>&#123;G[u].push_back(v), E[u].push_back(c);&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Prim</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) dis[i] = INF;	dis[<span class="number">1</span>] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, u = <span class="number">-1</span>; i &lt;= n; i++, u = <span class="number">-1</span>) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++)</span><br><span class="line">			<span class="keyword">if</span> (!col[j] &amp;&amp; (u == <span class="number">-1</span> || dis[u] &gt; dis[j]))	u = j;</span><br><span class="line">		col[u] = <span class="literal">true</span>, tot += dis[u];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; (<span class="keyword">int</span>)G[u].size(); j++) &#123;</span><br><span class="line">			<span class="keyword">int</span> v = G[u][j], c = E[u][j];</span><br><span class="line">			<span class="keyword">if</span> (!col[v] &amp;&amp; dis[v] &gt; c)	dis[v] = c;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, u, v, c; i &lt; m; i++)</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;u, &amp;v, &amp;c), addedge(u, v, c), addedge(v, u, c);</span><br><span class="line">	Prim();	<span class="built_in">printf</span>(<span class="string">"%d"</span>, tot);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Shortest-Path"><a href="#Shortest-Path" class="headerlink" title="Shortest Path"></a>Shortest Path</h2><blockquote>
<p>【模板】单源最短路径</p>
</blockquote>
<p>题目描述<br>如题，给出一个有向图，请输出从某一点出发到所有点的最短路径长度。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含三个整数N、M、S，分别表示点的个数、有向边的个数、出发点的编号。<br>接下来M行每行包含三个整数Fi、Gi、Wi，分别表示第i条有向边的出发点、目标点和长度。<br>输出格式：<br>一行，包含N个用空格分隔的整数，其中第i个整数表示从点S出发到点i的最短路径长度（若S=i则最短路径长度为0，若从点S无法到达点i，则最短路径长度为2147483647）</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>4 6 1<br>1 2 2<br>2 3 2<br>2 4 1<br>1 3 5<br>3 4 3<br>1 4 4<br>输出样例：<br>0 2 4 3</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>数据规模：<br>对于20%的数据：N&lt;=5，M&lt;=15<br>对于40%的数据：N&lt;=100，M&lt;=10000<br>对于70%的数据：N&lt;=1000，M&lt;=100000<br>对于100%的数据：N&lt;=10000，M&lt;=500000</p>
<h3 id="Dijkstra"><a href="#Dijkstra" class="headerlink" title="Dijkstra"></a>Dijkstra</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 10000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2147483647</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> pii pair <span class="meta-string">&lt;int, int&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> mp make_pair</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> fir first</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> sec second</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, s, dis[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_N+<span class="number">5</span>], E[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">addedge</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> c)</span> </span>&#123;G[u].push_back(v), E[u].push_back(c);&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Dijkstra</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	dis[i] = INF;	dis[s] = <span class="number">0</span>;</span><br><span class="line">	priority_queue &lt;pii&gt; que;	que.push(mp(<span class="number">0</span>, s));</span><br><span class="line">	<span class="keyword">while</span> (!que.empty()) &#123;</span><br><span class="line">		<span class="keyword">int</span> u = que.top().sec, d = que.top().fir;</span><br><span class="line">		que.pop();	<span class="keyword">if</span> (dis[u] != -d)	<span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; (<span class="keyword">int</span>)G[u].size(); i++) &#123;</span><br><span class="line">			<span class="keyword">int</span> v = G[u][i], c = E[u][i];</span><br><span class="line">			<span class="keyword">if</span> (dis[u]+c &gt;= dis[v])	<span class="keyword">continue</span>;</span><br><span class="line">			dis[v] = dis[u]+c, que.push(mp(-dis[v], v));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;s);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>, u, v, c; i &lt; m; i++)</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;u, &amp;v, &amp;c), addedge(u, v, c);</span><br><span class="line">	Dijkstra();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">printf</span>(<span class="string">"%d "</span>, dis[i]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="SPFA"><a href="#SPFA" class="headerlink" title="SPFA"></a>SPFA</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 500000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 10000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2147483647</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> v, len, next;</span><br><span class="line">	node() &#123;</span><br><span class="line">		v = len = next = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; edge[MAX_M+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> n, m, s;</span><br><span class="line"><span class="keyword">int</span> first[MAX_N+<span class="number">5</span>], cnt = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">int</span> dis[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> l)</span> </span>&#123;</span><br><span class="line">	cnt++;</span><br><span class="line">	edge[cnt].v = v;</span><br><span class="line">	edge[cnt].len = l;</span><br><span class="line">	edge[cnt].next = first[u];</span><br><span class="line">	first[u] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SPFA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">		dis[i] = INF;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> que[MAX_N*<span class="number">20</span>+<span class="number">5</span>], mark[MAX_N+<span class="number">5</span>];</span><br><span class="line">	<span class="keyword">int</span> head = <span class="number">0</span>, tail = <span class="number">1</span>;</span><br><span class="line">	<span class="built_in">memset</span>(mark, <span class="number">0</span>, <span class="keyword">sizeof</span>(mark));</span><br><span class="line">	que[<span class="number">1</span>] = s;</span><br><span class="line">	mark[s] = <span class="number">1</span>;</span><br><span class="line">	dis[s] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (head &lt;= tail) &#123;</span><br><span class="line">		head++;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> tmp = first[que[head]]; tmp; tmp = edge[tmp].next) &#123;</span><br><span class="line">			<span class="keyword">if</span> (dis[que[head]]+edge[tmp].len &lt; dis[edge[tmp].v]) &#123;</span><br><span class="line">				dis[edge[tmp].v] = dis[que[head]]+edge[tmp].len;</span><br><span class="line">				<span class="keyword">if</span> (mark[edge[tmp].v] == <span class="number">0</span>) &#123;</span><br><span class="line">					mark[edge[tmp].v] = <span class="number">1</span>;</span><br><span class="line">					tail++;</span><br><span class="line">					que[tail] = edge[tmp].v;</span><br><span class="line">				&#125;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		mark[que[head]] = <span class="number">0</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; s;</span><br><span class="line">	<span class="built_in">memset</span>(first, <span class="number">0</span>, <span class="keyword">sizeof</span>(first));</span><br><span class="line">	<span class="keyword">int</span> u, v, l;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v &gt;&gt; l;</span><br><span class="line">		insert(u, v, l);</span><br><span class="line">	&#125;</span><br><span class="line">	SPFA();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; dis[i] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Tarjan"><a href="#Tarjan" class="headerlink" title="Tarjan"></a>Tarjan</h2><blockquote>
<p>【模板】缩点</p>
</blockquote>
<p>题目背景<br>缩点+DP</p>
<blockquote>
</blockquote>
<p>题目描述<br>给定一个n个点m条边有向图，每个点有一个权值，求一条路径，使路径经过的点权值之和最大。你只需要求出这个权值和。<br>允许多次经过一条边或者一个点，但是，重复经过的点，权值只计算一次。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行，n,m<br>第二行，n个整数，依次代表点权<br>第三至m+2行，每行两个整数u,v，表示u-&gt;v有一条有向边<br>输出格式：<br>共一行，最大的点权之和。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>2 2<br>1 1<br>1 2<br>2 1<br>输出样例：<br>2</p>
<blockquote>
</blockquote>
<p>说明<br>n&lt;=10^4,m&lt;=10^5,|点权|&lt;=1000 算法：Tarjan缩点+DAGdp<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stack&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, c[MAX_N+<span class="number">5</span>], f[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> dfn[MAX_N+<span class="number">5</span>], low[MAX_N+<span class="number">5</span>], col[MAX_N+<span class="number">5</span>], val[MAX_N+<span class="number">5</span>], ind, cnt;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_N+<span class="number">5</span>], E[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="built_in">stack</span> &lt;<span class="keyword">int</span>&gt; sta;</span><br><span class="line"><span class="keyword">bool</span> insta[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">tarjan</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">	dfn[u] = low[u] = ++ind, sta.push(u), insta[u] = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> v = G[u][i];</span><br><span class="line">		<span class="keyword">if</span> (!dfn[v])	tarjan(v), low[u] = min(low[u], low[v]);</span><br><span class="line">		<span class="keyword">else</span> <span class="keyword">if</span> (insta[v])	low[u] = min(low[u], dfn[v]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (dfn[u] == low[u]) &#123;</span><br><span class="line">		cnt++;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = sta.top(); ; i = sta.top()) &#123;</span><br><span class="line">			col[i] = cnt, val[cnt] += c[i], insta[i] = <span class="literal">false</span>;</span><br><span class="line">			sta.pop();	<span class="keyword">if</span> (u == i)	<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (f[u])	<span class="keyword">return</span> f[u];</span><br><span class="line">	<span class="keyword">int</span> mx = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; E[u].size(); i++)	mx = max(mx, DFS(E[u][i]));</span><br><span class="line">	<span class="keyword">return</span> f[u] = val[u]+mx;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;c[i]);</span><br><span class="line">	<span class="keyword">while</span> (m--) &#123;</span><br><span class="line">		<span class="keyword">int</span> u, v;	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v);</span><br><span class="line">		G[u].push_back(v);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)</span><br><span class="line">		<span class="keyword">if</span> (!dfn[i])	tarjan(i);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> u = <span class="number">1</span>; u &lt;= n; u++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</span><br><span class="line">			<span class="keyword">int</span> v = G[u][i];	<span class="keyword">if</span> (col[u] == col[v])	<span class="keyword">continue</span>;</span><br><span class="line">			E[col[u]].push_back(col[v]);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; i++)</span><br><span class="line">		<span class="keyword">if</span> (!f[i])	ans = max(ans, DFS(i));</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d"</span>, ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Cur-Vertex"><a href="#Cur-Vertex" class="headerlink" title="Cur Vertex"></a>Cur Vertex</h2><blockquote>
<p>【模板】割点</p>
</blockquote>
<p>题目描述<br>给出一个n个点，m条边的无向图，求图的割点。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行输入n，m<br>下面m行每行输入x，y表示x到y有一条边<br>输出格式：<br>第一行输出割点个数<br>第二行按照节点编号从小到大输出节点，用空格隔开</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>6 7<br>1 2<br>1 3<br>1 4<br>2 5<br>3 5<br>4 5<br>5 6<br>输出样例：<br>1<br>5</p>
<blockquote>
</blockquote>
<p>说明<br>n，m均为100000<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 200000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">    <span class="keyword">int</span> v, next;</span><br><span class="line">&#125; edge[MAX_M+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> first[MAX_N+<span class="number">5</span>], flag[MAX_N+<span class="number">5</span>], num[MAX_N+<span class="number">5</span>], low[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> n, m, cnt = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">    edge[pos].next = first[u];</span><br><span class="line">    edge[pos].v = v;</span><br><span class="line">    first[u] = pos;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">dfs</span><span class="params">(<span class="keyword">int</span> cur, <span class="keyword">int</span> father)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> child = <span class="number">0</span>;</span><br><span class="line">    num[cur] = low[cur] = ++cnt;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> tmp = first[cur]; tmp; tmp = edge[tmp].next) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!num[edge[tmp].v]) &#123;</span><br><span class="line">            child++;</span><br><span class="line">            dfs(edge[tmp].v, cur);</span><br><span class="line">            low[cur] = min(low[cur], low[edge[tmp].v]);</span><br><span class="line">            <span class="keyword">if</span> (low[edge[tmp].v] &gt;= num[cur]) &#123;</span><br><span class="line">                flag[cur] = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (num[edge[tmp].v] &lt; num[cur] &amp;&amp; edge[tmp].v != father) &#123;</span><br><span class="line">            low[cur] = min(low[cur], num[edge[tmp].v]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (father == <span class="number">-1</span> &amp;&amp; child == <span class="number">1</span>) &#123;</span><br><span class="line">        flag[cur] = <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> u, v;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v;</span><br><span class="line">        insert(u, v, i*<span class="number">2</span>+<span class="number">1</span>);</span><br><span class="line">        insert(v, u, i*<span class="number">2</span>+<span class="number">2</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> tot = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (!num[i]) &#123;</span><br><span class="line">            dfs(i, <span class="number">-1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (flag[i]) &#123;</span><br><span class="line">            tot++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">cout</span> &lt;&lt; tot &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (flag[i]) &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; i &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Lowest-Common-Ancestor"><a href="#Lowest-Common-Ancestor" class="headerlink" title="Lowest Common Ancestor"></a>Lowest Common Ancestor</h2><blockquote>
<p>【模板】最近公共祖先 LCA</p>
</blockquote>
<p>题目描述<br>如题，给定一棵有根多叉树，请求出指定两个点直接最近的公共祖先。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含三个正整数N、M、S，分别表示树的结点个数、询问的个数和树根结点的序号。<br>接下来N-1行每行包含两个正整数x、y，表示x结点和y结点之间有一条直接连接的边（数据保证可以构成树）。<br>接下来M行每行包含两个正整数a、b，表示询问a结点和b结点的最近公共祖先。<br>输出格式：<br>输出包含M行，每行包含一个正整数，依次为每一个询问的结果。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>5 5 4<br>3 1<br>2 4<br>5 1<br>1 4<br>2 4<br>3 2<br>3 5<br>1 2<br>4 5<br>输出样例：<br>4<br>4<br>1<br>4<br>4</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>数据规模：<br>对于30%的数据：N&lt;=10，M&lt;=10<br>对于70%的数据：N&lt;=10000，M&lt;=10000<br>对于100%的数据：N&lt;=500000，M&lt;=500000</p>
<h3 id="Multiplication"><a href="#Multiplication" class="headerlink" title="Multiplication"></a>Multiplication</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 500000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Edge</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> next, to;</span><br><span class="line">&#125; edge[(MAX_N&lt;&lt;<span class="number">1</span>)+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> n, m, s, x, y, cnt;</span><br><span class="line"><span class="keyword">int</span> d[MAX_N+<span class="number">5</span>], p[MAX_N+<span class="number">5</span>][<span class="number">25</span>], first[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">bool</span> vis[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">int</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;	<span class="keyword">char</span> ch = getchar();</span><br><span class="line">	<span class="keyword">while</span> (ch &lt; <span class="string">'0'</span> || ch &gt; <span class="string">'9'</span>)	ch = getchar();</span><br><span class="line">	<span class="keyword">while</span> (ch &gt;= <span class="string">'0'</span> &amp;&amp; ch &lt;= <span class="string">'9'</span>)	ret = ret*<span class="number">10</span>+ch-<span class="string">'0'</span>, ch = getchar();</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">INSERT</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">	edge[++cnt].next = first[a];</span><br><span class="line">	edge[cnt].to = b;</span><br><span class="line">	first[a] = cnt;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">	vis[u] = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; (<span class="number">1</span>&lt;&lt;i) &lt;= n; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> ((<span class="number">1</span>&lt;&lt;i) &lt;= d[u]) &#123;</span><br><span class="line">			p[u][i] = p[p[u][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i; i = edge[i].next) &#123;</span><br><span class="line">		<span class="keyword">int</span> v = edge[i].to;</span><br><span class="line">		<span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">			d[v] = d[u]+<span class="number">1</span>;</span><br><span class="line">			p[v][<span class="number">0</span>] = u;</span><br><span class="line">			DFS(v);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> i, j;</span><br><span class="line">	<span class="keyword">if</span> (d[a] &lt; d[b])	swap(a, b);</span><br><span class="line">	<span class="keyword">for</span> (i = <span class="number">0</span>; (<span class="number">1</span>&lt;&lt;i) &lt;= d[a]; i++) &#123;&#125;</span><br><span class="line">	i--;</span><br><span class="line">	<span class="keyword">for</span> (j = i; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (d[a]-(<span class="number">1</span>&lt;&lt;j) &gt;= d[b]) &#123;</span><br><span class="line">			a = p[a][j];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (a == b) &#123;</span><br><span class="line">		<span class="keyword">return</span> a;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (j = i; j &gt;= <span class="number">0</span>; j--) &#123;</span><br><span class="line">		<span class="keyword">if</span> (p[a][j] != p[b][j]) &#123;</span><br><span class="line">			a = p[a][j];</span><br><span class="line">			b = p[b][j];</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> p[a][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	n = read(), m = read(), s = read();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">		x = read(), y = read();</span><br><span class="line">		INSERT(x, y);</span><br><span class="line">		INSERT(y, x);</span><br><span class="line">	&#125;</span><br><span class="line">	DFS(s);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">		x = read(), y = read();</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; LCA(x, y) &lt;&lt; <span class="built_in">endl</span>; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="TreeChainDivision"><a href="#TreeChainDivision" class="headerlink" title="TreeChainDivision"></a>TreeChainDivision</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 500000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> n, m, r, dep[MAX_N+<span class="number">5</span>], sz[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> fa[MAX_N+<span class="number">5</span>], son[MAX_N+<span class="number">5</span>], top[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">	sz[u] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> v : G[u]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (v == fa[u])	<span class="keyword">continue</span>;</span><br><span class="line">		fa[v] = u, dep[v] = dep[u]+<span class="number">1</span>, DFS(v), sz[u] += sz[v];</span><br><span class="line">		<span class="keyword">if</span> (!son[u] || sz[son[u]] &lt; sz[v])	son[u] = v;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> tp)</span> </span>&#123;</span><br><span class="line">	top[u] = tp;	<span class="keyword">if</span> (son[u])	DFS(son[u], tp);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">auto</span> v : G[u])	<span class="keyword">if</span> ((v^fa[u]) &amp;&amp; (v^son[u]))	DFS(v, v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (top[u]^top[v])</span><br><span class="line">		<span class="keyword">if</span> (dep[top[u]] &gt; dep[top[v]])	u = fa[top[u]];</span><br><span class="line">		<span class="keyword">else</span>	v = fa[top[v]];</span><br><span class="line">	<span class="keyword">return</span> dep[u] &lt; dep[v] ? u : v;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n, &amp;m, &amp;r);	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, u, v; i &lt; n; i++) <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v), G[u].push_back(v), G[v].push_back(u);</span><br><span class="line">	DFS(r), DFS(r, r);	<span class="keyword">while</span> (m--) &#123;<span class="keyword">int</span> u, v;	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v);	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, LCA(u, v));&#125;	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="Negative-Loop"><a href="#Negative-Loop" class="headerlink" title="Negative Loop"></a>Negative Loop</h2><blockquote>
<p>【模板】负环</p>
</blockquote>
<p>题目描述<br>暴力枚举/SPFA/Bellman-ford/奇怪的贪心/超神搜索</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行一个正整数T表示数据组数，对于每组数据：<br>第一行两个正整数N M，表示图有N个顶点，M条边<br>接下来M行，每行三个整数a b w，表示a-&gt;b有一条权值为w的边（若w&lt;0则为单向，否则双向）<br>输出格式：<br>共T行。对于每组数据，存在负环则输出一行”YE5”(不含引号)，否则输出一行”N0”(不含引号)。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例#1：<br>2<br>3 4<br>1 2 2<br>1 3 4<br>2 3 1<br>3 1 -3<br>3 3<br>1 2 3<br>2 3 4<br>3 1 -8<br>输出样例#1：<br>N0<br>YE5</p>
<blockquote>
</blockquote>
<p>说明<br>N,M,|w|≤200 000；1≤a,b≤N；T≤10 建议复制输出格式中的字符串。<br>此题普通Bellman-Ford或BFS-SPFA会TLE<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 200000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> SIZE 25000000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> f;	<span class="keyword">char</span> BUF[SIZE], *buf = BUF;</span><br><span class="line"><span class="function"><span class="keyword">inline</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">(<span class="keyword">int</span> &amp;x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">bool</span> flag = <span class="number">0</span>;	<span class="keyword">while</span> (*buf &lt; <span class="number">48</span>)	<span class="keyword">if</span> (*buf++ == <span class="number">45</span>)	flag = <span class="number">1</span>;</span><br><span class="line">	x = <span class="number">0</span>;	<span class="keyword">while</span> (*buf &gt; <span class="number">32</span>)	x = x*<span class="number">10</span>+*buf++<span class="number">-48</span>;	x = flag ? -x : x;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_N+<span class="number">5</span>], E[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> dis[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">bool</span> insta[MAX_N+<span class="number">5</span>], flag;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n)</span> </span>&#123;</span><br><span class="line">	flag = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	G[i].clear(), E[i].clear();</span><br><span class="line">	<span class="built_in">memset</span>(dis, <span class="number">0</span>, <span class="keyword">sizeof</span>(dis)), <span class="built_in">memset</span>(insta, <span class="literal">false</span>, <span class="keyword">sizeof</span>(insta));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">	insta[u] = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> v = G[u][i], c = E[u][i];</span><br><span class="line">		<span class="keyword">if</span> (dis[u]+c &gt;= dis[v])	<span class="keyword">continue</span>;</span><br><span class="line">		<span class="keyword">if</span> (insta[v] || flag) &#123;flag = <span class="literal">true</span>;	<span class="keyword">break</span>;&#125;</span><br><span class="line">		dis[v] = dis[u]+c, DFS(v);</span><br><span class="line">	&#125;</span><br><span class="line">	insta[u] = <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	f = fread(BUF, <span class="number">1</span>, SIZE, <span class="built_in">stdin</span>);</span><br><span class="line">	<span class="keyword">int</span> T;	read(T);</span><br><span class="line">	<span class="keyword">while</span> (T--) &#123;</span><br><span class="line">		<span class="keyword">int</span> n, m;	read(n), read(m);	init(n);</span><br><span class="line">		<span class="keyword">while</span> (m--) &#123;</span><br><span class="line">			<span class="keyword">int</span> u, v, c;	read(u), read(v), read(c);</span><br><span class="line">			G[u].push_back(v), E[u].push_back(c);</span><br><span class="line">			<span class="keyword">if</span> (c &gt;= <span class="number">0</span>)	G[v].push_back(u), E[v].push_back(c);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;DFS(i);	<span class="keyword">if</span> (flag)	<span class="keyword">break</span>;&#125;</span><br><span class="line">		<span class="keyword">if</span> (flag)	<span class="built_in">printf</span>(<span class="string">"YE5\n"</span>);</span><br><span class="line">		<span class="keyword">else</span>	<span class="built_in">printf</span>(<span class="string">"N0\n"</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Network-Flow-Dinic"><a href="#Network-Flow-Dinic" class="headerlink" title="Network Flow (Dinic)"></a>Network Flow (Dinic)</h2><blockquote>
<p>【模板】网络最大流</p>
</blockquote>
<p>题目描述<br>给出一个网络图，以及其源点和汇点，求出其网络最大流。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含四个正整数N、M、S、T，分别表示点的个数、有向边的个数、源点序号、汇点序号。<br>接下来M行每行包含三个正整数ui、vi、wi，表示第i条有向边从ui出发，到达vi，边权为wi（即该边最大流量为wi）</p>
<blockquote>
</blockquote>
<p>输出格式：<br>一行，包含一个正整数，即为该网络的最大流。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>4 5 4 3<br>4 2 30<br>4 3 20<br>2 3 20<br>2 1 30<br>1 3 40<br>输出样例：<br>50</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>数据规模：<br>对于30%的数据：N&lt;=10，M&lt;=25<br>对于70%的数据：N&lt;=200，M&lt;=1000<br>对于100%的数据：N&lt;=10000，M&lt;=100000<br>样例说明：<br>题目中存在3条路径：<br>4–&gt;2–&gt;3，该路线可通过20的流量<br>4–&gt;3，可通过20的流量<br>4–&gt;2–&gt;1–&gt;3，可通过10的流量（边4–&gt;2之前已经耗费了20的流量）<br>故流量总计20+20+10=50。输出50。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 10000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 100000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2147483647</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> v, c, next;</span><br><span class="line">&#125; E[MAX_M*<span class="number">2</span>+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> first[MAX_N+<span class="number">5</span>], cnt;</span><br><span class="line"><span class="keyword">int</span> n, m, s, t;</span><br><span class="line"><span class="keyword">int</span> d[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	cnt = <span class="number">0</span>;</span><br><span class="line">	<span class="built_in">memset</span>(first, <span class="number">-1</span>, <span class="keyword">sizeof</span>(first));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">	E[cnt].v = v, E[cnt].c = c;</span><br><span class="line">	E[cnt].next = first[u];</span><br><span class="line">	first[u] = cnt++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BFS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(d, <span class="number">-1</span>, <span class="keyword">sizeof</span>(d));</span><br><span class="line">	<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">	que.push(s);</span><br><span class="line">	d[s] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (!que.empty()) &#123;</span><br><span class="line">		<span class="keyword">int</span> u = que.front();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i != <span class="number">-1</span>; i = E[i].next) &#123;</span><br><span class="line">			<span class="keyword">int</span> v = E[i].v;</span><br><span class="line">			<span class="keyword">if</span> (E[i].c &amp;&amp; d[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">				que.push(v);</span><br><span class="line">				d[v] = d[u]+<span class="number">1</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		que.pop();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> d[t] != <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (u == t) &#123;</span><br><span class="line">		<span class="keyword">return</span> flow;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = first[u]; i != <span class="number">-1</span>; i = E[i].next) &#123;</span><br><span class="line">		<span class="keyword">int</span> v = E[i].v;</span><br><span class="line">		<span class="keyword">if</span> (E[i].c &amp;&amp; d[u]+<span class="number">1</span> == d[v]) &#123;</span><br><span class="line">			<span class="keyword">int</span> tmp = DFS(v, min(flow, E[i].c));</span><br><span class="line">			flow -= tmp, E[i].c -= tmp, ret += tmp;</span><br><span class="line">			E[i^<span class="number">1</span>].c += tmp;</span><br><span class="line">			<span class="keyword">if</span> (flow == <span class="number">0</span>)	<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (ret == <span class="number">0</span>)	d[u] = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	init();</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; s &gt;&gt; t;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> u, v, c;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; u &gt;&gt; v &gt;&gt; c;</span><br><span class="line">		insert(u, v, c);</span><br><span class="line">		insert(v, u, <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (BFS()) &#123;</span><br><span class="line">		ans += DFS(s, INF);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; ans;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Minimum-Cost-Maximum-Flow"><a href="#Minimum-Cost-Maximum-Flow" class="headerlink" title="Minimum Cost Maximum Flow"></a>Minimum Cost Maximum Flow</h2><blockquote>
<p>【模板】最小费用最大流</p>
</blockquote>
<p>题目描述<br>给出一个网络图，以及其源点和汇点，每条边已知其最大流量和单位流量费用，求出其网络最大流和在最大流情况下的最小费用。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含四个正整数N、M、S、T，分别表示点的个数、有向边的个数、源点序号、汇点序号。<br>接下来M行每行包含四个正整数ui、vi、wi、fi，表示第i条有向边从ui出发，到达vi，边权为wi（即该边最大流量为wi），单位流量的费用为fi。<br>输出格式：<br>一行，包含两个整数，依次为最大流量和在最大流量情况下的最小费用。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>4 5 4 3<br>4 2 30 2<br>4 3 20 3<br>2 3 20 1<br>2 1 30 9<br>1 3 40 5<br>输出样例：<br>50 280</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>（BYX：最后两个点改成了1200ms）<br>数据规模：<br>对于30%的数据：N&lt;=10，M&lt;=10<br>对于70%的数据：N&lt;=1000，M&lt;=1000<br>对于100%的数据：N&lt;=5000，M&lt;=50000<br>样例说明：<br>最优方案如下：<br>第一条流为4–&gt;3，流量为20，费用为3<em>20=60。<br>第二条流为4–&gt;2–&gt;3，流量为20，费用为（2+1）</em>20=60。<br>第三条流为4–&gt;2–&gt;1–&gt;3，流量为10，费用为（2+9+5）*10=160。<br>故最大流量为50，在此状况下最小费用为60+60+160=280。<br>故输出50 280。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 5000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 50000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2147483647</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, s, t, tot, ans;</span><br><span class="line"><span class="keyword">int</span> pre[MAX_N+<span class="number">5</span>], match[MAX_N+<span class="number">5</span>], cnt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span><span class="keyword">int</span> u, v, c, w, nxt;&#125; E[MAX_M*<span class="number">2</span>+MAX_N*<span class="number">2</span>+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;cnt = <span class="number">0</span>; <span class="built_in">memset</span>(pre, <span class="number">-1</span>, <span class="keyword">sizeof</span>(pre));&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> c, <span class="keyword">int</span> w)</span> </span>&#123;E[cnt].u = u, E[cnt].v = v, E[cnt].c = c, E[cnt].w = w, E[cnt].nxt = pre[u], pre[u] = cnt++;&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">SPFA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">	<span class="keyword">bool</span> inque[MAX_N+<span class="number">5</span>];</span><br><span class="line">	<span class="keyword">int</span> dis[MAX_N+<span class="number">5</span>], pree[MAX_N+<span class="number">5</span>];</span><br><span class="line">	<span class="built_in">memset</span>(inque, <span class="literal">false</span>, <span class="keyword">sizeof</span>(inque));</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	dis[i] = INF;</span><br><span class="line">	<span class="built_in">memset</span>(pree, <span class="number">-1</span>, <span class="keyword">sizeof</span>(pree));</span><br><span class="line">	dis[s] = <span class="number">0</span>, que.push(s), inque[s] = <span class="literal">true</span>;</span><br><span class="line">	<span class="keyword">while</span> (!que.empty()) &#123;</span><br><span class="line">		<span class="keyword">int</span> u = que.front();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = pre[u]; i != <span class="number">-1</span>; i = E[i].nxt) &#123;</span><br><span class="line">			<span class="keyword">int</span> v = E[i].v;</span><br><span class="line">			<span class="keyword">if</span> (E[i].c &amp;&amp; dis[u]+E[i].w &lt; dis[v]) &#123;</span><br><span class="line">				dis[v] = dis[u]+E[i].w, pree[v] = i;</span><br><span class="line">				<span class="keyword">if</span> (!inque[v])	que.push(v), inque[v] = <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		que.pop(), inque[u] = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (dis[t] == INF)	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">int</span> flow = INF;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = pree[t]; i != <span class="number">-1</span>; i = pree[E[i].u])	flow = min(flow, E[i].c);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = pree[t]; i != <span class="number">-1</span>; i = pree[E[i].u])	E[i].c -= flow, E[i^<span class="number">1</span>].c += flow;</span><br><span class="line">	tot += flow, ans += dis[t]*flow;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;n, &amp;m, &amp;s, &amp;t);</span><br><span class="line">	init();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> u, v, c, w;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;u, &amp;v, &amp;c, &amp;w);</span><br><span class="line">		insert(u, v, c, w), insert(v, u, <span class="number">0</span>, -w);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">while</span> (SPFA()) ;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d %d"</span>, tot, ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Bipartite-Matching"><a href="#Bipartite-Matching" class="headerlink" title="Bipartite Matching"></a>Bipartite Matching</h2><blockquote>
<p>【模板】二分图匹配</p>
</blockquote>
<p>题目描述<br>给定一个二分图，结点个数分别为n，m，边数为e，求二分图最大匹配数</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行，n，m，e<br>第二至e+1行，每行两个正整数u，v，表示u,v有一条连边<br>输出格式：<br>共一行，二分图最大匹配</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>1 1 1<br>1 1<br>输出样例：<br>1</p>
<blockquote>
</blockquote>
<p>说明<br>n,m&lt;=1000，1&lt;=u&lt;=n，1&lt;=v&lt;=m</p>
<h3 id="Hungary"><a href="#Hungary" class="headerlink" title="Hungary"></a>Hungary</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, e, match[MAX_N+<span class="number">5</span>], cnt;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">bool</span> vis[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> v = G[u][i];</span><br><span class="line">		<span class="keyword">if</span> (!vis[v]) &#123;</span><br><span class="line">			vis[v] = <span class="literal">true</span>;</span><br><span class="line">			<span class="keyword">if</span> (!match[v] || DFS(match[v])) &#123;</span><br><span class="line">				match[v] = u;</span><br><span class="line">				<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; e;</span><br><span class="line">	<span class="keyword">int</span> a, b;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; e; i++) &#123;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; a &gt;&gt; b;</span><br><span class="line">		<span class="keyword">if</span> (a &gt; n || b &gt; m)	<span class="keyword">continue</span>;</span><br><span class="line">		G[a].push_back(b);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">		<span class="built_in">memset</span>(vis, <span class="literal">false</span>, <span class="keyword">sizeof</span>(vis));</span><br><span class="line">		<span class="keyword">if</span> (DFS(i)) &#123;</span><br><span class="line">			cnt++;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; cnt;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="Dinic"><a href="#Dinic" class="headerlink" title="Dinic"></a>Dinic</h3><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 2000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 1000000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 2147483647</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, s, t, n1, n2;</span><br><span class="line"><span class="keyword">int</span> pre[MAX_N+<span class="number">5</span>], tmp[MAX_N+<span class="number">5</span>], d[MAX_N+<span class="number">5</span>], cnt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span><span class="keyword">int</span> v, c, nxt;&#125; E[MAX_M*<span class="number">2</span>+MAX_N*<span class="number">2</span>+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;cnt = <span class="number">0</span>; s = <span class="number">0</span>, t = n; <span class="built_in">memset</span>(pre, <span class="number">-1</span>, <span class="keyword">sizeof</span>(pre));&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> v, <span class="keyword">int</span> c)</span> </span>&#123;E[cnt].v = v, E[cnt].c = c, E[cnt].nxt = pre[u], pre[u] = cnt++;&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">BFS</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(d, <span class="number">-1</span>, <span class="keyword">sizeof</span>(d));</span><br><span class="line">	<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;</span><br><span class="line">	que.push(s), d[s] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (!que.empty()) &#123;</span><br><span class="line">		<span class="keyword">int</span> u = que.front();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = pre[u]; i != <span class="number">-1</span>; i = E[i].nxt) &#123;</span><br><span class="line">			<span class="keyword">int</span> v = E[i].v;</span><br><span class="line">			<span class="keyword">if</span> (E[i].c &amp;&amp; d[v] == <span class="number">-1</span>) &#123;</span><br><span class="line">				d[v] = d[u]+<span class="number">1</span>;</span><br><span class="line">				que.push(v);</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		que.pop();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> d[t] != <span class="number">-1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> flow)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (u == t)	<span class="keyword">return</span> flow;</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> &amp;i = pre[u]; i != <span class="number">-1</span>; i = E[i].nxt) &#123;</span><br><span class="line">		<span class="keyword">int</span> v = E[i].v;</span><br><span class="line">		<span class="keyword">if</span> (E[i].c &amp;&amp; d[u]+<span class="number">1</span> == d[v]) &#123;</span><br><span class="line">			<span class="keyword">int</span> tmp = DFS(v, min(flow, E[i].c));</span><br><span class="line">			E[i].c -= tmp, E[i^<span class="number">1</span>].c += tmp, flow -= tmp, ret += tmp;</span><br><span class="line">			<span class="keyword">if</span> (!flow)	<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (!ret)	d[u] = <span class="number">-1</span>;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">Dinic</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++)	tmp[i] = pre[i];</span><br><span class="line">	<span class="keyword">while</span> (BFS()) &#123;</span><br><span class="line">		ret += DFS(s, INF);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++)	pre[i] = tmp[i];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;n1, &amp;n2, &amp;m);	n = n1+n2+<span class="number">1</span>;</span><br><span class="line">	init();</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n1; i++)	insert(s, i, <span class="number">1</span>), insert(i, s, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = n1+<span class="number">1</span>; i &lt;= n1+n2; i++)	insert(i, t, <span class="number">1</span>), insert(t, i, <span class="number">0</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> u, v;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v);</span><br><span class="line">		<span class="keyword">if</span> (u &gt; n1 || v &gt; n2)	<span class="keyword">continue</span>;</span><br><span class="line">		insert(u, n1+v, <span class="number">1</span>), insert(n1+v, u, <span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d"</span>, Dinic());</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="Math-Theory"><a href="#Math-Theory" class="headerlink" title="Math Theory"></a>Math Theory</h1><h2 id="Gauss-Elimination"><a href="#Gauss-Elimination" class="headerlink" title="Gauss Elimination"></a>Gauss Elimination</h2><blockquote>
<p>【模板】高斯消元</p>
</blockquote>
<p>题目背景<br>Gauss消元</p>
<blockquote>
</blockquote>
<p>题目描述<br>给定一个线性方程组，对其求解</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行，一个正整数n<br>第二至n+1行，每行n+1个整数，为a1,a2,…an和b，代表一组方程。<br>输出格式：<br>共n行，每行一个数，第i行为xi（保留2位小数）<br>如果无解或不存在唯一解，在第一行输出”No Solution”.</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例#1：<br>3<br>1 3 4 5<br>1 4 7 3<br>9 3 2 2<br>输出样例#1：<br>-0.97<br>5.18<br>-2.39</p>
<blockquote>
</blockquote>
<p>说明<br>1≤n≤100，|ai|≤1e4，|b|≤1e4<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> EXP 1e-7</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">double</span> fnt;</span><br><span class="line"><span class="keyword">int</span> n;	<span class="built_in">vector</span> &lt;fnt&gt; f[MAX_N+<span class="number">5</span>];	fnt ans[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">gauss</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, tmp; i &lt;= n; i++) &#123;</span><br><span class="line">		<span class="keyword">for</span> (tmp = i; tmp &lt;= n; tmp++)	<span class="keyword">if</span> (f[tmp][i] &lt;= -EXP || f[tmp][i] &gt;= EXP)	<span class="keyword">break</span>;</span><br><span class="line">		<span class="keyword">if</span> (tmp &gt; n)	<span class="keyword">return</span> <span class="literal">false</span>;	swap(f[i], f[tmp]);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n; j++) &#123;</span><br><span class="line">			fnt div = f[j][i]/f[i][i];	<span class="keyword">if</span> (j == i)	<span class="keyword">continue</span>;</span><br><span class="line">			<span class="keyword">for</span> (<span class="keyword">int</span> k = i; k &lt;= n+<span class="number">1</span>; k++)	f[j][k] -= f[i][k]*div;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	ans[i] = f[i][n+<span class="number">1</span>]/f[i][i];</span><br><span class="line">	<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">		f[i].push_back(<span class="number">0</span>);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; j &lt;= n+<span class="number">1</span>; j++) &#123;</span><br><span class="line">			fnt x;	<span class="built_in">scanf</span>(<span class="string">"%lf"</span>, &amp;x);</span><br><span class="line">			f[i].push_back(x);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (gauss())	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">printf</span>(<span class="string">"%.2lf\n"</span>, ans[i]);</span><br><span class="line">	<span class="keyword">else</span>	<span class="built_in">printf</span>(<span class="string">"No Solution"</span>);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Inverse"><a href="#Inverse" class="headerlink" title="Inverse"></a>Inverse</h2><blockquote>
<p>【模板】乘法逆元</p>
</blockquote>
<p>题目背景<br>这是一道模板题</p>
<blockquote>
</blockquote>
<p>题目描述<br>给定n,p求1~n中所有整数在模p意义下的乘法逆元。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>一行n,p<br>输出格式：<br>n行,第i行表示i在模p意义下的逆元。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例#1：<br>10 13<br>输出样例#1：<br>1<br>7<br>9<br>10<br>8<br>11<br>2<br>5<br>3<br>4</p>
<blockquote>
</blockquote>
<p>说明<br>1≤n≤3*1e6,n&lt;p&lt;20000528<br>输入保证p为质数。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 3000000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lnt;</span><br><span class="line">lnt inv[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(<span class="keyword">int</span> n, lnt p)</span> </span>&#123;inv[<span class="number">0</span>] = inv[<span class="number">1</span>] = <span class="number">1</span>;	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++)	inv[i] = (p-p/i*inv[p%i]%p)%p;&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n;	lnt p;	<span class="built_in">scanf</span>(<span class="string">"%d%lld"</span>, &amp;n, &amp;p);</span><br><span class="line">	init(n, p);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, inv[i]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Linear-Basis"><a href="#Linear-Basis" class="headerlink" title="Linear Basis"></a>Linear Basis</h2><blockquote>
<p>【模板】线性基</p>
</blockquote>
<p>题目背景<br>这是一道模板题。</p>
<blockquote>
</blockquote>
<p>题目描述<br>给定n个整数（数字可能重复），求在这些数中选取任意个，使得他们的异或和最大。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行一个数n，表示元素个数<br>接下来一行n个数<br>输出格式：<br>仅一行，表示答案。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例#1：<br>2<br>1 1<br>输出样例#1：<br>1</p>
<blockquote>
</blockquote>
<p>说明<br>1≤n≤50，0≤Si≤2^50<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 50</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lnt;</span><br><span class="line"><span class="keyword">int</span> n;	lnt base[MAX_N+<span class="number">5</span>], <span class="built_in">pow</span>[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);	<span class="built_in">pow</span>[<span class="number">0</span>] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= MAX_N; i++)	<span class="built_in">pow</span>[i] = <span class="built_in">pow</span>[i<span class="number">-1</span>]*<span class="number">2</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">		lnt x;	<span class="built_in">scanf</span>(<span class="string">"%lld"</span>, &amp;x);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = MAX_N; j &gt;= <span class="number">0</span>; j--)	<span class="keyword">if</span> (<span class="built_in">pow</span>[j]&amp;x) &#123;</span><br><span class="line">			<span class="keyword">if</span> (base[j])	x ^= base[j];</span><br><span class="line">			<span class="keyword">else</span> &#123;base[j] = x;	<span class="keyword">break</span>;&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	lnt ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = MAX_N; i &gt;= <span class="number">0</span>; i--)	<span class="keyword">if</span> ((ans^<span class="built_in">pow</span>[i]) &gt; ans)	ans ^= base[i];</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%lld"</span>, ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Lucas"><a href="#Lucas" class="headerlink" title="Lucas"></a>Lucas</h2><blockquote>
<p>【模板】卢卡斯定理</p>
</blockquote>
<p>题目背景<br>这是一道模板题。</p>
<blockquote>
</blockquote>
<p>题目描述<br>给定n,m,p(1≤n,m,p≤1e5)，求C(n+m,m)。<br>保证P为prime<br>一个测试点内包含多组数据。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行一个整数T(T≤10)，表示数据组数<br>第二行开始共T行，每行三个数n m p，意义如上<br>输出格式：<br>共T行，每行一个整数表示答案。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例#1：<br>2<br>1 2 5<br>2 1 5<br>输出样例#1：<br>3<br>3<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_P 100000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lnt;</span><br><span class="line">lnt f[MAX_P+<span class="number">5</span>] = &#123;<span class="number">1</span>&#125;;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">(lnt p)</span> </span>&#123;<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= MAX_P; i++)	f[i] = f[i<span class="number">-1</span>]*i%p;&#125;</span><br><span class="line"><span class="function">lnt <span class="title">FLT</span><span class="params">(lnt x, lnt p)</span> </span>&#123;</span><br><span class="line">	lnt ret = <span class="number">1</span>;	x %= p;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> k = p<span class="number">-2</span>; k; k &gt;&gt;= <span class="number">1</span>)	ret = k%<span class="number">2</span> ? ret*x%p : ret, x = x*x%p;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">lnt <span class="title">lucas</span><span class="params">(lnt n, lnt m, lnt p)</span> </span>&#123;<span class="keyword">return</span> m ? (n%p &gt;= m%p ? f[n%p]*FLT(f[m%p]*f[n%p-m%p], p)*lucas(n/p, m/p, p)%p : <span class="number">0</span>) : <span class="number">1</span>;&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> T;	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;T);</span><br><span class="line">	<span class="keyword">while</span> (T--) &#123;</span><br><span class="line">		lnt n, m, p;	<span class="built_in">scanf</span>(<span class="string">"%lld%lld%lld"</span>, &amp;n, &amp;m, &amp;p);</span><br><span class="line">		init(p), <span class="built_in">printf</span>(<span class="string">"%lld\n"</span>, lucas(n+m, min(n, m), p)%p);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Matrix-Fast-Power"><a href="#Matrix-Fast-Power" class="headerlink" title="Matrix Fast Power"></a>Matrix Fast Power</h2><blockquote>
<p>【模板】矩阵快速幂</p>
</blockquote>
<p>题目描述<br>给定n*n的矩阵A，求A^k</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行，n,k<br>第2至n+1行，每行n个数，第i+1行第j个数表示矩阵第i行第j列的元素<br>输出格式：<br>输出A^k<br>共n行，每行n个数，第i行第j个数表示矩阵第i行第j列的元素，每个元素模10^9+7</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>2 1<br>1 1<br>1 1<br>输出样例：<br>1 1<br>1 1</p>
<blockquote>
</blockquote>
<p>说明<br>n&lt;=100, k&lt;=10^12, |矩阵元素|&lt;=1000<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MOD 1000000007</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Matrix</span> &#123;</span></span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ele[MAX_N][MAX_N];</span><br><span class="line">    <span class="keyword">inline</span> Matrix <span class="keyword">operator</span> * (<span class="keyword">const</span> Matrix &amp;x) <span class="keyword">const</span> &#123;</span><br><span class="line">        Matrix ret;</span><br><span class="line">        <span class="built_in">memset</span>(ret.ele, <span class="number">0</span>, <span class="keyword">sizeof</span>(ret.ele));</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> k = <span class="number">0</span>; k &lt; n; k++)</span><br><span class="line">                    ret.ele[i][j] = (ret.ele[i][j]+ele[i][k]*x.ele[k][j])%MOD;</span><br><span class="line">        <span class="keyword">return</span> ret;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function">Matrix <span class="title">Power</span><span class="params">(Matrix a, <span class="keyword">long</span> <span class="keyword">long</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (k == <span class="number">1</span>)    <span class="keyword">return</span> a;</span><br><span class="line">    Matrix ret = Power(a, k/<span class="number">2</span>);</span><br><span class="line">    <span class="keyword">if</span> (k%<span class="number">2</span>)    <span class="keyword">return</span> a*ret*ret;</span><br><span class="line">    <span class="keyword">return</span> ret*ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> k;</span><br><span class="line">    Matrix a;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; k;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; a.ele[i][j];</span><br><span class="line">    a = Power(a, k);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; n; j++)</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; a.ele[i][j] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">        <span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Prime-Sieve"><a href="#Prime-Sieve" class="headerlink" title="Prime Sieve"></a>Prime Sieve</h2><blockquote>
<p>【模板】线性筛素数</p>
</blockquote>
<p>题目描述<br>如题，给定一个范围N，你需要处理M个某数字是否为质数的询问（每个数字均在范围1-N内）</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含两个正整数N、M，分别表示查询的范围和查询的个数。<br>接下来M行每行包含一个不小于1且不大于N的整数，即询问概数是否为质数。<br>输出格式：<br>输出包含M行，每行为Yes或No，即依次为每一个询问的结果。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>100 5<br>2<br>3<br>4<br>91<br>97<br>输出样例：<br>Yes<br>Yes<br>No<br>No<br>Yes</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：500ms 128M<br>数据规模：<br>对于30%的数据：N&lt;=10000，M&lt;=10000<br>对于100%的数据：N&lt;=10000000，M&lt;=100000</p>
<blockquote>
</blockquote>
<p>样例说明：<br>N=100，说明接下来的询问数均不大于100且大于1。<br>所以2、3、97为质数，4、91非质数。<br>故依次输出Yes、Yes、No、No、Yes。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 10000000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">bool</span> IsPrime[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> pri[MAX_N+<span class="number">5</span>], cnt = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">FindPrime</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	IsPrime[<span class="number">0</span>] = IsPrime[<span class="number">1</span>] = <span class="literal">false</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (IsPrime) &#123;</span><br><span class="line">			pri[cnt++] = i;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">0</span>; j &lt; cnt; j++) &#123;</span><br><span class="line">			<span class="keyword">if</span> (i*pri[j] &gt; n)	<span class="keyword">break</span>;</span><br><span class="line">			IsPrime[i*pri[j]] = <span class="literal">false</span>;</span><br><span class="line">			<span class="keyword">if</span> (i%pri[j] == <span class="number">0</span>)	<span class="keyword">break</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(IsPrime, <span class="literal">true</span>, <span class="keyword">sizeof</span>(IsPrime));</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">	FindPrime();</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; m;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> x;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; x;</span><br><span class="line">		<span class="keyword">if</span> (IsPrime[x]) &#123;</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"Yes"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; <span class="string">"No"</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Trigeminal-Search"><a href="#Trigeminal-Search" class="headerlink" title="Trigeminal Search"></a>Trigeminal Search</h2><blockquote>
<p>【模板】三分法</p>
</blockquote>
<p>题目描述<br>如题，给出一个N次函数，保证在范围[l,r]内存在一点x，使得[l,x]上单调增，[x,r]上单调减。试求出x的值。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行一次包含一个正整数N和两个实数l、r，含义如题目描述所示。<br>第二行包含N+1个实数，从高到低依次表示该N次函数各项的系数。<br>输出格式：<br>输出为一行，包含一个实数，即为x的值。四舍五入保留5位小数。 </p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>3 -0.9981 0.5<br>1 -3 -3 1<br>输出样例：<br>-0.41421</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：50ms,128M<br>数据规模：<br>对于100%的数据：7&lt;=N&lt;=13<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n;</span><br><span class="line"><span class="keyword">double</span> s, t;</span><br><span class="line"><span class="keyword">double</span> a[<span class="number">14</span>];</span><br><span class="line"><span class="function"><span class="keyword">double</span> <span class="title">calc</span><span class="params">(<span class="keyword">double</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">double</span> tot = <span class="number">0</span>, tmp = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= n; i++) &#123;</span><br><span class="line">        tot += tmp*a[i];</span><br><span class="line">        tmp *= x;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">f</span><span class="params">(<span class="keyword">double</span> l, <span class="keyword">double</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">abs</span>(r-l) &lt;= <span class="number">0.000001</span>) &#123;</span><br><span class="line">        <span class="built_in">printf</span>(<span class="string">"%.5f"</span>, l);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">double</span> ml = (<span class="number">2</span>*l+r)/<span class="number">3</span>, mr = (l+<span class="number">2</span>*r)/<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">if</span> (calc(ml) &gt; calc(mr)) &#123;</span><br><span class="line">        f(l, mr);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        f(ml, r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; s &gt;&gt; t;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = n; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; a[i];</span><br><span class="line">    &#125;</span><br><span class="line">    f(s, t);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="Data-Structure"><a href="#Data-Structure" class="headerlink" title="Data Structure"></a>Data Structure</h1><h2 id="Heap"><a href="#Heap" class="headerlink" title="Heap"></a>Heap</h2><blockquote>
<p>【模板】堆</p>
</blockquote>
<p>题目描述<br>如题，初始小根堆为空，我们需要支持以下3种操作：<br>操作1： 1 x 表示将x插入到堆中<br>操作2： 2 输出该小根堆内的最小数<br>操作3： 3 删除该小根堆内的最小数</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含一个整数N，表示操作的个数<br>接下来N行，每行包含1个或2个正整数，表示三种操作，格式如下：<br>操作1： 1 x<br>操作2： 2<br>操作3： 3<br>输出格式：<br>包含若干行正整数，每行依次对应一个操作2的结果。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>5<br>1 2<br>1 5<br>2<br>3<br>2<br>输出样例：<br>2<br>5</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>数据规模：<br>对于30%的数据：N&lt;=15<br>对于70%的数据：N&lt;=10000<br>对于100%的数据：N&lt;=1000000<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, heap[<span class="number">1000000</span>+<span class="number">5</span>], size = <span class="number">0</span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    size++;</span><br><span class="line">    heap[size] = x;</span><br><span class="line">    <span class="keyword">int</span> current = size;</span><br><span class="line">    <span class="keyword">int</span> father = current/<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">while</span> (father &gt; <span class="number">0</span> &amp;&amp; heap[father] &gt; heap[current]) &#123;</span><br><span class="line">        swap(heap[father], heap[current]);</span><br><span class="line">        current = father;</span><br><span class="line">        father = current/<span class="number">2</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">pop</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    heap[<span class="number">1</span>] = heap[size];</span><br><span class="line">    size--;</span><br><span class="line">    <span class="keyword">int</span> current = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">int</span> child = current*<span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (child &lt; size &amp;&amp; heap[child] &gt; heap[child+<span class="number">1</span>])    child++;</span><br><span class="line">    <span class="keyword">while</span> (child &lt;= size &amp;&amp; heap[current] &gt; heap[child]) &#123;</span><br><span class="line">        swap(heap[current], heap[child]);</span><br><span class="line">        current = child;</span><br><span class="line">        child = <span class="number">2</span>*current;</span><br><span class="line">        <span class="keyword">if</span> (child &lt; size &amp;&amp; heap[child] &gt; heap[child+<span class="number">1</span>])    child++;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> f;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; f;</span><br><span class="line">        <span class="keyword">if</span> (f == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="keyword">int</span> x;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; x;</span><br><span class="line">            insert(x);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (f == <span class="number">2</span>) &#123;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; heap[<span class="number">1</span>] &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            pop();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Mergeable-Heap"><a href="#Mergeable-Heap" class="headerlink" title="Mergeable Heap"></a>Mergeable Heap</h2><blockquote>
<p>【模板】左偏树（可并堆）</p>
</blockquote>
<p>题目描述<br>如题，一开始有N个小根堆，每个堆包含且仅包含一个数。接下来需要支持两种操作：<br>操作1： 1 x y 将第x个数和第y个数所在的小根堆合并（若第x或第y个数已经被删除或第x和第y个数在用一个堆内，则无视此操作）<br>操作2： 2 x 输出第x个数所在的堆最小数，并将其删除（若第x个数已经被删除，则输出-1并无视删除操作）</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含两个正整数N、M，分别表示一开始小根堆的个数和接下来操作的个数。<br>第二行包含N个正整数，其中第i个正整数表示第i个小根堆初始时包含且仅包含的数。<br>接下来M行每行2个或3个正整数，表示一条操作，格式如下：<br>操作1 ： 1 x y<br>操作2 ： 2 x<br>输出格式：<br>输出包含若干行整数，分别依次对应每一个操作2所得的结果。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例#1：<br>5 5<br>1 5 4 2 3<br>1 1 5<br>1 2 5<br>2 2<br>1 4 2<br>2 2<br>输出样例#1：<br>1<br>2</p>
<blockquote>
</blockquote>
<p>说明<br>当堆里有多个最小值时，优先删除原序列的靠前的，否则会影响后续操作1导致WA。<br>时空限制：1000ms，128M<br>数据规模：<br>对于30%的数据：N&lt;=10，M&lt;=10<br>对于70%的数据：N&lt;=1000，M&lt;=1000<br>对于100%的数据：N&lt;=100000，M&lt;=100000<br>样例说明：<br>初始状态下，五个小根堆分别为:{1}、{5}、{4}、{2}、{3}。<br>第一次操作，将第1个数所在的小根堆与第5个数所在的小根堆合并，故变为四个小根堆：{1,3}、{5}、{4}、{2}。<br>第二次操作，将第2个数所在的小根堆与第5个数所在的小根堆合并，故变为三个小根堆：{1,3,5}、{4}、{2}。<br>第三次操作，将第2个数所在的小根堆的最小值输出并删除，故输出1，第一个数被删除，三个小根堆为：{3,5}、{4}、{2}。<br>第四次操作，将第4个数所在的小根堆与第2个数所在的小根堆合并，故变为两个小根堆：{2,3,5}、{4}。<br>第五次操作，将第2个数所在的小根堆的最小值输出并删除，故输出2，第四个数被删除，两个小根堆为：{3,5}、{4}。<br>故输出依次为1、2。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span><span class="keyword">int</span> val, dis, ls, rs;&#125; heap[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> n, m, fa[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">getf</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;<span class="keyword">return</span> fa[x] == x ? fa[x] : getf(fa[x]);&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">merge</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!a || !b)	<span class="keyword">return</span> a^b;</span><br><span class="line">	<span class="keyword">if</span> (heap[a].val &gt; heap[b].val || (heap[a].val == heap[b].val &amp;&amp; a &gt; b))	swap(a, b);</span><br><span class="line">	heap[a].rs = merge(heap[a].rs, b), fa[heap[a].rs] = a;</span><br><span class="line">	<span class="keyword">if</span> (heap[heap[a].rs].dis &gt; heap[heap[a].ls].dis)	swap(heap[a].ls, heap[a].rs);</span><br><span class="line">	heap[a].dis = heap[a].rs == <span class="number">0</span> ? <span class="number">0</span> : heap[heap[a].rs].dis+<span class="number">1</span>;	<span class="keyword">return</span> a;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">pop</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> l = heap[a].ls, r = heap[a].rs;</span><br><span class="line">	heap[a].ls = heap[a].rs = heap[a].val = <span class="number">0</span>, fa[l] = l, fa[r] = r;</span><br><span class="line">	<span class="keyword">return</span> merge(l, r);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;heap[i].val), fa[i] = i;</span><br><span class="line">	<span class="keyword">while</span> (m--) &#123;</span><br><span class="line">		<span class="keyword">int</span> opt;	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;opt);</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> x, y;	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;y), x = getf(x), y = getf(y);</span><br><span class="line">			<span class="keyword">if</span> (heap[x].val &amp;&amp; heap[y].val &amp;&amp; x != y)	merge(x, y);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> x;	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x), x = getf(x);</span><br><span class="line">			<span class="keyword">if</span> (!heap[x].val)	<span class="built_in">printf</span>(<span class="string">"-1\n"</span>);</span><br><span class="line">			<span class="keyword">else</span>	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, heap[x].val), pop(x);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Binary-Indexed-Tree"><a href="#Binary-Indexed-Tree" class="headerlink" title="Binary Indexed Tree"></a>Binary Indexed Tree</h2><h3 id="1"><a href="#1" class="headerlink" title="1"></a>1</h3><blockquote>
<p>【模板】树状数组 1</p>
</blockquote>
<p>题目描述<br>如题，已知一个数列，你需要进行下面两种操作：<br>1.将某一个数加上x<br>2.求出某区间每一个数的和</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含两个整数N、M，分别表示该数列数字的个数和操作的总个数。<br>第二行包含N个用空格分隔的整数，其中第i个数字表示数列第i项的初始值。<br>接下来M行每行包含3或4个整数，表示一个操作，具体如下：<br>操作1： 格式：1 x k 含义：将第x个数加上k<br>操作2： 格式：2 x y 含义：输出区间[x,y]内每个数的和<br>输出格式：<br>输出包含若干行整数，即为所有操作2的结果。 </p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>5 5<br>1 5 4 2 3<br>1 1 3<br>2 2 5<br>1 3 -1<br>1 4 2<br>2 1 4<br>输出样例：<br>14<br>16</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>数据规模：<br>对于30%的数据：N&lt;=8，M&lt;=10<br>对于70%的数据：N&lt;=10000，M&lt;=10000<br>对于100%的数据：N&lt;=500000，M&lt;=500000<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 500000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> tree[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x&amp;(-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (pos &lt;= n) &#123;</span><br><span class="line">		tree[pos] += x;</span><br><span class="line">		pos += lowbit(pos);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span> tot = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (t &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		tot += tree[t];</span><br><span class="line">		t -= lowbit(t);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(tree, <span class="number">0</span>, <span class="keyword">sizeof</span>(tree));</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> tmp;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; tmp;</span><br><span class="line">		modify(i, tmp);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> f, a, b;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; f &gt;&gt; a &gt;&gt; b;</span><br><span class="line">		<span class="keyword">if</span> (f == <span class="number">1</span>) &#123;</span><br><span class="line">			modify(a, b);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; query(b)-query(a<span class="number">-1</span>) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="2"><a href="#2" class="headerlink" title="2"></a>2</h3><blockquote>
<p>【模板】树状数组 2</p>
</blockquote>
<p>题目描述<br>如题，已知一个数列，你需要进行下面两种操作：<br>1.将某区间每一个数数加上x<br>2.求出某一个数</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含两个整数N、M，分别表示该数列数字的个数和操作的总个数。<br>第二行包含N个用空格分隔的整数，其中第i个数字表示数列第i项的初始值。<br>接下来M行每行包含3或4个整数，表示一个操作，具体如下：<br>操作1： 格式：1 x y k 含义：将区间[x,y]内每个数加上k<br>操作2： 格式：2 x 含义：输出第x个数的值<br>输出格式：<br>输出包含若干行整数，即为所有操作2的结果。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>5 5<br>1 5 4 2 3<br>1 2 4 2<br>2 3<br>1 1 5 -1<br>1 3 5 7<br>2 4<br>输出样例：<br>6<br>10</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>数据规模：<br>对于30%的数据：N&lt;=8，M&lt;=10<br>对于70%的数据：N&lt;=10000，M&lt;=10000<br>对于100%的数据：N&lt;=500000，M&lt;=500000<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 500000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> tree[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">lowbit</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> x&amp;(-x);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> pos, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (pos &lt;= n) &#123;</span><br><span class="line">		tree[pos] += x;</span><br><span class="line">		pos += lowbit(pos);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> pos)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">long</span> <span class="keyword">long</span> tot = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (pos &gt; <span class="number">0</span>) &#123;</span><br><span class="line">		tot += tree[pos];</span><br><span class="line">		pos -= lowbit(pos);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> tot;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(tree, <span class="number">0</span>, <span class="keyword">sizeof</span>(tree));</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> x;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; x;</span><br><span class="line">		modify(i, x);</span><br><span class="line">		modify(i+<span class="number">1</span>, -x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> f;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; f;</span><br><span class="line">		<span class="keyword">if</span> (f == <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> l, r, x;</span><br><span class="line">			<span class="built_in">cin</span> &gt;&gt; l &gt;&gt; r &gt;&gt; x;</span><br><span class="line">			modify(l, x);</span><br><span class="line">			modify(r+<span class="number">1</span>, -x);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> x;</span><br><span class="line">			<span class="built_in">cin</span> &gt;&gt; x;</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; query(x) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Segment-Tree"><a href="#Segment-Tree" class="headerlink" title="Segment Tree"></a>Segment Tree</h2><h3 id="1-1"><a href="#1-1" class="headerlink" title="1"></a>1</h3><blockquote>
<p>【模板】线段树 1</p>
</blockquote>
<p>题目描述<br>如题，已知一个数列，你需要进行下面两种操作：<br>1.将某区间每一个数加上x<br>2.求出某区间每一个数的和</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含两个整数N、M，分别表示该数列数字的个数和操作的总个数。<br>第二行包含N个用空格分隔的整数，其中第i个数字表示数列第i项的初始值。<br>接下来M行每行包含3或4个整数，表示一个操作，具体如下：<br>操作1： 格式：1 x y k 含义：将区间[x,y]内每个数加上k<br>操作2： 格式：2 x y 含义：输出区间[x,y]内每个数的和<br>输出格式：<br>输出包含若干行整数，即为所有操作2的结果。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>5 5<br>1 5 4 2 3<br>2 2 4<br>1 2 3 2<br>2 3 4<br>1 1 5 1<br>2 1 4<br>输出样例：<br>11<br>8<br>20</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>数据规模：<br>对于30%的数据：N&lt;=8，M&lt;=10<br>对于70%的数据：N&lt;=1000，M&lt;=10000<br>对于100%的数据：N&lt;=100000，M&lt;=100000<br>（数据保证在int64/long long数据范围内）<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, k;</span><br><span class="line"><span class="keyword">long</span> <span class="keyword">long</span> tree[MAX_N*<span class="number">4</span>+<span class="number">50</span>], tag[MAX_N*<span class="number">4</span>+<span class="number">50</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">    tree[v] = tree[v*<span class="number">2</span>]+tree[v*<span class="number">2</span>+<span class="number">1</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">downtag</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    tag[v*<span class="number">2</span>] += tag[v];</span><br><span class="line">    tag[v*<span class="number">2</span>+<span class="number">1</span>] += tag[v];</span><br><span class="line">    <span class="keyword">int</span> m = (s+t)/<span class="number">2</span>;</span><br><span class="line">    tree[v*<span class="number">2</span>] += tag[v]*(m-s+<span class="number">1</span>);</span><br><span class="line">    tree[v*<span class="number">2</span>+<span class="number">1</span>] += tag[v]*(t-m);</span><br><span class="line">    tag[v] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r) &#123;</span><br><span class="line">        tree[v] += x*(t-s+<span class="number">1</span>);</span><br><span class="line">        tag[v] += x;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m = (s+t)/<span class="number">2</span>;</span><br><span class="line">    downtag(v, s, t);</span><br><span class="line">    <span class="keyword">if</span> (l &lt;= m) &#123;</span><br><span class="line">        modify(v*<span class="number">2</span>, s, m, l, r, x);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (r &gt;= m+<span class="number">1</span>) &#123;</span><br><span class="line">        modify(v*<span class="number">2</span>+<span class="number">1</span>, m+<span class="number">1</span>, t, l, r, x);</span><br><span class="line">    &#125;</span><br><span class="line">    updata(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s == t) &#123;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; tree[v];</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m = (s+t)/<span class="number">2</span>;</span><br><span class="line">    build(v*<span class="number">2</span>, s, m);</span><br><span class="line">    build(v*<span class="number">2</span>+<span class="number">1</span>, m+<span class="number">1</span>, t);</span><br><span class="line">    updata(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">long</span> <span class="keyword">long</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r) &#123;</span><br><span class="line">        <span class="keyword">return</span> tree[v];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">int</span> m = (s+t)/<span class="number">2</span>;</span><br><span class="line">    downtag(v, s, t);</span><br><span class="line">    <span class="keyword">long</span> <span class="keyword">long</span> ret = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">if</span> (l &lt;= m) &#123;</span><br><span class="line">        ret += query(v*<span class="number">2</span>, s, m, l, r);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (r &gt;= m+<span class="number">1</span>) &#123;</span><br><span class="line">        ret += query(v*<span class="number">2</span>+<span class="number">1</span>, m+<span class="number">1</span>, t, l, r);</span><br><span class="line">    &#125;</span><br><span class="line">    updata(v);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="built_in">cin</span> &gt;&gt; n &gt;&gt; k;</span><br><span class="line">    build(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; k; i++) &#123;</span><br><span class="line">        <span class="keyword">int</span> f, l, r, x;</span><br><span class="line">        <span class="built_in">cin</span> &gt;&gt; f;</span><br><span class="line">        <span class="keyword">if</span> (f == <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; l &gt;&gt; r &gt;&gt; x;</span><br><span class="line">            modify(<span class="number">1</span>, <span class="number">1</span>, n, l, r, x);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">cin</span> &gt;&gt; l &gt;&gt; r;</span><br><span class="line">            <span class="built_in">cout</span> &lt;&lt; query(<span class="number">1</span>, <span class="number">1</span>, n, l, r) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="2-1"><a href="#2-1" class="headerlink" title="2"></a>2</h3><blockquote>
<p>【模板】线段树 2</p>
</blockquote>
<p>题目描述<br>如题，已知一个数列，你需要进行下面两种操作：<br>1.将某区间每一个数加上x<br>2.将某区间每一个数乘上x<br>3.求出某区间每一个数的和</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含三个整数N、M、P，分别表示该数列数字的个数、操作的总个数和模数。<br>第二行包含N个用空格分隔的整数，其中第i个数字表示数列第i项的初始值。<br>接下来M行每行包含3或4个整数，表示一个操作，具体如下：<br>操作1： 格式：1 x y k 含义：将区间[x,y]内每个数乘上k<br>操作2： 格式：2 x y k 含义：将区间[x,y]内每个数加上k<br>操作3： 格式：3 x y 含义：输出区间[x,y]内每个数的和对P取模所得的结果<br>输出格式：<br>输出包含若干行整数，即为所有操作3的结果。 </p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>5 5 38<br>1 5 4 2 3<br>2 1 4 1<br>3 2 5<br>1 2 4 2<br>2 3 5 5<br>3 1 4<br>输出样例：<br>17<br>2</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>数据规模：<br>对于30%的数据：N&lt;=8，M&lt;=10<br>对于70%的数据：N&lt;=1000，M&lt;=10000<br>对于100%的数据：N&lt;=100000，M&lt;=100000<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> ll long long</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line">ll p;</span><br><span class="line">ll tree[MAX_N*<span class="number">4</span>+<span class="number">5</span>], mul[MAX_N*<span class="number">4</span>+<span class="number">5</span>], add[MAX_N*<span class="number">4</span>+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;</span><br><span class="line">	tree[v] = (tree[v*<span class="number">2</span>]+tree[v*<span class="number">2</span>+<span class="number">1</span>])%p;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">downtag</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> mid)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (mul[v] == <span class="number">1</span> &amp;&amp; add[v] == <span class="number">0</span>)	<span class="keyword">return</span>;</span><br><span class="line">	mul[v*<span class="number">2</span>] = mul[v*<span class="number">2</span>]*mul[v]%p;</span><br><span class="line">	add[v*<span class="number">2</span>] = (add[v*<span class="number">2</span>]*mul[v]%p+add[v])%p;</span><br><span class="line">	tree[v*<span class="number">2</span>] = (tree[v*<span class="number">2</span>]*mul[v]%p+add[v]*(ll)(mid-s+<span class="number">1</span>)%p)%p;</span><br><span class="line">	mul[v*<span class="number">2</span>+<span class="number">1</span>] = mul[v*<span class="number">2</span>+<span class="number">1</span>]*mul[v]%p;</span><br><span class="line">	add[v*<span class="number">2</span>+<span class="number">1</span>] = (add[v*<span class="number">2</span>+<span class="number">1</span>]*mul[v]%p+add[v])%p;</span><br><span class="line">	tree[v*<span class="number">2</span>+<span class="number">1</span>] = (tree[v*<span class="number">2</span>+<span class="number">1</span>]*mul[v]%p+add[v]*(ll)(t-mid)%p)%p;</span><br><span class="line">	mul[v] = <span class="number">1</span>;</span><br><span class="line">	add[v] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">return</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">create</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	mul[v] = <span class="number">1</span>;</span><br><span class="line">	add[v] = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (s == t) &#123;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; tree[v];</span><br><span class="line">		tree[v] %= p;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> mid = (s+t)/<span class="number">2</span>;</span><br><span class="line">	create(v*<span class="number">2</span>, s, mid);</span><br><span class="line">	create(v*<span class="number">2</span>+<span class="number">1</span>, mid+<span class="number">1</span>, t);</span><br><span class="line">	updata(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify1</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r) &#123;</span><br><span class="line">		add[v] = (add[v]+(ll)x)%p;</span><br><span class="line">		tree[v] = (tree[v]+(ll)x*(ll)(t-s+<span class="number">1</span>)%p)%p;</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> mid = (s+t)/<span class="number">2</span>;</span><br><span class="line">	downtag(v, s, t, mid);</span><br><span class="line">	<span class="keyword">if</span> (l &lt;= mid) &#123;</span><br><span class="line">		modify1(v*<span class="number">2</span>, s, mid, l, r, x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (r &gt;= mid+<span class="number">1</span>) &#123;</span><br><span class="line">		modify1(v*<span class="number">2</span>+<span class="number">1</span>, mid+<span class="number">1</span>, t, l, r, x);</span><br><span class="line">	&#125;</span><br><span class="line">	updata(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify2</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r) &#123;</span><br><span class="line">		mul[v] = mul[v]*(ll)x%p;</span><br><span class="line">		add[v] = add[v]*(ll)x%p;</span><br><span class="line">		tree[v] = tree[v]*(ll)x%p;</span><br><span class="line">		<span class="keyword">return</span>; </span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> mid = (s+t)/<span class="number">2</span>;</span><br><span class="line">	downtag(v, s, t, mid);</span><br><span class="line">	<span class="keyword">if</span> (l &lt;= mid) &#123;</span><br><span class="line">		modify2(v*<span class="number">2</span>, s, mid, l, r, x);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (r &gt;= mid+<span class="number">1</span>) &#123;</span><br><span class="line">		modify2(v*<span class="number">2</span>+<span class="number">1</span>, mid+<span class="number">1</span>, t, l, r, x);</span><br><span class="line">	&#125;</span><br><span class="line">	updata(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">ll <span class="title">query</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r) &#123;</span><br><span class="line">		<span class="keyword">return</span> tree[v];</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">int</span> mid = (s+t)/<span class="number">2</span>;</span><br><span class="line">	ll ret = <span class="number">0</span>;</span><br><span class="line">	downtag(v, s, t, mid);</span><br><span class="line">	<span class="keyword">if</span> (l &lt;= mid) &#123;</span><br><span class="line">		ret = (ret+query(v*<span class="number">2</span>, s, mid, l, r))%p;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (r &gt;= mid+<span class="number">1</span>) &#123;</span><br><span class="line">		ret = (ret+query(v*<span class="number">2</span>+<span class="number">1</span>, mid+<span class="number">1</span>, t, l, r))%p;</span><br><span class="line">	&#125;</span><br><span class="line">	updata(v);</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; n &gt;&gt; m &gt;&gt; p;</span><br><span class="line">	create(<span class="number">1</span>, <span class="number">1</span>, n);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; m; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> f;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; f;</span><br><span class="line">		<span class="keyword">if</span> (f == <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> l, r, x;</span><br><span class="line">			<span class="built_in">cin</span> &gt;&gt; l &gt;&gt; r &gt;&gt; x;</span><br><span class="line">			modify2(<span class="number">1</span>, <span class="number">1</span>, n, l, r, x%p);</span><br><span class="line">		&#125; <span class="keyword">else</span> <span class="keyword">if</span> (f == <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> l, r, x;</span><br><span class="line">			<span class="built_in">cin</span> &gt;&gt; l &gt;&gt; r &gt;&gt; x;</span><br><span class="line">			modify1(<span class="number">1</span>, <span class="number">1</span>, n, l, r, x%p);</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> l, r;</span><br><span class="line">			<span class="built_in">cin</span> &gt;&gt; l &gt;&gt; r;</span><br><span class="line">			<span class="built_in">cout</span> &lt;&lt; query(<span class="number">1</span>, <span class="number">1</span>, n, l, r) &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Sparse-Table"><a href="#Sparse-Table" class="headerlink" title="Sparse Table"></a>Sparse Table</h2><blockquote>
<p>【模板】ST表</p>
</blockquote>
<p>题目背景<br>这是一道ST表经典题——静态区间最大值<br>请注意最大数据时限只有0.8s，数据强度不低，请务必保证你的每次查询复杂度为O(1)</p>
<blockquote>
</blockquote>
<p>题目描述<br>给定一个长度为N的数列，和M次询问，求出每一次询问的区间内数字的最大值。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含两个整数N,M，分别表示数列的长度和询问的个数。<br>第二行包含N个整数（记为ai），依次表示数列的第i项。<br>接下来M行，每行包含两个整数li,ri，表示查询的区间为[li,ri]。<br>输出格式：<br>输出包含M行，每行一个整数，依次表示每一次询问的结果。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例#1：<br>8 8<br>9 3 1 7 5 6 0 8<br>1 6<br>1 5<br>2 7<br>2 6<br>1 8<br>4 8<br>3 7<br>1 8<br>输出样例#1：<br>9<br>9<br>7<br>7<br>9<br>8<br>7<br>9</p>
<blockquote>
</blockquote>
<p>说明<br>对于30%的数据，满足：1≤N,M≤10<br>对于70%的数据，满足：1≤N,M≤1e5<br>对于100%的数据，满足：1≤N≤1e5，1≤M≤1e6，ai∈[0,1e9]，1≤li≤ri≤N<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, num[MAX_N+<span class="number">5</span>], mx[MAX_N+<span class="number">5</span>][<span class="number">20</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setTable</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	mx[i][<span class="number">0</span>] = num[i];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> j = <span class="number">1</span>; (<span class="number">1</span>&lt;&lt;j) &lt;= n; j++)</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i+(<span class="number">1</span>&lt;&lt;j)<span class="number">-1</span> &lt;= n; i++)</span><br><span class="line">			mx[i][j] = max(mx[i][j<span class="number">-1</span>], mx[i+(<span class="number">1</span>&lt;&lt;j<span class="number">-1</span>)][j<span class="number">-1</span>]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> range = (<span class="keyword">int</span>)(<span class="built_in">log</span>(r-l+<span class="number">1</span>)/<span class="built_in">log</span>(<span class="number">2</span>));</span><br><span class="line">	<span class="keyword">return</span> max(mx[l][range], mx[r-(<span class="number">1</span>&lt;&lt;range)+<span class="number">1</span>][range]);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;num[i]);</span><br><span class="line">	setTable();</span><br><span class="line">	<span class="keyword">while</span> (m--) &#123;</span><br><span class="line">		<span class="keyword">int</span> l, r;	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;l, &amp;r);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, query(l, r));</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Chairman-Tree"><a href="#Chairman-Tree" class="headerlink" title="Chairman Tree"></a>Chairman Tree</h2><blockquote>
<p>【模板】可持久化线段树/主席树</p>
</blockquote>
<p>题目背景<br>这是个非常经典的主席树入门题——静态区间第K小<br>数据已经过加强，请使用主席树。同时请注意常数优化</p>
<blockquote>
</blockquote>
<p>题目描述<br>如题，给定N个正整数构成的序列，将对于指定的闭区间查询其区间内的第K小值。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含两个正整数N、M，分别表示序列的长度和查询的个数。<br>第二行包含N个正整数，表示这个序列各项的数字。<br>接下来M行每行包含三个整数l,r,k，表示查询区间[l,r]内的第k小值。<br>输出格式：<br>输出包含k行，每行1个正整数，依次表示每一次查询的结果</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例#1：<br>5 5<br>25957 6405 15770 26287 26465<br>2 2 1<br>3 4 1<br>4 5 1<br>1 2 2<br>4 4 1<br>输出样例#1：<br>6405<br>15770<br>26287<br>25957<br>26287</p>
<blockquote>
</blockquote>
<p>说明<br>数据范围：<br>对于20%的数据满足：1≤N,M≤10<br>对于50%的数据满足：1≤N,M≤1000<br>对于80%的数据满足：1≤N,M≤1e5<br>对于100%的数据满足：1≤N,M≤2e5<br>对于数列中的所有数ai，均满足-1e9≤ai≤1e9<br>样例数据说明：<br>N=5，数列长度为5，数列从第一项开始依次为[25957,6405,15770,26287,26465]<br>第一次查询为[2,2]区间内的第一小值，即为6405<br>第二次查询为[3,4]区间内的第一小值，即为15770<br>第三次查询为[4,5]区间内的第一小值，即为26287<br>第四次查询为[1,2]区间内的第二小值，即为25957<br>第五次查询为[4,4]区间内的第一小值，即为26287<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 200000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, num[MAX_N+<span class="number">5</span>], hash[MAX_N+<span class="number">5</span>], tot, root[MAX_N+<span class="number">5</span>], cnt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">pre</span> &#123;</span><span class="keyword">int</span> id, val;&#125; p[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span> <span class="params">(<span class="keyword">const</span> pre &amp;a, <span class="keyword">const</span> pre &amp;b)</span> </span>&#123;<span class="keyword">return</span> a.val &lt; b.val;&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span><span class="keyword">int</span> ls, rs, val;&#125; tr[MAX_N*<span class="number">50</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;tr[v].val = tr[tr[v].ls].val+tr[tr[v].rs].val;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">build</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (s == t)	<span class="keyword">return</span>;	<span class="keyword">int</span> mid = s+t&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	tr[v].ls = ++cnt, tr[v].rs = ++cnt;</span><br><span class="line">	build(tr[v].ls, s, mid), build(tr[v].rs, mid+<span class="number">1</span>, t);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> o, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	tr[v] = tr[o];	<span class="keyword">if</span> (s == t) &#123;tr[v].val++;	<span class="keyword">return</span>;&#125;</span><br><span class="line">	<span class="keyword">int</span> mid = s+t&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (x &lt;= mid)	modify(tr[v].ls = ++cnt, tr[o].ls, s, mid, x);</span><br><span class="line">	<span class="keyword">else</span>	modify(tr[v].rs = ++cnt, tr[o].rs, mid+<span class="number">1</span>, t, x);</span><br><span class="line">	updata(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> v1, <span class="keyword">int</span> v2, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (s == t)	<span class="keyword">return</span> s;</span><br><span class="line">	<span class="keyword">int</span> mid = s+t&gt;&gt;<span class="number">1</span>, tmp = tr[tr[v2].ls].val-tr[tr[v1].ls].val;</span><br><span class="line">	<span class="keyword">if</span> (k &lt;= tmp)	<span class="keyword">return</span> query(tr[v1].ls, tr[v2].ls, s, mid, k);</span><br><span class="line">	<span class="keyword">else</span>	<span class="keyword">return</span> query(tr[v1].rs, tr[v2].rs, mid+<span class="number">1</span>, t, k-tmp);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	p[i].id = i, <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;p[i].val);</span><br><span class="line">	sort(p+<span class="number">1</span>, p+n+<span class="number">1</span>, cmp);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) &#123;<span class="keyword">if</span> (p[i].val != p[i<span class="number">-1</span>].val || i == <span class="number">1</span>)	hash[++tot] = p[i].val;	num[p[i].id] = tot;&#125;</span><br><span class="line">	root[<span class="number">0</span>] = ++cnt, build(root[<span class="number">0</span>], <span class="number">1</span>, tot);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	root[i] = ++cnt, modify(root[i], root[i<span class="number">-1</span>], <span class="number">1</span>, tot, num[i]);</span><br><span class="line">	<span class="keyword">while</span> (m--) &#123;</span><br><span class="line">		<span class="keyword">int</span> l, r, k;	<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;l, &amp;r, &amp;k);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, hash[query(root[l<span class="number">-1</span>], root[r], <span class="number">1</span>, tot, k)]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Treap"><a href="#Treap" class="headerlink" title="Treap"></a>Treap</h2><blockquote>
<p>【模板】普通平衡树</p>
</blockquote>
<p>题目描述<br>您需要写一种数据结构（可参考题目标题），来维护一些数，其中需要提供以下操作：<br>插入x数<br>删除x数(若有多个相同的数，因只删除一个)<br>查询x数的排名(若有多个相同的数，因输出最小的排名)<br>查询排名为x的数<br>求x的前驱(前驱定义为小于x，且最大的数)<br>求x的后继(后继定义为大于x，且最小的数)</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行为n，表示操作的个数,下面n行每行有两个数opt和x，opt表示操作的序号(1&lt;=opt&lt;=6)<br>输出格式：<br>对于操作3,4,5,6每行输出一个数，表示对应答案</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>10<br>1 106465<br>4 1<br>1 317721<br>1 460929<br>1 644985<br>1 84185<br>1 89851<br>6 81968<br>1 492737<br>5 493598<br>输出样例：<br>106465<br>84185<br>492737</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>1.n的数据范围：n&lt;=100000<br>2.每个数的数据范围：[-1e7,1e7]<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdlib&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">TNode</span> &#123;</span></span><br><span class="line">    TNode* s[<span class="number">2</span>];</span><br><span class="line">    <span class="keyword">int</span> val, k, size;</span><br><span class="line">    TNode() &#123;&#125;</span><br><span class="line">    TNode(<span class="keyword">int</span> _val, TNode* _s) &#123;val = _val, s[<span class="number">0</span>] = s[<span class="number">1</span>] = _s, k = rand(), size = <span class="number">1</span>;&#125;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">()</span> </span>&#123;size = s[<span class="number">0</span>]-&gt;size+s[<span class="number">1</span>]-&gt;size+<span class="number">1</span>;&#125;</span><br><span class="line">&#125; nil, tr[MAX_N+<span class="number">5</span>], *null, *root, *cnt;</span><br><span class="line"><span class="keyword">typedef</span> TNode* P_TNode;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    srand(<span class="number">19260817</span>);</span><br><span class="line">    nil = TNode(<span class="number">0</span>, <span class="literal">NULL</span>), null = &amp;nil;</span><br><span class="line">    null-&gt;s[<span class="number">0</span>] = null-&gt;s[<span class="number">1</span>] = null, null-&gt;size = <span class="number">0</span>;</span><br><span class="line">    cnt = tr, root = null;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">P_TNode <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    *cnt = TNode(val, null);</span><br><span class="line">    <span class="keyword">return</span> cnt++;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function">P_TNode <span class="title">merge</span><span class="params">(P_TNode a, P_TNode b)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (a == null)    <span class="keyword">return</span> b;</span><br><span class="line">    <span class="keyword">if</span> (b == null)    <span class="keyword">return</span> a;</span><br><span class="line">    <span class="keyword">if</span> (a-&gt;k &gt; b-&gt;k) &#123;a-&gt;s[<span class="number">1</span>] = merge(a-&gt;s[<span class="number">1</span>], b), a-&gt;updata(); <span class="keyword">return</span> a;&#125;</span><br><span class="line">    <span class="keyword">if</span> (a-&gt;k &lt;= b-&gt;k) &#123;b-&gt;s[<span class="number">0</span>] = merge(a, b-&gt;s[<span class="number">0</span>]), b-&gt;updata(); <span class="keyword">return</span> b;&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">split</span><span class="params">(P_TNode v, <span class="keyword">int</span> val, P_TNode &amp;ls, P_TNode &amp;rs)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (v == null) &#123;ls = rs = null; <span class="keyword">return</span>;&#125;</span><br><span class="line">    <span class="keyword">if</span> (val &lt; v-&gt;val) &#123;rs = v; split(rs-&gt;s[<span class="number">0</span>], val, ls, rs-&gt;s[<span class="number">0</span>]);&#125;</span><br><span class="line">    <span class="keyword">if</span> (val &gt;= v-&gt;val) &#123;ls = v;    split(ls-&gt;s[<span class="number">1</span>], val, ls-&gt;s[<span class="number">1</span>], rs);&#125;</span><br><span class="line">    v-&gt;updata();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    P_TNode ls, rs;</span><br><span class="line">    split(root, val, ls, rs);</span><br><span class="line">    root = merge(merge(ls, newnode(val)), rs);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    P_TNode ls, mids, rs;</span><br><span class="line">    split(root, val<span class="number">-1</span>, ls, rs);</span><br><span class="line">    split(rs, val, mids, rs);</span><br><span class="line">    root = merge(ls, merge(merge(mids-&gt;s[<span class="number">0</span>], mids-&gt;s[<span class="number">1</span>]), rs));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_rank</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    P_TNode ls, rs;</span><br><span class="line">    split(root, val<span class="number">-1</span>, ls, rs);</span><br><span class="line">    <span class="keyword">int</span> ret = ls-&gt;size+<span class="number">1</span>;</span><br><span class="line">    root = merge(ls, rs);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_kth</span><span class="params">(P_TNode v, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (k &lt;= v-&gt;s[<span class="number">0</span>]-&gt;size)    <span class="keyword">return</span> get_kth(v-&gt;s[<span class="number">0</span>], k);</span><br><span class="line">    <span class="keyword">if</span> (k &gt; v-&gt;s[<span class="number">0</span>]-&gt;size+<span class="number">1</span>)    <span class="keyword">return</span> get_kth(v-&gt;s[<span class="number">1</span>], k-v-&gt;s[<span class="number">0</span>]-&gt;size<span class="number">-1</span>);</span><br><span class="line">    <span class="keyword">return</span> v-&gt;val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">get_nearest</span><span class="params">(P_TNode v, <span class="keyword">int</span> sn)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (v-&gt;s[sn] != null)    v = v-&gt;s[sn];</span><br><span class="line">    <span class="keyword">return</span> v-&gt;val;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">predecessor</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    P_TNode ls, rs;</span><br><span class="line">    split(root, val<span class="number">-1</span>, ls, rs);</span><br><span class="line">	<span class="keyword">int</span> ret = get_nearest(ls, <span class="number">1</span>);</span><br><span class="line">    root = merge(ls, rs);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">successor</span><span class="params">(<span class="keyword">int</span> val)</span> </span>&#123;</span><br><span class="line">    P_TNode ls, rs;</span><br><span class="line">    split(root, val, ls, rs);</span><br><span class="line">    <span class="keyword">int</span> ret = get_nearest(rs, <span class="number">0</span>);</span><br><span class="line">	root = merge(ls, rs);</span><br><span class="line">    <span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    init();</span><br><span class="line">    <span class="keyword">int</span> n, opt, x;</span><br><span class="line">    <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">    <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">        <span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;opt, &amp;x);</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">1</span>)    insert(x);</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">2</span>)    remove(x);</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">3</span>)    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, get_rank(x));</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">4</span>)    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, get_kth(root, x));</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">5</span>)    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, predecessor(x));</span><br><span class="line">        <span class="keyword">if</span> (opt == <span class="number">6</span>)    <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, successor(x));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Splay"><a href="#Splay" class="headerlink" title="Splay"></a>Splay</h2><h3 id="Normal"><a href="#Normal" class="headerlink" title="Normal"></a>Normal</h3><blockquote>
<p>【模板】普通平衡树</p>
</blockquote>
<p>题目描述<br>您需要写一种数据结构（可参考题目标题），来维护一些数，其中需要提供以下操作：<br>插入x数<br>删除x数(若有多个相同的数，因只删除一个)<br>查询x数的排名(若有多个相同的数，因输出最小的排名)<br>查询排名为x的数<br>求x的前驱(前驱定义为小于x，且最大的数)<br>求x的后继(后继定义为大于x，且最小的数)</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行为n，表示操作的个数,下面n行每行有两个数opt和x，opt表示操作的序号(1&lt;=opt&lt;=6)<br>输出格式：<br>对于操作3,4,5,6每行输出一个数，表示对应答案</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>10<br>1 106465<br>4 1<br>1 317721<br>1 460929<br>1 644985<br>1 84185<br>1 89851<br>6 81968<br>1 492737<br>5 493598<br>输出样例：<br>106465<br>84185<br>492737</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>1.n的数据范围：n&lt;=100000<br>2.每个数的数据范围：[-1e7,1e7]<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x7f7f7f7f</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> flag (cur-&gt;fa-&gt;fa!=tar&amp;&amp;cur-&gt;fa-&gt;fa-&gt;s[sn]==cur-&gt;fa)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SplayNode</span> &#123;</span></span><br><span class="line">	SplayNode *s[<span class="number">2</span>], *fa;	<span class="keyword">int</span> val, w, sz;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">()</span> </span>&#123;sz = w+(s[<span class="number">0</span>]?s[<span class="number">0</span>]-&gt;sz:<span class="number">0</span>)+(s[<span class="number">1</span>]?s[<span class="number">1</span>]-&gt;sz:<span class="number">0</span>);&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SplayTree</span> &#123;</span></span><br><span class="line">	SplayNode* rt;</span><br><span class="line">	<span class="function">SplayNode* <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> _val)</span> </span>&#123;</span><br><span class="line">		SplayNode* v = <span class="keyword">new</span> SplayNode;</span><br><span class="line">		v-&gt;s[<span class="number">0</span>] = v-&gt;s[<span class="number">1</span>] = v-&gt;fa = <span class="literal">NULL</span>;</span><br><span class="line">		v-&gt;val = _val, v-&gt;w = v-&gt;sz = <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">return</span> v;</span><br><span class="line">	&#125;</span><br><span class="line">	SplayTree() &#123;</span><br><span class="line">		rt = newnode(-INF), rt-&gt;s[<span class="number">1</span>] = newnode(INF);</span><br><span class="line">		rt-&gt;s[<span class="number">1</span>]-&gt;fa = rt, rt-&gt;updata();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(SplayNode* v, <span class="keyword">bool</span> sn)</span> </span>&#123;</span><br><span class="line">		SplayNode* f = v-&gt;fa;</span><br><span class="line">		f-&gt;s[sn^<span class="number">1</span>] = v-&gt;s[sn], v-&gt;fa = f-&gt;fa;</span><br><span class="line">		<span class="keyword">if</span> (f-&gt;s[sn^<span class="number">1</span>]) f-&gt;s[sn^<span class="number">1</span>]-&gt;fa = f;</span><br><span class="line">		<span class="keyword">if</span> (v-&gt;fa) v-&gt;fa-&gt;s[f == f-&gt;fa-&gt;s[<span class="number">1</span>]] = v;</span><br><span class="line">		v-&gt;s[sn] = f, f-&gt;fa = v, f-&gt;updata(), v-&gt;updata();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(SplayNode* cur, SplayNode* tar)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (cur != tar &amp;&amp; cur-&gt;fa != tar) &#123;</span><br><span class="line">			<span class="keyword">bool</span> sn = cur-&gt;fa-&gt;s[<span class="number">1</span>] == cur;</span><br><span class="line">			<span class="function"><span class="keyword">if</span> flag <span class="title">rotate</span><span class="params">(cur-&gt;fa, sn^<span class="number">1</span>)</span></span>;</span><br><span class="line">			rotate(cur, sn^<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (cur-&gt;fa == tar) rotate(cur, cur-&gt;fa-&gt;s[<span class="number">0</span>] == cur);</span><br><span class="line">		<span class="keyword">if</span> (tar == rt) rt = cur;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">SplayNode* <span class="title">predecessor</span><span class="params">(<span class="keyword">int</span> _val)</span> </span>&#123;</span><br><span class="line">		SplayNode *cur = rt, *cpy = rt;</span><br><span class="line">		<span class="keyword">for</span> (; cur; cur = cur-&gt;s[_val &gt; cur-&gt;val])</span><br><span class="line">			<span class="keyword">if</span> (cur-&gt;val &lt; _val) cpy = cur;</span><br><span class="line">		<span class="keyword">return</span> cpy;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">SplayNode* <span class="title">successor</span><span class="params">(<span class="keyword">int</span> _val)</span> </span>&#123;</span><br><span class="line">		SplayNode *cur = rt, *cpy = rt;</span><br><span class="line">		<span class="keyword">for</span> (; cur; cur = cur-&gt;s[_val &gt;= cur-&gt;val])</span><br><span class="line">			<span class="keyword">if</span> (cur-&gt;val &gt; _val) cpy = cur;</span><br><span class="line">		<span class="keyword">return</span> cpy;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> _val)</span> </span>&#123;</span><br><span class="line">		SplayNode* pre = predecessor(_val);</span><br><span class="line">		SplayNode* suc = successor(_val);</span><br><span class="line">		splay(pre, rt), splay(suc, rt-&gt;s[<span class="number">1</span>]);</span><br><span class="line">		<span class="keyword">if</span> (suc-&gt;s[<span class="number">0</span>]) suc-&gt;s[<span class="number">0</span>]-&gt;w++, suc-&gt;s[<span class="number">0</span>]-&gt;sz++;</span><br><span class="line">		<span class="keyword">else</span> suc-&gt;s[<span class="number">0</span>] = newnode(_val), suc-&gt;s[<span class="number">0</span>]-&gt;fa = suc;</span><br><span class="line">		suc-&gt;updata(), rt-&gt;updata();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">remove</span><span class="params">(<span class="keyword">int</span> _val)</span> </span>&#123;</span><br><span class="line">		SplayNode* pre = predecessor(_val);</span><br><span class="line">		SplayNode* suc = successor(_val);</span><br><span class="line">		splay(pre, rt), splay(suc, rt-&gt;s[<span class="number">1</span>]);</span><br><span class="line">		suc-&gt;s[<span class="number">0</span>]-&gt;w--, suc-&gt;s[<span class="number">0</span>]-&gt;sz--;</span><br><span class="line">		<span class="keyword">if</span> (!suc-&gt;s[<span class="number">0</span>]-&gt;w) suc-&gt;s[<span class="number">0</span>] = <span class="literal">NULL</span>;</span><br><span class="line">		suc-&gt;updata(), rt-&gt;updata();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">get_rank</span><span class="params">(<span class="keyword">int</span> _val)</span> </span>&#123;</span><br><span class="line">		SplayNode* pre = predecessor(_val);</span><br><span class="line">		SplayNode* suc = successor(_val);</span><br><span class="line">		splay(pre, rt), splay(suc, rt-&gt;s[<span class="number">1</span>]);</span><br><span class="line">		<span class="keyword">if</span> (suc == <span class="literal">NULL</span>) <span class="keyword">return</span> rt-&gt;sz;</span><br><span class="line">		<span class="keyword">return</span> rt-&gt;sz-suc-&gt;sz;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">SplayNode* <span class="title">get_kth</span><span class="params">(SplayNode* v, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">int</span> lsz = v-&gt;s[<span class="number">0</span>] ? v-&gt;s[<span class="number">0</span>]-&gt;sz : <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">if</span> (k &lt;= lsz) <span class="keyword">return</span> get_kth(v-&gt;s[<span class="number">0</span>], k);</span><br><span class="line">		<span class="keyword">if</span> (k &gt; lsz+v-&gt;w) <span class="keyword">return</span> get_kth(v-&gt;s[<span class="number">1</span>], k-lsz-v-&gt;w);</span><br><span class="line">		<span class="keyword">return</span> v;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; BBST;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n, opt, x;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n);</span><br><span class="line">	<span class="keyword">while</span> (n--) &#123;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;opt, &amp;x);</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">1</span>)	BBST.insert(x);</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">2</span>)	BBST.remove(x);</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">3</span>)	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, BBST.get_rank(x));</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">4</span>)	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, BBST.get_kth(BBST.rt, x+<span class="number">1</span>)-&gt;val);</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">5</span>)	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, BBST.predecessor(x)-&gt;val);</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">6</span>)	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, BBST.successor(x)-&gt;val);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h3 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h3><blockquote>
<p>【模板】文艺平衡树</p>
</blockquote>
<p>题目背景<br>这是一道经典的Splay模板题——文艺平衡树。</p>
<blockquote>
</blockquote>
<p>题目描述<br>您需要写一种数据结构（可参考题目标题），来维护一个有序数列，其中需要提供以下操作：翻转一个区间。<br>例如原有序序列是5 4 3 2 1，翻转区间是[2,4]的话，结果是5 2 3 4 1</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行为n,m，n表示初始序列有n个数，这个序列依次是(1,2…n-1,n)，m表示翻转操作次数<br>接下来m行每行两个数[l,r]，数据保证 1≤l≤r≤n</p>
<blockquote>
</blockquote>
<p>输出格式：<br>输出一行n个数字，表示原始序列经过m次变换后的结果</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例#1：<br>5 3<br>1 3<br>1 3<br>1 4<br>输出样例#1：<br>4 3 2 1 5</p>
<blockquote>
</blockquote>
<p>说明<br>n,m≤100000<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x7f7f7f7f</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> flag (cur-&gt;fa-&gt;fa!=tar&amp;&amp;cur-&gt;fa-&gt;fa-&gt;s[sn]==cur-&gt;fa)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SplayNode</span> &#123;</span></span><br><span class="line">	SplayNode *s[<span class="number">2</span>], *fa;</span><br><span class="line">	<span class="keyword">int</span> val, w, sz;	<span class="keyword">bool</span> rev;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">()</span> </span>&#123;sz = w+(s[<span class="number">0</span>]?s[<span class="number">0</span>]-&gt;sz:<span class="number">0</span>)+(s[<span class="number">1</span>]?s[<span class="number">1</span>]-&gt;sz:<span class="number">0</span>);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">downtag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (!rev) <span class="keyword">return</span>;	rev = <span class="literal">false</span>, swap(s[<span class="number">0</span>], s[<span class="number">1</span>]);</span><br><span class="line">		<span class="keyword">if</span> (s[<span class="number">0</span>]) s[<span class="number">0</span>]-&gt;rev ^= <span class="number">1</span>;	<span class="keyword">if</span> (s[<span class="number">1</span>]) s[<span class="number">1</span>]-&gt;rev ^= <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SplayTree</span> &#123;</span></span><br><span class="line">	SplayNode* rt;</span><br><span class="line">	<span class="function">SplayNode* <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> _val)</span> </span>&#123;</span><br><span class="line">		SplayNode* v = <span class="keyword">new</span> SplayNode;</span><br><span class="line">		v-&gt;s[<span class="number">0</span>] = v-&gt;s[<span class="number">1</span>] = v-&gt;fa = <span class="literal">NULL</span>;</span><br><span class="line">		v-&gt;val = _val, v-&gt;sz = v-&gt;w = <span class="number">1</span>;</span><br><span class="line">		v-&gt;rev = <span class="literal">false</span>;	<span class="keyword">return</span> v;</span><br><span class="line">	&#125;</span><br><span class="line">	SplayTree(<span class="keyword">int</span> n) &#123;</span><br><span class="line">		rt = newnode(-INF), rt-&gt;s[<span class="number">1</span>] = newnode(INF);</span><br><span class="line">		rt-&gt;s[<span class="number">1</span>]-&gt;fa = rt, rt-&gt;updata();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++) insert(i);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(SplayNode* v, <span class="keyword">bool</span> sn)</span> </span>&#123;</span><br><span class="line">		SplayNode* f = v-&gt;fa;</span><br><span class="line">		f-&gt;s[sn^<span class="number">1</span>] = v-&gt;s[sn], v-&gt;fa = f-&gt;fa;</span><br><span class="line">		<span class="keyword">if</span> (f-&gt;s[sn^<span class="number">1</span>]) f-&gt;s[sn^<span class="number">1</span>]-&gt;fa = f;</span><br><span class="line">		<span class="keyword">if</span> (v-&gt;fa) v-&gt;fa-&gt;s[f == f-&gt;fa-&gt;s[<span class="number">1</span>]] = v;</span><br><span class="line">		v-&gt;s[sn] = f, f-&gt;fa = v, f-&gt;updata(), v-&gt;updata();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(SplayNode* cur, SplayNode* tar)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (cur != tar &amp;&amp; cur-&gt;fa != tar) &#123;</span><br><span class="line">			<span class="keyword">bool</span> sn = cur-&gt;fa-&gt;s[<span class="number">1</span>] == cur;</span><br><span class="line">			<span class="function"><span class="keyword">if</span> flag <span class="title">rotate</span><span class="params">(cur-&gt;fa, sn^<span class="number">1</span>)</span></span>;</span><br><span class="line">			rotate(cur, sn^<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (cur-&gt;fa == tar) rotate(cur, cur-&gt;fa-&gt;s[<span class="number">0</span>] == cur);</span><br><span class="line">		<span class="keyword">if</span> (tar == rt) rt = cur;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">SplayNode* <span class="title">predecessor</span><span class="params">(<span class="keyword">int</span> _val)</span> </span>&#123;</span><br><span class="line">		SplayNode *cur = rt, *cpy = rt;</span><br><span class="line">		<span class="keyword">for</span> (; cur; cur = cur-&gt;s[_val &gt; cur-&gt;val])</span><br><span class="line">			<span class="keyword">if</span> (cur-&gt;val &lt; _val) cpy = cur;</span><br><span class="line">		<span class="keyword">return</span> cpy;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">SplayNode* <span class="title">successor</span><span class="params">(<span class="keyword">int</span> _val)</span> </span>&#123;</span><br><span class="line">		SplayNode *cur = rt, *cpy = rt;</span><br><span class="line">		<span class="keyword">for</span> (; cur; cur = cur-&gt;s[_val &gt;= cur-&gt;val])</span><br><span class="line">			<span class="keyword">if</span> (cur-&gt;val &gt; _val) cpy = cur;</span><br><span class="line">		<span class="keyword">return</span> cpy;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> _val)</span> </span>&#123;</span><br><span class="line">		SplayNode* pre = predecessor(_val);</span><br><span class="line">		SplayNode* suc = successor(_val);</span><br><span class="line">		splay(pre, rt), splay(suc, rt-&gt;s[<span class="number">1</span>]);</span><br><span class="line">		<span class="keyword">if</span> (suc-&gt;s[<span class="number">0</span>]) suc-&gt;s[<span class="number">0</span>]-&gt;w++, suc-&gt;s[<span class="number">0</span>]-&gt;sz++;</span><br><span class="line">		<span class="keyword">else</span> suc-&gt;s[<span class="number">0</span>] = newnode(_val), suc-&gt;s[<span class="number">0</span>]-&gt;fa = suc;</span><br><span class="line">		suc-&gt;updata(), rt-&gt;updata();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">reverse</span><span class="params">(<span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">		SplayNode *nl = get_kth(rt, l), *nr = get_kth(rt, r+<span class="number">2</span>);</span><br><span class="line">		splay(nl, rt), splay(nr, rt-&gt;s[<span class="number">1</span>]), nr-&gt;s[<span class="number">0</span>]-&gt;rev ^= <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">SplayNode* <span class="title">get_kth</span><span class="params">(SplayNode* v, <span class="keyword">int</span> k)</span> </span>&#123;</span><br><span class="line">		v-&gt;downtag();</span><br><span class="line">		<span class="keyword">int</span> lsz = v-&gt;s[<span class="number">0</span>] == <span class="literal">NULL</span> ? <span class="number">0</span> : v-&gt;s[<span class="number">0</span>]-&gt;sz;</span><br><span class="line">		<span class="keyword">if</span> (k &lt;= lsz) <span class="keyword">return</span> get_kth(v-&gt;s[<span class="number">0</span>], k);</span><br><span class="line">		<span class="keyword">if</span> (k &gt; lsz+v-&gt;w) <span class="keyword">return</span> get_kth(v-&gt;s[<span class="number">1</span>], k-lsz-v-&gt;w);</span><br><span class="line">		<span class="keyword">return</span> v;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">output</span><span class="params">(SplayNode* v)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (v == <span class="literal">NULL</span>) <span class="keyword">return</span>;	v-&gt;downtag(), output(v-&gt;s[<span class="number">0</span>]);</span><br><span class="line">		<span class="keyword">if</span> (v-&gt;val != -INF &amp;&amp; v-&gt;val != INF) <span class="built_in">printf</span>(<span class="string">"%d "</span>, v-&gt;val);</span><br><span class="line">		output(v-&gt;s[<span class="number">1</span>]);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n, m;	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);	<span class="function">SplayTree <span class="title">BBST</span><span class="params">(n)</span></span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, l, r; i &lt;= m; i++)	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;l, &amp;r), BBST.reverse(l, r);</span><br><span class="line">	<span class="keyword">return</span> BBST.output(BBST.rt), <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Tree-Chain-Division"><a href="#Tree-Chain-Division" class="headerlink" title="Tree Chain Division"></a>Tree Chain Division</h2><blockquote>
<p>【模板】树链剖分</p>
</blockquote>
<p>题目描述<br>如题，已知一棵包含N个结点的树（连通且无环），每个节点上包含一个数值，需要支持以下操作：<br>操作1： 格式： 1 x y z 表示将树从x到y结点最短路径上所有节点的值都加上z<br>操作2： 格式： 2 x y 表示求树从x到y结点最短路径上所有节点的值之和<br>操作3： 格式： 3 x z 表示将以x为根节点的子树内所有节点值都加上z<br>操作4： 格式： 4 x 表示求以x为根节点的子树内所有节点值之和</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含4个正整数N、M、R、P，分别表示树的结点个数、操作个数、根节点序号和取模数（即所有的输出结果均对此取模）。<br>接下来一行包含N个非负整数，分别依次表示各个节点上初始的数值。<br>接下来N-1行每行包含两个整数x、y，表示点x和点y之间连有一条边（保证无环且连通）<br>接下来M行每行包含若干个正整数，每行表示一个操作，格式如下：<br>操作1： 1 x y z<br>操作2： 2 x y<br>操作3： 3 x z<br>操作4： 4 x<br>输出格式：<br>输出包含若干行，分别依次表示每个操作2或操作4所得的结果（对P取模）</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>5 5 2 24<br>7 3 7 8 0<br>1 2<br>1 5<br>3 1<br>4 1<br>3 4 2<br>3 2 2<br>4 5<br>1 5 1 3<br>2 1 3<br>输出样例：<br>2<br>21<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 100000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, r, p, ind;</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> c[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> dep[MAX_N+<span class="number">5</span>], fa[MAX_N+<span class="number">5</span>], size[MAX_N+<span class="number">5</span>], son[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> top[MAX_N+<span class="number">5</span>], dfn[MAX_N+<span class="number">5</span>], last[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> seg[(MAX_N&lt;&lt;<span class="number">2</span>)+<span class="number">5</span>], tag[(MAX_N&lt;&lt;<span class="number">2</span>)+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS1</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">	size[u] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> v = G[u][i];</span><br><span class="line">		<span class="keyword">if</span> (v == fa[u])	<span class="keyword">continue</span>;</span><br><span class="line">		dep[v] = dep[u]+<span class="number">1</span>;</span><br><span class="line">		fa[v] = u;</span><br><span class="line">		DFS1(v);</span><br><span class="line">		size[u] += size[v];</span><br><span class="line">		<span class="keyword">if</span> (!son[u] || size[son[u]] &lt; size[v])	son[u] = v;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS2</span><span class="params">(<span class="keyword">int</span> u, <span class="keyword">int</span> tp)</span> </span>&#123;</span><br><span class="line">	top[u] = tp, dfn[u] = ++ind;</span><br><span class="line">	<span class="keyword">if</span> (son[u])	DFS2(son[u], tp);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> v = G[u][i];</span><br><span class="line">		<span class="keyword">if</span> (v == fa[u] || v == son[u])	<span class="keyword">continue</span>;</span><br><span class="line">		DFS2(v, v);</span><br><span class="line">	&#125;</span><br><span class="line">	last[u] = ind;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">(<span class="keyword">int</span> v)</span> </span>&#123;seg[v] = (seg[v&lt;&lt;<span class="number">1</span>]+seg[v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>])%p;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">downtag</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (!tag[v])	<span class="keyword">return</span>;</span><br><span class="line">	<span class="keyword">int</span> mid = s+t&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	seg[v&lt;&lt;<span class="number">1</span>] = (seg[v&lt;&lt;<span class="number">1</span>]+tag[v]*(mid-s+<span class="number">1</span>))%p;</span><br><span class="line">	seg[v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = (seg[v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+tag[v]*(t-mid))%p;</span><br><span class="line">	tag[v&lt;&lt;<span class="number">1</span>] = (tag[v&lt;&lt;<span class="number">1</span>]+tag[v])%p;</span><br><span class="line">	tag[v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>] = (tag[v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>]+tag[v])%p;</span><br><span class="line">	tag[v] = <span class="number">0</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r, <span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r) &#123;seg[v] = (seg[v]+x*(t-s+<span class="number">1</span>))%p, tag[v] = (tag[v]+x)%p;	<span class="keyword">return</span>;&#125;</span><br><span class="line">	downtag(v, s, t);</span><br><span class="line">	<span class="keyword">int</span> mid = s+t&gt;&gt;<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (l &lt;= mid)	modify(v&lt;&lt;<span class="number">1</span>, s, mid, l, r, x);</span><br><span class="line">	<span class="keyword">if</span> (r &gt;= mid+<span class="number">1</span>)	modify(v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, mid+<span class="number">1</span>, t, l, r, x);</span><br><span class="line">	updata(v);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(<span class="keyword">int</span> v, <span class="keyword">int</span> s, <span class="keyword">int</span> t, <span class="keyword">int</span> l, <span class="keyword">int</span> r)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (s &gt;= l &amp;&amp; t &lt;= r)	<span class="keyword">return</span> seg[v];</span><br><span class="line">	downtag(v, s, t);</span><br><span class="line">	<span class="keyword">int</span> mid = s+t&gt;&gt;<span class="number">1</span>, ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">if</span> (l &lt;= mid)	ret = (ret+query(v&lt;&lt;<span class="number">1</span>, s, mid, l, r))%p;</span><br><span class="line">	<span class="keyword">if</span> (r &gt;= mid+<span class="number">1</span>)	ret = (ret+query(v&lt;&lt;<span class="number">1</span>|<span class="number">1</span>, mid+<span class="number">1</span>, t, l, r))%p;</span><br><span class="line">	updata(v);</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve1</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y, <span class="keyword">int</span> z)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">while</span> (top[x] != top[y]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (dep[top[x]] &lt; dep[top[y]])	swap(x, y);</span><br><span class="line">		modify(<span class="number">1</span>, <span class="number">1</span>, n, dfn[top[x]], dfn[x], z);</span><br><span class="line">		x = fa[top[x]];</span><br><span class="line">	&#125;</span><br><span class="line">	modify(<span class="number">1</span>, <span class="number">1</span>, n, min(dfn[x], dfn[y]), max(dfn[x], dfn[y]), z);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">solve2</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (top[x] != top[y]) &#123;</span><br><span class="line">		<span class="keyword">if</span> (dep[top[x]] &lt; dep[top[y]])	swap(x, y);</span><br><span class="line">		ret = (ret+query(<span class="number">1</span>, <span class="number">1</span>, n, dfn[top[x]], dfn[x]))%p;</span><br><span class="line">		x = fa[top[x]];</span><br><span class="line">	&#125;</span><br><span class="line">	ret = (ret+query(<span class="number">1</span>, <span class="number">1</span>, n, min(dfn[x], dfn[y]), max(dfn[x], dfn[y])))%p;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">solve3</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> z)</span> </span>&#123;modify(<span class="number">1</span>, <span class="number">1</span>, n, dfn[x], last[x], z);&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">solve4</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;<span class="keyword">return</span> query(<span class="number">1</span>, <span class="number">1</span>, n, dfn[x], last[x]);&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d%d%d"</span>, &amp;n, &amp;m, &amp;r, &amp;p);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;c[i]);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt; n; i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> u, v;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v);</span><br><span class="line">		G[u].push_back(v);</span><br><span class="line">		G[v].push_back(u);</span><br><span class="line">	&#125;</span><br><span class="line">	DFS1(r);</span><br><span class="line">	DFS2(r, r);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	modify(<span class="number">1</span>, <span class="number">1</span>, n, dfn[i], dfn[i], c[i]);</span><br><span class="line">	<span class="keyword">while</span> (m--) &#123;</span><br><span class="line">		<span class="keyword">int</span> opt;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;opt);</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">1</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> x, y, z;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;x, &amp;y, &amp;z);</span><br><span class="line">			solve1(x, y, z);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">2</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> x, y;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;y);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, solve2(x, y));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">3</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> x, z;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;x, &amp;z);</span><br><span class="line">			solve3(x, z);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">4</span>) &#123;</span><br><span class="line">			<span class="keyword">int</span> x;</span><br><span class="line">			<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;x);</span><br><span class="line">			<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, solve4(x));</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Link-Cut-Tree"><a href="#Link-Cut-Tree" class="headerlink" title="Link-Cut Tree"></a>Link-Cut Tree</h2><blockquote>
<p>【模板】Link-Cut-Tree</p>
</blockquote>
<p>题目描述<br>给定N个点以及每个点的权值，要你处理接下来的M个操作。操作有4种。操作从0到3编号。点从1到N编号。<br>0：后接两个整数 (x, y)，代表询问从x到y的路径上的点的权值的Xor和。保证x到y是联通的。<br>1：后接两个整数 (x, y)，代表连接x到y，若x到y已经联通则无需连接。<br>2：后接两个整数 (x, y)，代表删除边 (x, y)，不保证边 (x, y) 存在。<br>3：后接两个整数 (x, y)，代表将点x上的权值变成y。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第1行两个整数，分别为N和M，代表点数和操作数。<br>第2行到第N+1行，每行一个整数，整数在 [1, 10^9] 内，代表每个点的权值。<br>第N+2行到第N+M+1行，每行三个整数，分别代表操作类型和操作所需的量。<br>输出格式：<br>对于每一个0号操作，你须输出x到y的路径上点权的Xor和。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>3 3<br>1<br>2<br>3<br>1 1 2<br>0 1 2<br>0 1 1<br>输出样例：<br>3<br>1</p>
<blockquote>
</blockquote>
<p>说明<br>数据范围：1≤N,M≤3*10^5<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;bits/stdc++.h&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 300000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> INF 0x7f7f7f7f</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> flag (!tar(cur-&gt;fa-&gt;fa)&amp;&amp;cur-&gt;fa-&gt;fa-&gt;s[sn]==cur-&gt;fa)</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">SplayNode</span> &#123;</span></span><br><span class="line">	SplayNode *s[<span class="number">2</span>], *fa;	<span class="keyword">int</span> val, sum;	<span class="keyword">bool</span> rev;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">updata</span><span class="params">()</span> </span>&#123;sum = val^(s[<span class="number">0</span>]?s[<span class="number">0</span>]-&gt;sum:<span class="number">0</span>)^(s[<span class="number">1</span>]?s[<span class="number">1</span>]-&gt;sum:<span class="number">0</span>);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">downtag</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (fa &amp;&amp; (fa-&gt;s[<span class="number">0</span>] == <span class="keyword">this</span> || fa-&gt;s[<span class="number">1</span>] == <span class="keyword">this</span>)) fa-&gt;downtag();</span><br><span class="line">		<span class="keyword">if</span> (rev &amp;&amp; s[<span class="number">0</span>]) swap(s[<span class="number">0</span>]-&gt;s[<span class="number">0</span>], s[<span class="number">0</span>]-&gt;s[<span class="number">1</span>]), s[<span class="number">0</span>]-&gt;rev ^= <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">if</span> (rev &amp;&amp; s[<span class="number">1</span>]) swap(s[<span class="number">1</span>]-&gt;s[<span class="number">0</span>], s[<span class="number">1</span>]-&gt;s[<span class="number">1</span>]), s[<span class="number">1</span>]-&gt;rev ^= <span class="number">1</span>;</span><br><span class="line">		rev = <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125; *tr[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">LinkCutTree</span> &#123;</span></span><br><span class="line">	<span class="function">SplayNode* <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> _val)</span> </span>&#123;</span><br><span class="line">		SplayNode* v = <span class="keyword">new</span> SplayNode;</span><br><span class="line">		v-&gt;s[<span class="number">0</span>] = v-&gt;s[<span class="number">1</span>] = v-&gt;fa = <span class="literal">NULL</span>;</span><br><span class="line">		v-&gt;val = v-&gt;sum = _val, v-&gt;rev = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">return</span> v;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function">SplayNode* <span class="title">get_rt</span><span class="params">(SplayNode* v)</span> </span>&#123;<span class="keyword">for</span> (; v-&gt;fa; v = v-&gt;fa) ;	<span class="keyword">return</span> v;&#125;</span><br><span class="line">	<span class="function"><span class="keyword">bool</span> <span class="title">tar</span><span class="params">(SplayNode* v)</span> </span>&#123;<span class="keyword">return</span> (v&amp;&amp;v-&gt;fa==<span class="literal">NULL</span>)||(v&amp;&amp;v-&gt;fa-&gt;s[<span class="number">0</span>]!=v&amp;&amp;v-&gt;fa-&gt;s[<span class="number">1</span>]!=v);&#125;</span><br><span class="line">	LinkCutTree(<span class="keyword">int</span> n) &#123;<span class="keyword">for</span> (<span class="keyword">int</span> i=<span class="number">1</span>,_val;i&lt;=n;i++) <span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;_val), tr[i]=newnode(_val);&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">rotate</span><span class="params">(SplayNode* v, <span class="keyword">bool</span> sn)</span> </span>&#123;</span><br><span class="line">		SplayNode* f = v-&gt;fa;</span><br><span class="line">		f-&gt;s[sn^<span class="number">1</span>] = v-&gt;s[sn], v-&gt;fa = f-&gt;fa;</span><br><span class="line">		<span class="keyword">if</span> (f-&gt;s[sn^<span class="number">1</span>]) f-&gt;s[sn^<span class="number">1</span>]-&gt;fa = f;</span><br><span class="line">		<span class="keyword">if</span> (v-&gt;fa &amp;&amp; !tar(f)) v-&gt;fa-&gt;s[f == f-&gt;fa-&gt;s[<span class="number">1</span>]] = v;</span><br><span class="line">		v-&gt;s[sn] = f, f-&gt;fa = v, f-&gt;updata(), v-&gt;updata();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">splay</span><span class="params">(SplayNode* cur)</span> </span>&#123;</span><br><span class="line">		cur-&gt;downtag();</span><br><span class="line">		<span class="keyword">while</span> (!tar(cur) &amp;&amp; !tar(cur-&gt;fa)) &#123;</span><br><span class="line">			<span class="keyword">bool</span> sn = cur-&gt;fa-&gt;s[<span class="number">1</span>] == cur;</span><br><span class="line">			<span class="function"><span class="keyword">if</span> flag <span class="title">rotate</span><span class="params">(cur-&gt;fa, sn^<span class="number">1</span>)</span></span>;</span><br><span class="line">			rotate(cur, sn^<span class="number">1</span>);</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (!tar(cur) &amp;&amp; tar(cur-&gt;fa))</span><br><span class="line">			rotate(cur, cur-&gt;fa-&gt;s[<span class="number">0</span>] == cur);</span><br><span class="line">		cur-&gt;updata();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">access</span><span class="params">(SplayNode* cur)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">for</span> (SplayNode* cpy = <span class="literal">NULL</span>; cur; cpy = cur, cur = cur-&gt;fa)</span><br><span class="line">			splay(cur), cur-&gt;s[<span class="number">1</span>] = cpy, cur-&gt;updata();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">mroot</span><span class="params">(SplayNode* v)</span> </span>&#123;</span><br><span class="line">		access(v), splay(v);</span><br><span class="line">		swap(v-&gt;s[<span class="number">0</span>], v-&gt;s[<span class="number">1</span>]), v-&gt;rev ^= <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">link</span><span class="params">(SplayNode* u, SplayNode* v)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (get_rt(u) == get_rt(v)) <span class="keyword">return</span>;</span><br><span class="line">		mroot(u), u-&gt;fa = v;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">cut</span><span class="params">(SplayNode* u, SplayNode* v)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (u == v || get_rt(u) != get_rt(v)) <span class="keyword">return</span>;</span><br><span class="line">		mroot(u), access(v), splay(v);</span><br><span class="line">		<span class="keyword">if</span> (v-&gt;s[<span class="number">0</span>] == u) u-&gt;fa = v-&gt;s[<span class="number">0</span>] = <span class="literal">NULL</span>, v-&gt;updata();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">modify</span><span class="params">(SplayNode* v, <span class="keyword">int</span> _val)</span> </span>&#123;</span><br><span class="line">		splay(v), v-&gt;val = _val, v-&gt;updata();</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="function"><span class="keyword">int</span> <span class="title">query</span><span class="params">(SplayNode* u, SplayNode* v)</span> </span>&#123;</span><br><span class="line">		mroot(u), access(v), splay(v);</span><br><span class="line">		<span class="keyword">return</span> v-&gt;sum;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n, m;	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="function">LinkCutTree <span class="title">LCT</span><span class="params">(n)</span></span>;</span><br><span class="line">	<span class="keyword">while</span> (m--) &#123;</span><br><span class="line">		<span class="keyword">int</span> opt, x, y;	<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;opt, &amp;x, &amp;y);</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">0</span>) <span class="built_in">printf</span>(<span class="string">"%d\n"</span>, LCT.query(tr[x], tr[y]));</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">1</span>) LCT.link(tr[x], tr[y]);</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">2</span>) LCT.cut(tr[x], tr[y]);</span><br><span class="line">		<span class="keyword">if</span> (opt == <span class="number">3</span>) LCT.modify(tr[x], y);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h1 id="String"><a href="#String" class="headerlink" title="String"></a>String</h1><h2 id="Knuth-Morris-Pratt-Algorithm"><a href="#Knuth-Morris-Pratt-Algorithm" class="headerlink" title="Knuth-Morris-Pratt Algorithm"></a>Knuth-Morris-Pratt Algorithm</h2><blockquote>
<p>【模板】KMP字符串匹配</p>
</blockquote>
<p>题目描述<br>如题，给出两个字符串s1和s2，其中s2为s1的子串，求出s2在s1中所有出现的位置。<br>为了减少骗分的情况，接下来还要输出子串的前缀数组next。 </p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行为一个字符串，即为s1（仅包含大写字母）<br>第二行为一个字符串，即为s2（仅包含大写字母）<br>输出格式：<br>若干行，每行包含一个整数，表示s2在s1中出现的位置<br>接下来1行，包括length(s2)个整数，表示前缀数组next[i]的值。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>ABABABC<br>ABA<br>输出样例：<br>1<br>3<br>0 0 1 </p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms，128M<br>数据规模：<br>设s1长度为N，s2长度为M<br>对于30%的数据：N&lt;=15，M&lt;=5<br>对于70%的数据：N&lt;=10000，M&lt;=100<br>对于100%的数据：N&lt;=1000000，M&lt;=1000<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_M 1000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> next[MAX_M];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">CalcNext</span><span class="params">(<span class="built_in">string</span>&amp; s)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> m = s.length();</span><br><span class="line">	<span class="keyword">int</span> begin = <span class="number">1</span>, matched = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (begin+matched &lt; m) &#123;</span><br><span class="line">		<span class="keyword">if</span> (s[begin+matched] == s[matched]) &#123;</span><br><span class="line">			matched++;</span><br><span class="line">			next[begin+matched<span class="number">-1</span>] = matched;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (matched == <span class="number">0</span>) &#123;</span><br><span class="line">				begin++;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				begin += matched-next[matched<span class="number">-1</span>];</span><br><span class="line">				matched = next[matched<span class="number">-1</span>];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">KMP</span><span class="params">(<span class="built_in">string</span>&amp; T, <span class="built_in">string</span>&amp; P)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n = T.length(), m = P.length();</span><br><span class="line">	<span class="keyword">int</span> begin = <span class="number">0</span>, matched = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">while</span> (begin &lt;= n-m) &#123;</span><br><span class="line">		<span class="keyword">if</span> (matched &lt; m &amp;&amp; T[begin+matched] == P[matched]) &#123;</span><br><span class="line">			matched++;</span><br><span class="line">			<span class="keyword">if</span> (matched == m) &#123;</span><br><span class="line">				<span class="built_in">cout</span> &lt;&lt; begin+<span class="number">1</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">if</span> (matched == <span class="number">0</span>) &#123;</span><br><span class="line">				begin++;</span><br><span class="line">			&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">				begin += matched-next[matched<span class="number">-1</span>];</span><br><span class="line">				matched = next[matched<span class="number">-1</span>];</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">string</span> s1, s2;</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; s1 &gt;&gt; s2;</span><br><span class="line">	CalcNext(s2);</span><br><span class="line">	KMP(s1, s2);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; s2.length(); i++) &#123;</span><br><span class="line">		<span class="built_in">cout</span> &lt;&lt; next[i] &lt;&lt; <span class="string">" "</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Manacher"><a href="#Manacher" class="headerlink" title="Manacher"></a>Manacher</h2><blockquote>
<p>【模板】manacher算法</p>
</blockquote>
<p>题目描述<br>给出一个只由小写英文字符a,b,c…y,z组成的字符串S,求S中最长回文串的长度.<br>字符串长度为n</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>一行小写英文字符a,b,c…y,z组成的字符串S</p>
<blockquote>
</blockquote>
<p>输出格式：<br>一个整数表示答案</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例#1：<br>aaa<br>输出样例#1：<br>3</p>
<blockquote>
</blockquote>
<p>说明<br>字符串长度len &lt;= 11000000<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_L 11000000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">char</span> s[MAX_L*<span class="number">2</span>+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> f[MAX_L*<span class="number">2</span>+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">manacher</span> <span class="params">(<span class="keyword">char</span>* s0)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> len = <span class="built_in">strlen</span>(s0);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++)	s[i*<span class="number">2</span>+<span class="number">1</span>] = <span class="string">'#'</span>, s[i*<span class="number">2</span>+<span class="number">2</span>] = s0[i];</span><br><span class="line">	s[len = len*<span class="number">2</span>+<span class="number">1</span>] = <span class="string">'#'</span>;</span><br><span class="line">	<span class="keyword">int</span> pos = <span class="number">0</span>, r = <span class="number">0</span>, ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= len; i++) &#123;</span><br><span class="line">		f[i] = (i &lt; r) ? min(f[<span class="number">2</span>*pos-i], r-i) : <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span> (i-f[i] &gt;= <span class="number">1</span> &amp;&amp; i+f[i] &lt;= len &amp;&amp; s[i-f[i]] == s[i+f[i]])	f[i]++;</span><br><span class="line">		<span class="keyword">if</span> (i+f[i] &gt; r)	pos = i, r = i+f[i];</span><br><span class="line">		ret = max(ret, f[i]<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">char</span> s0[MAX_L+<span class="number">5</span>];	<span class="built_in">scanf</span>(<span class="string">"%s"</span>, s0);</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, manacher(s0));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Aho-Corasick-Automation"><a href="#Aho-Corasick-Automation" class="headerlink" title="Aho-Corasick Automation"></a>Aho-Corasick Automation</h2><blockquote>
<p>【模板】AC自动机</p>
</blockquote>
<p>题目描述<br>有N个由小写字母组成的模式串以及一个文本串T。每个模式串可能会在文本串中出现多次。你需要找出哪些模式串在文本串T中出现的次数最多。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>输入含多组数据。<br>每组数据的第一行为一个正整数N，表示共有N个模式串，1≤N≤150。<br>接下去N行，每行一个长度小于等于70的模式串。<br>下一行是一个长度小于等于1e6的文本串T。<br>输入结束标志为N=0。<br>输出格式：<br>对于每组数据，第一行输出模式串最多出现的次数，接下去若干行每行输出一个出现次数最多的模式串，按输入顺序排列。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例#1：<br>2<br>aba<br>bab<br>ababababac<br>6<br>beta<br>alpha<br>haha<br>delta<br>dede<br>tata<br>dedeltalphahahahototatalpha<br>0<br>输出样例#1：<br>4<br>aba<br>2<br>alpha<br>haha<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;queue&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> DICNUM 26</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LETTER 10500</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LENGTH 1000000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">char</span> P[<span class="number">155</span>][<span class="number">75</span>], T[MAX_LENGTH+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> root = <span class="number">1</span>, cnt, trie[MAX_LETTER+<span class="number">5</span>][DICNUM], fail[MAX_LETTER+<span class="number">5</span>], end[MAX_LETTER+<span class="number">5</span>], tot[<span class="number">155</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">memset</span>(P, <span class="number">0</span>, <span class="keyword">sizeof</span>(P)), <span class="built_in">memset</span>(T, <span class="number">0</span>, <span class="keyword">sizeof</span>(T)), <span class="built_in">memset</span>(tot, <span class="number">0</span>, <span class="keyword">sizeof</span>(tot));</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= cnt; i++)	<span class="built_in">memset</span>(trie[i], <span class="number">0</span>, <span class="keyword">sizeof</span>(trie[i])), fail[i] = end[i] = <span class="number">0</span>;	cnt = <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">insert</span><span class="params">(<span class="keyword">int</span> id, <span class="keyword">char</span> s[])</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> cur = <span class="number">1</span>, len = <span class="built_in">strlen</span>(s);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; cur = trie[cur][s[i++]-<span class="string">'a'</span>])</span><br><span class="line">		<span class="keyword">if</span> (!trie[cur][s[i]-<span class="string">'a'</span>])	trie[cur][s[i]-<span class="string">'a'</span>] = ++cnt;</span><br><span class="line">	end[cur] = id;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">SetFail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">queue</span> &lt;<span class="keyword">int</span>&gt; que;	que.push(root);</span><br><span class="line">	<span class="keyword">while</span> (!que.empty()) &#123;</span><br><span class="line">		<span class="keyword">int</span> u = que.front();	que.pop();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++)</span><br><span class="line">			<span class="keyword">if</span> (trie[u][i])	fail[trie[u][i]] = trie[fail[u]][i], que.push(trie[u][i]);</span><br><span class="line">			<span class="keyword">else</span> trie[u][i] = trie[fail[u]][i];</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">query</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> cur = root, index, len = <span class="built_in">strlen</span>(T);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++) &#123;</span><br><span class="line">		index = T[i]-<span class="string">'a'</span>;</span><br><span class="line">		<span class="keyword">while</span> (!trie[cur][index])	cur = fail[cur];</span><br><span class="line">		cur = trie[cur][index];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> j = cur; j; j = fail[j])	tot[end[j]]++;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> n;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; DICNUM; i++)	trie[<span class="number">0</span>][i] = root;</span><br><span class="line">	<span class="keyword">while</span> (<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;n) &amp;&amp; n) &#123;</span><br><span class="line">		init();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%s"</span>, P[i]), insert(i, P[i]);</span><br><span class="line">		SetFail(), <span class="built_in">scanf</span>(<span class="string">"%s"</span>, T), query();</span><br><span class="line">		<span class="keyword">int</span> ans = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	ans = max(ans, tot[i]);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans);</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="keyword">if</span> (tot[i] == ans)	<span class="built_in">printf</span>(<span class="string">"%s\n"</span>, P[i]);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Hash-Table"><a href="#Hash-Table" class="headerlink" title="Hash Table"></a>Hash Table</h2><blockquote>
<p>【模板】字符串哈希</p>
</blockquote>
<p>题目描述<br>如题，给定N个字符串（第i个字符串长度为Mi，字符串内包含数字、大小写字母，大小写敏感），请求出N个字符串中共有多少个不同的字符串。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>第一行包含一个整数N，为字符串的个数。<br>接下来N行每行包含一个字符串，为所提供的字符串。<br>输出格式：<br>输出包含一行，包含一个整数，为不同的字符串个数。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例：<br>5<br>abc<br>aaaa<br>abc<br>abcc<br>12345<br>输出样例：<br>4</p>
<blockquote>
</blockquote>
<p>说明<br>时空限制：1000ms,128M<br>数据规模：<br>对于30%的数据：N&lt;=10，Mi≈6，Mmax&lt;=15;<br>对于70%的数据：N&lt;=1000，Mi≈100，Mmax&lt;=150<br>对于100%的数据：N&lt;=10000，Mi≈1000，Mmax&lt;=1500</p>
<blockquote>
</blockquote>
<p>样例说明：<br>样例中第一个字符串(abc)和第三个字符串(abc)是一样的，所以所提供字符串的集合为{aaaa,abc,abcc,12345}，故共计4个不同的字符串。<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;string&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> size 15000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, cnt = <span class="number">0</span>;</span><br><span class="line"><span class="built_in">string</span> tmp;</span><br><span class="line"><span class="built_in">string</span> hash[size];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc</span><span class="params">(<span class="built_in">string</span>&amp; index)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; index.length(); i++) &#123;</span><br><span class="line">		ret = (ret*<span class="number">256</span>+index[i]+<span class="number">128</span>)%size;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">search</span><span class="params">(<span class="built_in">string</span>&amp; index, <span class="keyword">int</span>&amp; pos)</span> </span>&#123;</span><br><span class="line">	pos = calc(index);</span><br><span class="line">	<span class="keyword">while</span> (hash[pos] != <span class="string">""</span> &amp;&amp; hash[pos] != index) &#123;</span><br><span class="line">		pos = (pos+<span class="number">1</span>)%size;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">if</span> (hash[pos] == index) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(<span class="built_in">string</span>&amp; index)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> pos;</span><br><span class="line">	<span class="keyword">if</span> (search(index, pos)) &#123;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		hash[pos] = index;</span><br><span class="line">		<span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">cin</span> &gt;&gt; n;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">		<span class="built_in">cin</span> &gt;&gt; tmp;</span><br><span class="line">		cnt += insert(tmp);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">cout</span> &lt;&lt; cnt &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Suffix-Array"><a href="#Suffix-Array" class="headerlink" title="Suffix Array"></a>Suffix Array</h2><blockquote>
<p>【模板】后缀排序</p>
</blockquote>
<p>题目背景<br>这是一道模板题。</p>
<blockquote>
</blockquote>
<p>题目描述<br>读入一个长度为n的由大小写英文字母或数字组成的字符串，请把这个字符串的所有非空后缀按字典序从小到大排序，然后按顺序输出后缀的第一个字符在原串中的位置。位置编号为1到n。<br>输入输出格式<br>输入格式：<br>一行一个长度为n的仅包含大小写英文字母或数字的字符串。<br>输出格式：<br>一行，共n个整数，表示答案。</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例#1：<br>ababa<br>输出样例#1：<br>5 3 1 4 2</p>
<blockquote>
</blockquote>
<p>说明<br>n&lt;=1e6<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1000000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n;	<span class="keyword">char</span> ch[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> s[MAX_N+<span class="number">5</span>], sa[MAX_N+<span class="number">5</span>], tx[MAX_N+<span class="number">5</span>], ty[MAX_N+<span class="number">5</span>], cnt[MAX_N+<span class="number">5</span>], rank[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">trans</span><span class="params">(<span class="keyword">char</span> c)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (c &gt;= <span class="string">'0'</span> &amp;&amp; c &lt;= <span class="string">'9'</span>)	<span class="keyword">return</span> c-<span class="string">'0'</span>+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">if</span> (c &gt;= <span class="string">'A'</span> &amp;&amp; c &lt;= <span class="string">'Z'</span>)	<span class="keyword">return</span> c-<span class="string">'A'</span>+<span class="number">11</span>;</span><br><span class="line">	<span class="keyword">if</span> (c &gt;= <span class="string">'a'</span> &amp;&amp; c &lt;= <span class="string">'z'</span>)	<span class="keyword">return</span> c-<span class="string">'a'</span>+<span class="number">37</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">getSA</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> *x = tx, *y = ty;	<span class="keyword">int</span> DICNUM = <span class="number">63</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	cnt[x[i] = s[i]]++;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= DICNUM; i++)	cnt[i] += cnt[i<span class="number">-1</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = n; i; i--)	sa[cnt[x[i]]--] = i;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> h = <span class="number">1</span>; h &lt;= n; h &lt;&lt;= <span class="number">1</span>) &#123;</span><br><span class="line">		<span class="keyword">int</span> c = <span class="number">0</span>;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = n-h+<span class="number">1</span>; i &lt;= n; i++)	y[++c] = i;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="keyword">if</span> (sa[i] &gt; h)	y[++c] = sa[i]-h;</span><br><span class="line">		<span class="built_in">memset</span>(cnt, <span class="number">0</span>, <span class="keyword">sizeof</span>(cnt));</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	cnt[x[i]]++;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= DICNUM; i++)	cnt[i] += cnt[i<span class="number">-1</span>];</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = n; i; i--)	sa[cnt[x[y[i]]]--] = y[i];</span><br><span class="line">		swap(x, y), c = <span class="number">0</span>, x[sa[<span class="number">1</span>]] = ++c;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++)	x[sa[i]] = (y[sa[i]] == y[sa[i<span class="number">-1</span>]] &amp;&amp; y[sa[i]+h] == y[sa[i<span class="number">-1</span>]+h]) ? c : ++c;</span><br><span class="line">		DICNUM = c;	<span class="keyword">if</span> (c == n)	<span class="keyword">break</span>;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%s"</span>, ch);	n = <span class="built_in">strlen</span>(ch);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; n; i++)	s[i+<span class="number">1</span>] = trans(ch[i]);</span><br><span class="line">	getSA();</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%d"</span>, sa[<span class="number">1</span>]);	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">2</span>; i &lt;= n; i++)	<span class="built_in">printf</span>(<span class="string">" %d"</span>, sa[i]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>
<h2 id="Suffix-Automation"><a href="#Suffix-Automation" class="headerlink" title="Suffix Automation"></a>Suffix Automation</h2><blockquote>
<p>【模板】后缀自动机</p>
</blockquote>
<p>题目描述<br>给定一个只包含小写字母的字符串S，请你求出S的所有出现次数不为1的子串的出现次数乘上该子串长度的最大值。</p>
<blockquote>
</blockquote>
<p>输入输出格式<br>输入格式：<br>一行一个仅包含小写字母的字符串S<br>输出格式：<br>一个整数，为所求答案</p>
<blockquote>
</blockquote>
<p>输入输出样例<br>输入样例#1：<br>abab<br>输出样例#1：<br>4</p>
<blockquote>
</blockquote>
<p>说明<br>对于10%的数据，|S|&lt;=1000<br>对于100%的数据，|S|&lt;=1e6<br><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 1000000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> lnt;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">node</span> &#123;</span><span class="keyword">int</span> ch[<span class="number">26</span>], par, len;&#125; SAM[MAX_N*<span class="number">2</span>+<span class="number">500</span>];</span><br><span class="line"><span class="keyword">int</span> sz, root, last, cnt[MAX_N*<span class="number">2</span>+<span class="number">500</span>], dfn[MAX_N*<span class="number">2</span>+<span class="number">500</span>], f[MAX_N*<span class="number">2</span>+<span class="number">500</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">newnode</span><span class="params">(<span class="keyword">int</span> _len)</span> </span>&#123;SAM[++sz].len = _len;	<span class="keyword">return</span> sz;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">init</span><span class="params">()</span> </span>&#123;sz = <span class="number">0</span>, root = last = newnode(<span class="number">0</span>);&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">extend</span><span class="params">(<span class="keyword">int</span> c)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> p = last, np = newnode(SAM[p].len+<span class="number">1</span>);	last = np, f[np] = <span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (; p &amp;&amp; !SAM[p].ch[c]; p = SAM[p].par)	SAM[p].ch[c] = np;</span><br><span class="line">	<span class="keyword">if</span> (!p)	SAM[np].par = root;</span><br><span class="line">	<span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">int</span> q = SAM[p].ch[c];</span><br><span class="line">		<span class="keyword">if</span> (SAM[q].len == SAM[p].len+<span class="number">1</span>)	SAM[np].par = q;</span><br><span class="line">		<span class="keyword">else</span> &#123;</span><br><span class="line">			<span class="keyword">int</span> nq = newnode(SAM[p].len+<span class="number">1</span>);</span><br><span class="line">			<span class="built_in">memcpy</span>(SAM[nq].ch, SAM[q].ch, <span class="keyword">sizeof</span>(SAM[q].ch));</span><br><span class="line">			SAM[nq].par = SAM[q].par, SAM[q].par = SAM[np].par = nq;</span><br><span class="line">			<span class="keyword">for</span> (; p &amp;&amp; SAM[p].ch[c] == q; p = SAM[p].par)	SAM[p].ch[c] = nq;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">char</span> s[MAX_N+<span class="number">5</span>];	init(), <span class="built_in">scanf</span>(<span class="string">"%s"</span>, s);	<span class="keyword">int</span> l = <span class="built_in">strlen</span>(s);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; l; i++)	extend(s[i]-<span class="string">'a'</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= sz; i++)	cnt[SAM[i].len]++;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= l; i++)	cnt[i] += cnt[i<span class="number">-1</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= sz; i++)	dfn[cnt[SAM[i].len]--] = i;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= sz; i++)	<span class="built_in">cout</span> &lt;&lt; dfn[i] &lt;&lt; <span class="string">" "</span>;	<span class="built_in">cout</span> &lt;&lt; <span class="built_in">endl</span>;</span><br><span class="line">	lnt ans = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = sz; i &gt;= <span class="number">1</span>; i--) &#123;</span><br><span class="line">		<span class="keyword">int</span> p = dfn[i];	f[SAM[p].par] += f[p];</span><br><span class="line">		<span class="keyword">if</span> (f[p] &gt; <span class="number">1</span>)	ans = max(ans, (lnt)f[p]*SAM[p].len);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">printf</span>(<span class="string">"%lld"</span>, ans);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p>

          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/27/BZOJ1787【AHOI2008】Meet紧急集合 LCA/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Azrael_Death">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NIRVANA">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/27/BZOJ1787【AHOI2008】Meet紧急集合 LCA/" itemprop="url">BZOJ1787【AHOI2008】Meet紧急集合 <LCA></a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-27T00:00:00+08:00">
                2017-09-27
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><blockquote>
<h2 id="【AHOI2008】Meet-紧急集合"><a href="#【AHOI2008】Meet-紧急集合" class="headerlink" title="【AHOI2008】Meet 紧急集合"></a>【AHOI2008】Meet 紧急集合</h2></blockquote>
<h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>欢乐岛上有个非常好玩的游戏，叫做“紧急集合”。在岛上分散有$N$个等待点，有$N-1$条道路连接着它们，每条道路都连接某两个等待点，且通过这些道路可以走遍所有的等待点，通过道路从一点到另一点要花费一个游戏币。参加游戏的三人一组，开始的时候，所有人员均任意分散在各个等待点上（每个点同时允许多个人等待），每个人均带有足够多的游戏币（用于支付使用道路的花费）、地图（标明等待点之间道路连接的情况）以及对讲机（用于和同组的成员联系）。当集合号吹响后，每个成员之间迅速联系，了解到自己组所有成员所在的等待点后，迅速在$N$个等待点中确定一个集合点，组内所有成员将在该集合点集合，集合所用花费最少的组将是游戏的赢家。<br>小可可和他的朋友邀请你一起参加这个游戏，有你来选择集合点，聪明的你能够完成这个任务，帮助小可可赢得游戏吗？</p>
<blockquote>
</blockquote>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>第一行两个正整数$N$和$M$（$N\le 5\times 10^5$，$M\le 5\times 10^5$），之间用一个空格隔开。分别表示等待点的个数（等待点也从$1$到$N$进行编号）和获奖所需完成的集合次数。<br>随后有$N-1$行，每行两个正整数$A$和$B$，之间用空格隔开，表示编号为$A$和编号为$B$的等待点之间有一条路。<br>接着还有$M$行，每行用三个正整数表示某次集合前小可可、小可可的朋友以及你所在的等待点的编号。</p>
<blockquote>
</blockquote>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>一共有$M$行，每行两个数$P$和$C$，用一个空格隔开。其中第$i$行表示第$i$次集合点选择在编号为$P$的等待点，集合总共的花费是$C$个游戏币。</p>
<blockquote>
</blockquote>
<h3 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">6 4</span><br><span class="line">1 2</span><br><span class="line">2 3</span><br><span class="line">2 4</span><br><span class="line">4 5</span><br><span class="line">5 6</span><br><span class="line">4 5 6</span><br><span class="line">6 3 1</span><br><span class="line">2 4 4</span><br><span class="line">6 6 6</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">5 2</span><br><span class="line">2 5</span><br><span class="line">4 1</span><br><span class="line">6 0</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h3 id="HINT"><a href="#HINT" class="headerlink" title="HINT"></a>HINT</h3><p>$40\%$的数据中，$N\le 2000$，$M\le 2000$<br>$100\%$的数据中，$N\le 500000$，$M\le 500000$</p>
</blockquote>
<p>标签：$LCA$</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>对于每组询问，找出三个点中两两的$lca$，这三个$lca$中必然至少有两个相同。找出那个不同的$lca$，以它为集合点，算出距离，一定最小。<br>原理可见$zhber$博客：<a href="http://www.cnblogs.com/zhber/p/4116388.html" target="_blank" rel="noopener">http://www.cnblogs.com/zhber/p/4116388.html</a></p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;vector&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 500000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, fa[MAX_N+<span class="number">5</span>][<span class="number">35</span>], dep[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="built_in">vector</span> &lt;<span class="keyword">int</span>&gt; G[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">DFS</span><span class="params">(<span class="keyword">int</span> u)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">30</span>; i++)	<span class="keyword">if</span> (dep[u] &gt;= (<span class="number">1</span>&lt;&lt;i))	fa[u][i] = fa[fa[u][i<span class="number">-1</span>]][i<span class="number">-1</span>];</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; G[u].size(); i++) &#123;</span><br><span class="line">		<span class="keyword">int</span> v = G[u][i];	<span class="keyword">if</span> (v == fa[u][<span class="number">0</span>])	<span class="keyword">continue</span>;</span><br><span class="line">		fa[v][<span class="number">0</span>] = u, dep[v] = dep[u]+<span class="number">1</span>, DFS(v);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">LCA</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (dep[a] &lt; dep[b])	swap(a, b);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">30</span>; i &gt;= <span class="number">0</span>; i--)	<span class="keyword">if</span> (dep[a]-(<span class="number">1</span>&lt;&lt;i) &gt;= dep[b])	a = fa[a][i];</span><br><span class="line">	<span class="keyword">if</span> (a == b)	<span class="keyword">return</span> a;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">30</span>; i &gt;= <span class="number">0</span>; i--)	<span class="keyword">if</span> (fa[a][i] != fa[b][i])	a = fa[a][i], b = fa[b][i];</span><br><span class="line">	<span class="keyword">return</span> fa[a][<span class="number">0</span>];</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">calc</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;<span class="keyword">int</span> c = LCA(a, b);	<span class="keyword">return</span> dep[a]+dep[b]<span class="number">-2</span>*dep[c];&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>, u, v; i &lt; n; i++)	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;u, &amp;v), G[u].push_back(v), G[v].push_back(u);	DFS(<span class="number">1</span>);</span><br><span class="line">	<span class="keyword">while</span> (m--) &#123;</span><br><span class="line">		<span class="keyword">int</span> a, b, c;	<span class="built_in">scanf</span>(<span class="string">"%d%d%d"</span>, &amp;a, &amp;b, &amp;c);</span><br><span class="line">		<span class="keyword">int</span> lca = LCA(a, b)^LCA(a, c)^LCA(b, c);</span><br><span class="line">		<span class="keyword">int</span> dis = calc(a, lca)+calc(b, lca)+calc(c, lca);</span><br><span class="line">		<span class="built_in">printf</span>(<span class="string">"%d %d\n"</span>, lca, dis);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/25/UVa12345 Dynamic len(set(a[LR])) 带修莫队/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Azrael_Death">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NIRVANA">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/25/UVa12345 Dynamic len(set(a[LR])) 带修莫队/" itemprop="url">UVa12345 Dynamic len(set(a[L:R])) <带修莫队></a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-25T00:00:00+08:00">
                2017-09-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><blockquote>
<h2 id="Dynamic-len-set-a-L-R"><a href="#Dynamic-len-set-a-L-R" class="headerlink" title="Dynamic len(set(a[L:R]))"></a>Dynamic len(set(a[L:R]))</h2></blockquote>
<h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>In python, we can use len(start(a[L:R])) to calculate the number of distinct values of elements $a[L],a[L + 1], \cdots,a[R-1]$.<br>Tere are some interactive examples that may help you understand how it is done. Remember that the indices of python lists start from $0$.<br>>>><br>a=[1,2,1,3,2,1,4]<br>>>> print a[1:6]<br>[2, 1, 3, 2, 1]<br>>>> print set(a[1:6])<br>set([1, 2, 3])<br>>>> print<br>len(set(a[1:6]))<br>3<br>>>> a[3]=2<br>>>> print<br>len(set(a[1:6]))<br>2<br>>>> print len(set(a[3:5]))<br>1<br>Your task is to simulate this process.</p>
<blockquote>
</blockquote>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>There will be only one test case. The first line contains two integers $n$ and $m$ $(1\le n,m\le 50,000)$.<br>The next line contains the original list.<br>All the integers are between $1$ and $1,000,000$ (inclusive). The next m lines contain the statements<br>that you need to execute.<br>A line formatted as ‘$M$ $x$ $y$’ $(1\le y\le 1,000,000)$ means $a[x] = y$, and a line formatted as ‘$Q$ $x$<br>$y$’ means $print len(set(a[x : y]))$.<br>It is guaranteed that the statements will not cause $index$ $out$ $of$ $range$ error.</p>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>Print the simulated result, one line for each query.</p>
<blockquote>
</blockquote>
<h3 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">7 4</span><br><span class="line">1 2 1 3 2 1 4</span><br><span class="line">Q 1 6</span><br><span class="line">M 3 2</span><br><span class="line">Q 1 6</span><br><span class="line">Q 3 5</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">3</span><br><span class="line">2</span><br><span class="line">1</span><br></pre></td></tr></table></figure>
</blockquote>
<p>标签：带修莫队</p>
<h2 id="Translation"><a href="#Translation" class="headerlink" title="Translation"></a>Translation</h2><p>题目大意：给出一个长为$n$的序列，有$m$个操作，分为两类：</p>
<ol>
<li>$Q$ $a$ $b$ 询问此序列$a\sim b$位间有多少种不同数</li>
<li>$M$ $a$ $b$ 将第$a$位改为$b$。</li>
</ol>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>本题数据范围只有五万，一看就是带根号的算法，可以$O(n\sqrt{n})$莫队水过。<br>我们发现$Q$操作是标准莫队，但$M$操作是修改，因而需用带修莫队。<br>带修莫队即在普通莫队的双指针种再加一个指针，指向时间。对于离线后询问建的扩展，如果是同一时间，就直接移动双指针；如果是不同时间，就先暴力移动时间指针，然后再移双指针即可。<br>暴力出奇迹~~~</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 50000</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_C 1000000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">int</span> n, m, tmp, col[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> cnt[MAX_C+<span class="number">5</span>], pos[MAX_N+<span class="number">5</span>], lst[MAX_N+<span class="number">5</span>], ans[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">bool</span> mark[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Modify</span> &#123;</span><span class="keyword">int</span> pos, x, pre;&#125; M[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span> &#123;</span><span class="keyword">int</span> l, r, id, ts;&#125; Q[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp</span><span class="params">(<span class="keyword">const</span> Query &amp;a, <span class="keyword">const</span> Query &amp;b)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span>	pos[a.l] &lt; pos[b.l] || </span><br><span class="line">			(pos[a.l] == pos[b.l] &amp;&amp; pos[a.r] &lt; pos[b.r]) || </span><br><span class="line">			(pos[a.l] == pos[b.l] &amp;&amp; pos[a.r] == pos[b.r] &amp;&amp; a.ts &lt; b.ts);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> x)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (mark[x]) &#123;</span><br><span class="line">		cnt[col[x]]--;</span><br><span class="line">		<span class="keyword">if</span> (!cnt[col[x]])	tmp--;</span><br><span class="line">	&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">		<span class="keyword">if</span> (!cnt[col[x]])	tmp++;</span><br><span class="line">		cnt[col[x]]++;</span><br><span class="line">	&#125;</span><br><span class="line">	mark[x] ^= <span class="number">1</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">change</span><span class="params">(<span class="keyword">int</span> x, <span class="keyword">int</span> y)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (mark[x])	add(x), col[x] = y, add(x);</span><br><span class="line">	<span class="keyword">else</span>	col[x] = y;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">int</span> magic = (<span class="keyword">int</span>)(<span class="built_in">sqrt</span>((<span class="keyword">double</span>)n+<span class="number">0.5</span>));</span><br><span class="line">	<span class="keyword">int</span> tot = <span class="number">0</span>, ind = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;col[i]), lst[i] = col[i], pos[i] = i/magic;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">		<span class="keyword">char</span> opt[<span class="number">2</span>];</span><br><span class="line">		<span class="keyword">int</span> x, y;</span><br><span class="line">		<span class="built_in">scanf</span>(<span class="string">"%s%d%d"</span>, opt, &amp;x, &amp;y);	x++;</span><br><span class="line">		<span class="keyword">if</span> (opt[<span class="number">0</span>] == <span class="string">'Q'</span>) &#123;</span><br><span class="line">			Q[++tot].id = tot;</span><br><span class="line">			Q[tot].l = x, Q[tot].r = y, Q[tot].ts = ind;</span><br><span class="line">		&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">			M[++ind].pos = x, M[ind].x = y, M[ind].pre = lst[x];</span><br><span class="line">			lst[x] = y;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	sort(Q+<span class="number">1</span>, Q+tot+<span class="number">1</span>, cmp);</span><br><span class="line">	<span class="keyword">int</span> now = <span class="number">0</span>, l = <span class="number">1</span>, r = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tot; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (now &lt; Q[i].ts)	<span class="keyword">for</span> (<span class="keyword">int</span> j = now+<span class="number">1</span>; j &lt;= Q[i].ts; j++)	change(M[j].pos, M[j].x);</span><br><span class="line">		<span class="keyword">if</span> (now &gt; Q[i].ts)	<span class="keyword">for</span> (<span class="keyword">int</span> j = now; j &gt; Q[i].ts; j--)	change(M[j].pos, M[j].pre);</span><br><span class="line">		<span class="keyword">if</span> (l &gt; Q[i].l)	<span class="keyword">for</span> (<span class="keyword">int</span> j = l<span class="number">-1</span>; j &gt;= Q[i].l; j--)	add(j);</span><br><span class="line">		<span class="keyword">if</span> (r &lt; Q[i].r)	<span class="keyword">for</span> (<span class="keyword">int</span> j = r+<span class="number">1</span>; j &lt;= Q[i].r; j++)	add(j);</span><br><span class="line">		<span class="keyword">if</span> (l &lt; Q[i].l)	<span class="keyword">for</span> (<span class="keyword">int</span> j = l; j &lt; Q[i].l; j++)	add(j);</span><br><span class="line">		<span class="keyword">if</span> (r &gt; Q[i].r)	<span class="keyword">for</span> (<span class="keyword">int</span> j = r; j &gt; Q[i].r; j--)	add(j);</span><br><span class="line">		now = Q[i].ts, l = Q[i].l, r = Q[i].r;</span><br><span class="line">		ans[Q[i].id] = tmp;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= tot; i++)	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, ans[i]);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/25/HDU3068 最长回文 Manacher/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Azrael_Death">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NIRVANA">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/25/HDU3068 最长回文 Manacher/" itemprop="url">HDU3068 最长回文 <Manacher></a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-25T00:00:00+08:00">
                2017-09-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><blockquote>
<h2 id="最长回文"><a href="#最长回文" class="headerlink" title="最长回文"></a>最长回文</h2></blockquote>
<p> Time Limit: $4000/2000 MS (Java/Others)$<br> Memory Limit: $32768/32768 K (Java/Others)$</p>
<blockquote>
</blockquote>
<h3 id="Problem-Description"><a href="#Problem-Description" class="headerlink" title="Problem Description"></a>Problem Description</h3><p>给出一个只由小写英文字符$a,b,c\cdots y,z$组成的字符串$S$, 求$S$中最长回文串的长度.<br>回文就是正反读都是一样的字符串, 如$aba$, $abba$等</p>
<blockquote>
</blockquote>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>输入有多组$case$,不超过$120$组,每组输入为一行小写英文字符$a,b,c\cdots y,z$组成的字符串$S$<br>两组$case$之间由空行隔开(该空行不用处理)<br>字符串长度$len\le 110000$</p>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>每一行一个整数$x$,对应一组$case$,表示该组$case$的字符串中所包含的最长回文长度.</p>
<blockquote>
</blockquote>
<h3 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">aaaa</span><br><span class="line">abab</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">4</span><br><span class="line">3</span><br></pre></td></tr></table></figure>
</blockquote>
<p>标签：$Manacher$</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>$Manacher$板子题。<br>不懂$Manacher$可以戳这里：<a href="https://segmentfault.com/a/1190000003914228" target="_blank" rel="noopener">https://segmentfault.com/a/1190000003914228</a><br>简单来说，$Manacher$就是记录以每个位置为中心的回文串的半径长度，这样在后面计算的时候可以根据对称性，利用前面的结果加速，找更长匹配时暴力扩展，复杂度$O(n)$。由于此算法仅能对付长度为奇数的回文串（毕竟你算的是以每个点为<strong>中心</strong>的回文串），故先在每两个字符间插入一个占位符。</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstring&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_L 110000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">char</span> s[MAX_L*<span class="number">2</span>+<span class="number">5</span>];</span><br><span class="line"><span class="keyword">int</span> f[MAX_L*<span class="number">2</span>+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">manacher</span> <span class="params">(<span class="keyword">char</span>* s0)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">int</span> len = <span class="built_in">strlen</span>(s0);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; len; i++)	s[i*<span class="number">2</span>+<span class="number">1</span>] = <span class="string">'#'</span>, s[i*<span class="number">2</span>+<span class="number">2</span>] = s0[i];</span><br><span class="line">	s[len = len*<span class="number">2</span>+<span class="number">1</span>] = <span class="string">'#'</span>;</span><br><span class="line">	<span class="keyword">int</span> pos = <span class="number">0</span>, r = <span class="number">0</span>, ret = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= len; i++) &#123;</span><br><span class="line">		f[i] = (i &lt; r) ? min(f[<span class="number">2</span>*pos-i], r-i) : <span class="number">1</span>;</span><br><span class="line">		<span class="keyword">while</span> (i-f[i] &gt;= <span class="number">1</span> &amp;&amp; i+f[i] &lt;= len &amp;&amp; s[i-f[i]] == s[i+f[i]])	f[i]++;</span><br><span class="line">		<span class="keyword">if</span> (i+f[i] &gt; r)	pos = i, r = i+f[i];</span><br><span class="line">		ret = max(ret, f[i]<span class="number">-1</span>);</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="keyword">return</span> ret;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">char</span> s0[MAX_L+<span class="number">5</span>];</span><br><span class="line">	<span class="keyword">while</span> (~<span class="built_in">scanf</span>(<span class="string">"%s"</span>, s0))	<span class="built_in">printf</span>(<span class="string">"%d\n"</span>, manacher(s0));</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2017/09/25/BZOJ2038 小Z的袜子 莫队/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Azrael_Death">
      <meta itemprop="description" content="">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="NIRVANA">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                <a class="post-title-link" href="/2017/09/25/BZOJ2038 小Z的袜子 莫队/" itemprop="url">BZOJ2038 小Z的袜子 <莫队></a></h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Veröffentlicht am</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2017-09-25T00:00:00+08:00">
                2017-09-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="Problem"><a href="#Problem" class="headerlink" title="Problem"></a>Problem</h2><blockquote>
<h2 id="小Z的袜子"><a href="#小Z的袜子" class="headerlink" title="小Z的袜子"></a>小Z的袜子</h2></blockquote>
<h3 id="Description"><a href="#Description" class="headerlink" title="Description"></a>Description</h3><p>作为一个生活散漫的人，小$Z$每天早上都要耗费很久从一堆五颜六色的袜子中找出一双来穿。终于有一天，小$Z$再也无法忍受这恼人的找袜子过程，于是他决定听天由命……<br>具体来说，小$Z$把这$N$只袜子从$1$到$N$编号，然后从编号$L$到$R$(尽管小$Z$并不在意两只袜子是不是完整的一双，甚至不在意两只袜子是否一左一右，他却很在意袜子的颜色，毕竟穿两只不同色的袜子会很尴尬)。<br>你的任务便是告诉小$Z$，他有多大的概率抽到两只颜色相同的袜子。当然，小$Z$希望这个概率尽量高，所以他可能会询问多个$(L,R)$以方便自己选择。</p>
<blockquote>
</blockquote>
<h3 id="Input"><a href="#Input" class="headerlink" title="Input"></a>Input</h3><p>输入文件第一行包含两个正整数$N$和$M$。$N$为袜子的数量，$M$为小$Z$所提的询问的数量。接下来一行包含$N$个正整数$C_i$，其中$C_i$表示第$i$只袜子的颜色，相同的颜色用相同的数字表示。再接下来$M$行，每行两个正整数$L$，$R$表示一个询问。</p>
<h3 id="Output"><a href="#Output" class="headerlink" title="Output"></a>Output</h3><p>包含$M$行，对于每个询问在一行中输出分数$A/B$表示从该询问的区间$[L,R]$中随机抽出两只袜子颜色相同的概率。若该概率为$0$则输出$0/1$，否则输出的$A/B$必须为最简分数。</p>
<blockquote>
</blockquote>
<h3 id="Sample-Input"><a href="#Sample-Input" class="headerlink" title="Sample Input"></a>Sample Input</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">6 4</span><br><span class="line">1 2 3 3 3 2</span><br><span class="line">2 6</span><br><span class="line">1 3</span><br><span class="line">3 5</span><br><span class="line">1 6</span><br></pre></td></tr></table></figure>
<blockquote>
<h3 id="Sample-Output"><a href="#Sample-Output" class="headerlink" title="Sample Output"></a>Sample Output</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">2/5</span><br><span class="line">0/1</span><br><span class="line">1/1</span><br><span class="line">4/15</span><br></pre></td></tr></table></figure>
</blockquote>
<blockquote>
<h3 id="Hint"><a href="#Hint" class="headerlink" title="Hint"></a>Hint</h3><p><strong>【样例解释】</strong><br>询问$1$：共$C_5^2=10$种可能，其中抽出两个$2$有$1$种可能，抽出两个$3$有$3$种可能，概率为$(1+3)/10=4/10=2/5$。<br>询问$2$：共$C_3^2=3$种可能，无法抽到颜色相同的袜子，概率为$0/3=0/1$。<br>询问$3$：共$C_3^2=3$种可能，均为抽出两个3，概率为$3/3=1/1$。<br><strong>【数据规模和约定】</strong><br>$30\%$的数据中 $N,M \le 5000$；<br>$60\%$的数据中 $N,M \le 25000$；<br>$100\%$的数据中 $N,M \le 50000$，$1\le L &lt; R \le N$，$C_i \le N$。</p>
</blockquote>
<p>标签：莫队</p>
<h2 id="Solution"><a href="#Solution" class="headerlink" title="Solution"></a>Solution</h2><p>莫队经典例题。<br>不懂莫队的可以戳这里：<a href="http://www.cnblogs.com/hzf-sbit/p/4056874.html" target="_blank" rel="noopener">http://www.cnblogs.com/hzf-sbit/p/4056874.html</a><br>简单来说，莫队就是将询问离线，维护双指针，暴力扩展或缩小范围，为了加速，用分块，可以达到$O(n\sqrt{n})$。</p>
<h2 id="Code"><a href="#Code" class="headerlink" title="Code"></a>Code</h2><figure class="highlight c++"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cstdio&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;algorithm&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cmath&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_N 50000</span></span><br><span class="line"><span class="keyword">using</span> <span class="keyword">namespace</span> <span class="built_in">std</span>;</span><br><span class="line"><span class="keyword">typedef</span> <span class="keyword">long</span> <span class="keyword">long</span> ll;</span><br><span class="line"><span class="keyword">int</span> n, m;</span><br><span class="line"><span class="keyword">int</span> col[MAX_N+<span class="number">5</span>], f[MAX_N+<span class="number">5</span>], pos[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function">ll <span class="title">gcd</span><span class="params">(ll a, ll b)</span>	</span>&#123;<span class="keyword">return</span> (b == <span class="number">0</span>) ? a : gcd(b, a%b);&#125;</span><br><span class="line"><span class="class"><span class="keyword">struct</span> <span class="title">Query</span> &#123;</span></span><br><span class="line">	<span class="keyword">int</span> id, l, r;	ll a, b;</span><br><span class="line">	<span class="function"><span class="keyword">void</span> <span class="title">reduction</span><span class="params">()</span> </span>&#123;ll tmp = gcd(a, b);	a /= tmp, b /= tmp;&#125;</span><br><span class="line">&#125; Q[MAX_N+<span class="number">5</span>];</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp_l</span><span class="params">(<span class="keyword">const</span> Query &amp;a, <span class="keyword">const</span> Query &amp;b)</span> </span>&#123;<span class="keyword">return</span> pos[a.l] &lt; pos[b.l] || (pos[a.l] == pos[b.l] &amp;&amp; a.r &lt; b.r);&#125;</span><br><span class="line"><span class="function"><span class="keyword">bool</span> <span class="title">cmp_id</span><span class="params">(<span class="keyword">const</span> Query &amp;a, <span class="keyword">const</span> Query &amp;b)</span> </span>&#123;<span class="keyword">return</span> a.id &lt; b.id;&#125;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">add</span><span class="params">(<span class="keyword">int</span> c, ll &amp;tmp, <span class="keyword">int</span> x)</span> </span>&#123;tmp += x*<span class="number">2</span>*f[c]+<span class="number">1</span>;	f[c] += x;&#125;</span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;n, &amp;m);</span><br><span class="line">	<span class="keyword">int</span> magic = (<span class="keyword">int</span>)<span class="built_in">sqrt</span>((<span class="keyword">double</span>)n+<span class="number">0.5</span>);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= n; i++)	<span class="built_in">scanf</span>(<span class="string">"%d"</span>, &amp;col[i]), pos[i] = (i<span class="number">-1</span>)/magic+<span class="number">1</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)	<span class="built_in">scanf</span>(<span class="string">"%d%d"</span>, &amp;Q[i].l, &amp;Q[i].r), Q[i].id = i;</span><br><span class="line">	sort(Q+<span class="number">1</span>, Q+m+<span class="number">1</span>, cmp_l);</span><br><span class="line">	ll tmp = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">int</span> l = <span class="number">1</span>, r = <span class="number">0</span>;</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++) &#123;</span><br><span class="line">		<span class="keyword">if</span> (l &gt; Q[i].l) &#123;<span class="keyword">for</span> (<span class="keyword">int</span> j = l<span class="number">-1</span>; j &gt;= Q[i].l; j--)	add(col[j], tmp, <span class="number">1</span>);	l = Q[i].l;&#125;</span><br><span class="line">		<span class="keyword">if</span> (r &lt; Q[i].r)	&#123;<span class="keyword">for</span> (<span class="keyword">int</span> j = r+<span class="number">1</span>; j &lt;= Q[i].r; j++)	add(col[j], tmp, <span class="number">1</span>);	r = Q[i].r;&#125;</span><br><span class="line">		<span class="keyword">if</span> (l &lt; Q[i].l) &#123;<span class="keyword">for</span> (<span class="keyword">int</span> j = l; j &lt; Q[i].l; j++)	add(col[j], tmp, <span class="number">-1</span>);	l = Q[i].l;&#125;</span><br><span class="line">		<span class="keyword">if</span> (r &gt; Q[i].r) &#123;<span class="keyword">for</span> (<span class="keyword">int</span> j = r; j &gt; Q[i].r; j--)	add(col[j], tmp, <span class="number">-1</span>);	r = Q[i].r;&#125;</span><br><span class="line">		<span class="keyword">if</span> (Q[i].l == Q[i].r)	&#123;Q[i].a = <span class="number">0</span>, Q[i].b = <span class="number">1</span>;	<span class="keyword">continue</span>;&#125;</span><br><span class="line">		Q[i].a = tmp-(Q[i].r-Q[i].l+<span class="number">1</span>), Q[i].b = (ll)(Q[i].r-Q[i].l+<span class="number">1</span>)*(Q[i].r-Q[i].l);</span><br><span class="line">		Q[i].reduction();</span><br><span class="line">	&#125;</span><br><span class="line">	sort(Q+<span class="number">1</span>, Q+m+<span class="number">1</span>, cmp_id);</span><br><span class="line">	<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= m; i++)	<span class="built_in">printf</span>(<span class="string">"%lld/%lld\n"</span>, Q[i].a, Q[i].b);</span><br><span class="line">	<span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>
    
    
    

    

    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/page/7/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="space">&hellip;</span><a class="page-number" href="/page/7/">7</a><span class="page-number current">8</span><a class="page-number" href="/page/9/">9</a><span class="space">&hellip;</span><a class="page-number" href="/page/13/">13</a><a class="extend next" rel="next" href="/page/9/"><i class="fa fa-angle-right"></i></a>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      

      <section class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
            
              <p class="site-author-name" itemprop="name">Azrael_Death</p>
              <p class="site-description motion-element" itemprop="description"></p>
          </div>

          <nav class="site-state motion-element">

            
              <div class="site-state-item site-state-posts">
              
                <a href="/archives/">
              
                  <span class="site-state-item-count">122</span>
                  <span class="site-state-item-name">Artikel</span>
                </a>
              </div>
            

            

            
              
              
              <div class="site-state-item site-state-tags">
                
                  <span class="site-state-item-count">74</span>
                  <span class="site-state-item-name">Tags</span>
                
              </div>
            

          </nav>

          

          

          
          

          
          

          

        </div>
      </section>

      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Azrael_Death</span>

  
</div>


  <div class="powered-by">Erstellt mit  <a class="theme-link" target="_blank" href="https://hexo.io">Hexo</a></div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme &mdash; <a class="theme-link" target="_blank" href="https://github.com/iissnan/hexo-theme-next">NexT.Muse</a> v5.1.4</div>




        







        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  












  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>
  

  
  
    <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.4"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.4"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.4"></script>



  


  




	





  





  












  





  

  

  

  
  

  
  
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"]  ],
          processEscapes: true,
          skipTags: ['script', 'noscript', 'style', 'textarea', 'pre', 'code']
        }
      });
    </script>

    <script type="text/x-mathjax-config">
      MathJax.Hub.Queue(function() {
        var all = MathJax.Hub.getAllJax(), i;
        for (i=0; i < all.length; i += 1) {
          all[i].SourceElement().parentNode.className += ' has-jax';
        }
      });
    </script>
    <script type="text/javascript" src="//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
  


  

  

</body>
</html>
